commit def34661b08109f8148904b860457d5747c425b3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 18 07:52:42 2010 +0100

    preparations for 3.1.3

commit f2801031604150c9ad6d1bfe842b61ec79131e1e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 14 10:52:59 2010 +0100

    test_csvparser: added testcase to cover empty values

commit 7e651e2339c4d94d2bcab20cf8cac7003801de83
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 14 10:52:47 2010 +0100

    LogWriter: set msg_context to NULL in case of the failure path

commit 8d69c8449721fc246bd91dbc1e5901e98668ca15
Merge: e6ade3f fe9f208
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Nov 5 23:09:24 2010 +0100

    Merge remote branch '3.0/master'

commit fe9f208b0fd6a8146e53c709bfa77bba32888824
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Nov 5 23:08:25 2010 +0100

    fixed compilation warning
    
    /home/bazsi/zwa/work/syslog-ng-ose-3.0/syslog-ng-ose/src/logproto.c: In function ‘log_proto_plain_server_is_preemptable’:
    /home/bazsi/zwa/work/syslog-ng-ose-3.0/syslog-ng-ose/src/logproto.c:215: warning: unused variable ‘buffer_bytes’

commit 0dc662e60b265bf443f05f77c1c946db41c39733
Author: Fischhof Gyorgy <george@balabit.hu>
Date:   Tue Jul 13 11:20:43 2010 +0200

    Limited number of hexadecimal and octal digits interpreted as one character
    
    * Number of digits in case of hexadecimal: 1-2
    * Number of digits in case of octal: 1-3

commit 1d622f474463446a873c6df11dd9c31152f61ec7
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Mon Mar 8 11:13:40 2010 +0100

    fixed global configuration object possible use after free problem (fixes: #nobug)

commit 5fc46987de65a9f74fcd7ec3e520c8308556b43e
Author: Gergely Nagy <algernon@balabit.hu>
Date:   Mon Jun 28 13:17:45 2010 +0200

    [logreader] Request a reopen if the FD is stale.
    
    After we fstat() a file descriptor, if we get an ESTALE error, request
    a reopen (fixes #21104).
    
    The rationale is, that since the descriptor is stale, the file is more
    than likely moved or deleted, and there's no point trying to continue
    working with it.

commit e868b736dc255b136b8b1b9f9ebdbb64523fe5fb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jun 17 12:09:06 2010 +0200

    logwriter flush
    
    when syslog-ng is shutting down try to flush the queues

commit f76ebe2f6a827531823e40ff29da587df133757f
Author: Pallagi Zoltan <pzolee@balabit.hu>
Date:   Wed Jun 23 10:23:40 2010 +0200

    Fixed default permission if the opened file didn't exist

commit d24eb7f926c3eae0833f66addc90c8065d91a334
Author: Pallagi Zoltan <pzolee@balabit.hu>
Date:   Tue Jun 22 15:40:01 2010 +0200

    Fixed a typo of octal value encoding

commit ff30b3e8ece6272b8b6f7fc1c5ac898f6d1b5666
Author: SZALAY Attila <sasa@mochrul.balabit>
Date:   Tue Jan 19 09:13:10 2010 +0100

    Check in solaris 10 if syslog-ng really running, not just have left it's pidfile. (fixes: #20201)

commit 6b7b8f0c8024c9c88b2d40489a87c4d85df49317
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Apr 20 18:32:38 2010 +0200

    cfg-lex.l: fixed hexadecimal number processing and added \xFF format character literals
    
    There was support for hexadecimal/octal numbers in the lexers, but in
    reality the hexadecimal one didn't work for digits in the 'A' - 'F' range.
    
    Also, since there was already requests I've added support for explicitly
    specifying characters by their numeric value. The syntax supported is similar
    what we have in C/Python:
    
      \xhh to encode a hexadecimal value
      \ooo to encode an octal value

commit a00dee5c1395b8b25e0f97733a00d00210a5ffa0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Apr 16 10:38:13 2010 +0200

    templates: make it possible to include a literal '$' in the template
    
    by using two consecutive '$' signs a single $ is included in the template
    as a literal string.

commit 4dc785f287435e8fac1bf9431ba993cdd8a811f4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Apr 12 20:25:38 2010 +0200

    LogSource: the window size of source connections was messed up if a new connection was established
    
    This patch fixes a window size calculation problem in case a new LogSource
    instance is initialized, which happens if a new connection is established.
    
    This may cause flow control to misbehave.

commit 7bcc56e88bab4ab66cc8c023a062ea49d7b676c4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Apr 12 22:11:29 2010 +0200

    afinter: fixed possible flow-control problem
    
    The internal() driver could go off-by-one the LogSource window size, which
    causes an assertion to fail.
    
    This only happens if the internal() driver is on a flow controlled path.

commit e6ade3fbebb494ef0e0b9cadc2e7a13605871121
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 4 16:06:12 2010 +0100

    config file: accept 3.1 as a config version (or any other similarly well formatted value)
    
    Earlier the "3.0" config-version was hard-wired, and since 3.1
    didn't have a configuration file format change.
    
    Reported-By: Michael <codejodler@gmx.ch>

commit c1f49b4d094a9b3811fa715068cd7d13ad1f767f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Oct 5 06:55:13 2010 +0200

    fixed program_override() setting
    
    There was a typo in the code processing program_override which caused it to
    
    Reported-By: Nat Baldwin

commit cdc47d92a1275397d2f6e7ef5aa59d328ec933cc
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Sep 20 17:19:55 2010 +0200

    afsql: fix port() option
    
    The port() option was passed to libdbi as a string option which libdbi
    interpreted as 0 (e.g.  default port) This patch fixes that.
    
    Reported-By: LEBRETON Philippe

commit f308d2f7a63edc117d9f70c03770183ccb1f1370
Merge: 8bf13c3 79de86e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Aug 6 14:24:50 2010 +0200

    Merge remote branch '3.0/master'

commit 79de86eb23f7ca06cfe8abd1ebfcd72c419bd2cd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Aug 6 13:36:21 2010 +0200

    mark_freq: fixed 100% CPU usage when mark_freq() is changed to 0 during a SIGHUP
    
    If mark_freq() is set to 0 from a non-zero value and syslog-ng receives
    a SIGHUP, it started spinning and emitting MARK messages like crazy.
    
    This patch reinitializes the next_mark_target variable on SIGHUP which causes
    it to behave normally.
    
    Reported-By: Yann Ilas, Marius Tomaschewski

commit f8a8ae5ba67a4add7ed8905fba7c2118d4349b5d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Aug 6 13:49:59 2010 +0200

    csvparser: remove the need to explicitly specify an escaping mode
    
    csvparser will not default to escape-none if it is not specified explicitly.

commit 8bf13c304b6ab5fc1a372b49d55c78370efe14ca
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Aug 2 17:26:10 2010 +0200

    preparations for 3.1.2

commit dc7d07b5881c4f6c94e6f747f4a44779d42b1d20
Merge: 836be62 c88009f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 9 11:27:07 2010 +0200

    Merge remote branch '3.0/master'
    
    Conflicts:
    	NEWS
    	VERSION
    	src/logparser.c

commit c88009fc97b5014e330ecc8ead747691a05b7e97
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 9 10:26:06 2010 +0200

    preparations for 3.0.8

commit 6d1ce4e5bdb517941235f059b556fb6dc9d45363
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 9 10:25:31 2010 +0200

    csv-parser: fixed drop-invalid handling
    
    drop-invalid was not handled properly and caused valid messages
    to be dropped.
    
    The parser drops messages if:
      * not all columns are processed
      * there are leftover characters at the end of the parsing
    
    Greedy columns can be empty though.
    
    Testcases were extended to hopefully cover all cases now.
    
    Reported-By: andrewn at locus.net

commit 836be625d8ab1cfcbf26069bc9cb7b2f083d3fdf
Merge: 89fecc1 9c2c2be
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jul 6 18:00:33 2010 +0200

    Merge remote branch '3.0/master'
    
    Conflicts:
    	src/logparser.c
    	tests/unit/test_csvparser.c
    	tests/unit/test_template_speed.c

commit 89fecc1529fce074b5339be334f7ab0425bf8b82
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jul 3 12:37:13 2010 +0200

    pdbtool: added setlocale in order to accept accented characters in the command line

commit 9c2c2be8b95add3789a91cec25ea92a3bd6ceedb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jun 30 17:41:06 2010 +0200

    logwriter: fix memory leak if the suppressed message doesn't fit into the queue
    
    In case a suppressed message couldn't be inserted into the destination FIFO,
    it was leaked. This patch correctly disposes of the message in this case.
    
    Reported-By: Andy Kitchingman

commit 674a569c470dd01435c044c4b26ce4afe000d3fa
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jun 29 17:41:57 2010 +0200

    test_template_speed: decrease the number of iterations
    
    in order to make the unit test go faster.

commit b6ff55b0955cfe285ac7afe2063f832daed078a9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jun 29 17:41:36 2010 +0200

    csv-parser: fixed greedy + drop-invalid combination
    
    greedy & drop-invalid never really worked well in combination, if they both
    were specified, the message always got rejected. This patch fixes this
    issue.

commit 8c87164ac40257aceaba37ebbc4987c7868ac251
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jun 21 20:04:59 2010 +0200

    affile: fixed flush_timeout() processing for destination files
    
    The patch "logwriter: fixed flush_timeout handling on non-file destinations"
    broke flush_timeout() processing for file destination, this patch fixes that.

commit 1abff81e8da4cb0d767a0d7f7f5f7e36ceb43ab4
Merge: 92bdb39 d85c015
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jun 17 08:57:15 2010 +0200

    Merge remote branch '3.0-local/master'
    
    Conflicts:
    	NEWS
    	VERSION

commit d85c0159fc6cd1dcab2ba19439406e29042b6cf7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jun 6 13:49:52 2010 +0200

    preparations for 3.0.7

commit ed1363ac6c36f6d91a43523eff7ed7ac6a017f9b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jun 6 13:24:48 2010 +0200

    logwriter: fixed flush_timeout handling on non-file destinations
    
    Non-file destinations may not always be willing to accept messages, which
    means that even if the flush_timeout elapsed, the destination may not be
    ready to accept messages.
    
    However log_writer_fd_prepare() basically assumed that once the timeout
    elapses we can immediately start writing messages (which is true for
    file destinations but false for others).
    
    This patch fixes this case.
    
    Kudos to Evan who helped me to track down this issue.
    
    Reported-By: Evan Rempel

commit 5f82516db500209df040215c39da1b5adfc4d143
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 10 17:50:22 2010 +0200

    main: stay in foreground if syntax-check or debug is requested
    
    There's simply no reason to go into the background just to check the
    syntax of the configuration file.
    
    Likewise, debug messages may generate feedback loops in the configuration
    thus it is not safe to enable them unless internal messages are only
    going to the stderr and syslog-ng is configured to be run in
    the foreground.
    
    Reported-By: Corey Hickey

commit 92bdb39b2b2236deaf3e5915261419928dc16c79
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun May 9 13:32:58 2010 +0200

    Revert "logmsg: don't expect a hostname for local transports in the log message"
    
    This reverts commit d8e06f304206aaa9b9e9e62defc6d4f4cfab1505.

commit 13de2c5d1c2d4a6b7af7f7bb72eee7ba103405ca
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 8 14:19:56 2010 +0200

    loggen: added SSL support and the ability to read messages from a file

commit 595538c4b55a5e96b5de9f31fac037025679b548
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 8 14:04:58 2010 +0200

    [loggen] added -q (--quiet) option to loggen, to avoid clobbering the build output

commit 4406ecfbf6b5f1f89b46b2b4d1c6a8f1398e4301
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Mon Mar 8 11:13:40 2010 +0100

    fixed global configuration object possible use after free problem (fixes: #nobug)

commit 11cfa6cdec9073b7c0d33adba0733422d872449a
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Fri Feb 26 15:46:56 2010 +0100

    added upstart syslog-ng config file

commit bd85edb19f9f8f787b10162ab531b125aa5e7038
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 8 13:52:33 2010 +0200

    [unitests] added patterndb v3 unit test (fixes: #nobug)

commit 9db07a83047cc6a665f2152ae8c16cd9e5a669a4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 8 13:47:59 2010 +0200

    [tests] renamed patterndb unit test to reflect the patterndb version

commit e742d478f4a9ac7cb53f31893ea167c24a4e4e07
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Tue Feb 23 10:05:19 2010 +0100

    [patterdb] fixed patterdb reload function (fixes: #TK-06589)
    
    If the new pattern db file is not loadable,
    then syslog-ng will not drop the old one.

commit d2bf600b0565412b2737755a640cfab1c7140f8c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 8 13:27:36 2010 +0200

    [control socket] the control socket can set with a parameter

commit 01808d5accf701979c9410d9aed07ea71449c25d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 8 12:45:12 2010 +0200

    update-patterndb: new command to generate the patterndb from a set of patterndb snippets
    
    The update-patterndb script can be used to generate the pattern database
    file to be used by syslog-ng based on a set of patterndb snippets stored in
    /etc/syslog-ng/patterndb.d

commit 36ec94f2acd0bf53124c89b92955c57d71bbee43
Author: Juhasz Viktor <jviktor@balabit.hu>
Date:   Wed Feb 10 11:39:23 2010 +0100

    [test_performance] use tail -n +1 instead of tail -1 because this doesn't work in hpux-11
    (fixes: #nobug)

commit f8a2de9a7aea5b6b8d9923e57f453592103d18ab
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri May 7 09:52:18 2010 +0200

    remove all syslog.h references

commit e7b7bb1aa43a9ee8e477c1f425a951d4f5965382
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 8 13:48:46 2010 +0200

    test_resolve_pwgr: fixed compilation warnings
    
    .../tests/unit/test_resolve_pwgr.c: In function ‘main’:
    .../syslog-ng-ose/tests/unit/test_resolve_pwgr.c:8: warning: pointer targets in passing argument 2 of ‘resolve_user’ differ in signedness

commit 644d3453ccd050a9fb929a90ba0174c967a02b19
Merge: d8e06f3 6113023
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed May 5 12:04:41 2010 +0200

    Merge commit '3.0-local/master'
    
    Conflicts:
    	NEWS
    	VERSION
    	src/misc.h
    	tests/unit/Makefile.am

commit 6113023acd0ebb3a91c98e7d733952afb12e598d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed May 5 11:38:48 2010 +0200

    introduce a new syntax to skip owner/group/perm setting on a per-file basis
    
    This change was originally an intended behaviour, but due to a design
    problem how global options were inherited to a per-destination basis
    at the end it wasn't.
    
    The documented behaviour to skip owner/group/perm setting on a given file
    is to use "-1" as the value, however this only gets applied if _both_
    the per-destination and the global values are "-1".
    
    E.g. if you want something like:
    
    options { owner("adm"); };
    
    destination d_file_def { file("/var/log/default-owner"); };
    destination d_file { file("/var/log/no-owner" owner("-1")); };
    
    The intention with a config like this is ambigious:
      * the logical outcome would be to tell syslog-ng not to touch the
        ownership of the "no-owner" file in any way
      * the reality however is that "adm" ownership would be applied to
        "no-owner" as well, since the "-1" value is used internally in syslog-ng
        to indicate that no per-destination value was specified.
    
    The only way to tell syslog-ng not to touch the ownership of a file is to
    set the global setting to -1 and either set -1 for the destination, or omit
    the setting (which defaults to -1).
    
    Since it would be tricky to fix this without incompatibilities, I've decided
    not to make any, and introduced an additional syntax, which I think is
    easier to understand than the original trick with "-1":
    
    destination d_file { file("/var/log/no-owner" owner()); };
    
    This means that the file ownership shouldn't be changed regardless of the
    global setting. Internally this is equal to "-2", so the above is equivalent to
    
    destination d_file { file("/var/log/no-owner" owner(-2)); };
    
    But that's an implementation detail, you don't need to know.
    
    Please note that this patch depends on the parent patch as well, without
    it, it won't function properly.

commit 8eac35f1a66d7775a00e309ad0e7b1a745e2e608
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed May 5 11:27:40 2010 +0200

    Make sure that negative values never get resolved using getpwnam/getgrnam
    
    Originally reported by the SUSE maintainer, syslog-ng is sometimes resolving
    invalid usernames using getpwnam/getgrnam. Before this patch,
    syslog-ng first attempted to resolve usernames using NSS, then if that failed
    tried to interpret them as numeric values.
    
    This logic was reversed, now we first check if it is a number, then if that
    fails do we proceed with resolving the username using getpwnam.
    
    Once here, I've also did some cleanups to make the bed for a follow-up patch:
      * change all uid_t/gid_t/mode_t variables to "gint" instead of their
        respective types, to make sure that we can represent negative values
        there
      * all occurences which tried to interpret uid/gid/mode information was
        changed to interpret all negative values the same as -1 (do nothing).
        This makes it possible to use further extremal values in the future.
    
    The original report came with a patch, but the original goal
    was completely reimplemented using a different means by Balazs Scheidler.
    
    Reported-By: Marius Tomaschewski

commit cb6f0452fc5748fdfa64fdbd5ec01f41cb83170f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed May 5 10:10:05 2010 +0200

    SIGHUP handling: block SIGHUP while reload is being carried out
    
    Reported by the SUSE maintainer that it is possible for syslog-ng to receive
    multiple SIGHUP signals while the reload operation is being carried out.
    
    This patch changes SIGHUP/SIGCHLD processing to block these signals while
    handling the signal is being done.
    
    Reported-By: Marius Tomaschewski

commit d8e06f304206aaa9b9e9e62defc6d4f4cfab1505
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 3 16:51:52 2010 +0200

    logmsg: don't expect a hostname for local transports in the log message
    
    syslog-ng expected the same message format for both local and network
    transports. However this seems to cause problems for applications that
    embed a space in their $PROGRAM field, e.g.
    
    logger -t "alma korte" message
    
    Since we know that $HOST is always empty for local log transports
    (checked for Linux, FreeBSD, AIX, HP-UX and Solaris) we can simply
    assume that even if there's a space it is not a hostname, but rather
    an incorrectly formatted $PROGRAM.
    
    This will be recognized as:
    
    $PROGRAM = "alma"
    $MSGHDR = "alma "
    $MSG = "korte: msg"
    
    E.g. if it is formatted with the default template, it becomes the same as it
    was received.
    
    Reported-By: Marius Tomaschewski

commit 29ce812d5047021eb0269996df389d1d6b250cde
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 3 16:43:35 2010 +0200

    logmsg: always store the legacy message header (MSGHDR)
    
    This patch essentially makes the 'store-legacy-msghdr' behaviour
    the default and creates a new 'dont-store-legacy-msghdr' flag to return
    to the 3.0 compatible behaviour.
    
    This patch introduces some incompatibility, however I feel that since the
    'store-legacy-msghdr' flag is the assumed behaviour, it is best to make it
    default. The only reason it existed in 3.0 is the expected performance
    drop, but the 3.1 NVTable refactorizations solved that issue.
    
    It is also needed for the follow-up patch to work properly.

commit bf76c1bef8a62d5eec7f59ec22349aba5d931c0b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 3 10:02:43 2010 +0200

    don't cache the local hostname accross SIGHUPs
    
    Reported by the SUSE maintainer, syslog-ng caches
    the local hostname accross SIGHUPs, which causes problems when
    dynamic hostname configuration is in use (e.g. DHCP). This patch
    relookups the local hostname when a SIGHUP is received.
    
    Also, there was a bug in the per-source use_fqdn() processing which
    is fixed by this patch: earlier, if two sources used use_fqdn()
    differently the one which received the first message won and the
    hostname was set according to its settings, even if the message
    was received on the other source.

commit 8747d74491eac3fdf5052194f47a68e659633ca9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 11 15:52:46 2010 +0200

    fixed linker error in syslog-ng-ctl on Solaris
    
    gcc -std=gnu99  -g -m64 -I/opt/syslog-ng/include -Wall  -Wl,-R/opt/syslog-ng/lib -L/opt/syslog-ng/lib -o syslog-ng-ctl syslog-ng-ctl.o gsockaddr.o gsocket.o -L/opt/syslog-ng/lib -lgthread-2.0 -lpthread -lthread -lrt -lglib-2.0 -lintl -liconv   -lpthread
    Undefined                       first referenced
     symbol                             in file
    bind                                gsockaddr.o
    accept                              gsocket.o
    socket                              syslog-ng-ctl.o
    setsockopt                          gsockaddr.o
    connect                             gsocket.o
    inet_aton                           gsockaddr.o
    inet_pton                           gsockaddr.o
    inet_ntop                           gsockaddr.o
    ld: fatal: Symbol referencing errors. No output written to syslog-ng-ctl

commit d9fd45fc6f8f09099f34c1a7008c4ccc57c398f5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 11 10:55:29 2010 +0200

    preparations for 3.0.6

commit 600a42ace1c34d011b58a0e7059b407b5dfa13da
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 11 10:34:20 2010 +0200

    preparations for 3.1.1

commit 0fed21453d7adb2a2befd534d1dea72b1d5599ee
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 4 11:09:22 2010 +0200

    template: added TAGS macro support
    
    which expands to a set of comma separated tag values

commit 9c5b0c1edba671876fe50c5dad38fef675f92892
Merge: 47256a0 0038c47
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 4 10:50:24 2010 +0200

    Merge commit '3.0-local/master'

commit 0038c47121e6b00e2b8b986750b06a2b634d4431
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 4 10:42:38 2010 +0200

    [csv stats] if a column contains ';' or '\n' character put the column between quotes.  (fixes: #20454)
    
    if the column must be quoted then escape the quote chars.
    SSB has to use this csv format.
    Escape the quotes if it begins with quote.

commit 76fba26d259036f0b6ffc6aafb5ca24a2d186594
Author: Juhasz Viktor <jviktor@balabit.hu>
Date:   Sun Oct 25 02:15:17 2009 +0100

    [timestamp] solving the daylight saving problem (fixes: #20182)
    
    The problem was that the local services (CRON, dnsmasq) sends BSD timestamp
    which hasn't any zone information and we assumed that there wasn't daylight
    saving, so set the tm.tm_isdst to -1.
    
    The solution is that let's assume that the correct tm_isdst value is what we
    get from the current local time.
    
    If timezone isn't set, use the local one
    and calculate the correct time

commit 47256a01a99af3e43674cbb663fb6ae7cda854cd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 29 17:09:11 2010 +0200

    [affile] pipe/file mismatches are reported as warnings instead of errors

commit ea4329defd058078fab614caeebc044249640603
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 29 17:08:45 2010 +0200

    added missing tgz2deps file

commit 2328040fc2f953bb1e93d7755e251ce56ea2f931
Merge: 3cf6259 81f27c2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 22 10:12:59 2010 +0100

    Merge commit 'mainline--3.0/master'

commit 81f27c22e3f6b0f8f6148bdc6e98d1491b80d128
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Mar 19 13:27:39 2010 +0100

    affile: fixed a possible infinite loop if pipe driver is used for a non-pipe device
    
    In this case the file descriptor representing the pipe is not initialized,
    but success is returned. This causes the main poll() call to return with a
    failure condition repeatedly, which in turn tops up the CPU at 100%

commit f837b6ec4773bce242c2bfe14ca18b38710b8383
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 22 10:04:55 2010 +0100

    [solaris init scripts] save the coredump into the $DUMPADM_DEVICE only if it exists
    
    when this environment variable is valid (not 0 length and device exists)

commit 563fd7f7a76016d0bc7902d23902bba7deadd801
Author: SZALAY Attila <sasa@mochrul.balabit>
Date:   Tue Jan 19 09:14:02 2010 +0100

    Remove pidfile if syslog-ng not ronning to make it sure that start_daemon start it. (fixes: #D-01423)

commit 359eeb4796831f1eca746177eeaee60488057457
Author: SZALAY Attila <sasa@mochrul.balabit>
Date:   Tue Jan 19 09:13:10 2010 +0100

    Check in solaris 10 if syslog-ng really running, not just have left it's pidfile. (fixes: #20201)

commit 3cf6259b1f808068299aa0a6eed054789cb803d1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 18 09:14:10 2010 +0100

    explicitly enable PCRE support and specify pcre as a tgz2 build dependency

commit 7fe014876f116b815127ead2860ab906740d0b9a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 18 08:33:03 2010 +0100

    enable PCRE support

commit 6f987f9e24bf1c19544528ae017eb52c4ba00db0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Mar 16 17:21:03 2010 +0100

    preparations for 3.1.0 release

commit e5f26732a5b72710c440d29e02b5e55b69d2da92
Merge: 0b7d5ee 8495031
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 15 07:12:16 2010 +0100

    merge 3.0 fixes
    
    Merge commit '3.0-local/master'
    
    Conflicts:
    	NEWS
    	VERSION
    	src/apphook.c
    	src/logmpx.c
    	src/logmsg.c
    	src/logmsg.h
    	src/logpatterns.c
    	src/logqueue.c
    	src/logwriter.c
    	tests/functional/test_sql.py
    	tests/unit/Makefile.am

commit 0b7d5eef24d02eedeb3b266b2e1d554fc5025bf9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Feb 18 22:37:36 2010 +0100

    added globals.o to the link command line
    
    This seems to solve an issue with MacOSX linker, probably some kind of
    circular dependency that other linkers handle, but this one isn't.
    
    Hopefully this doesn't break other platforms.
    
    Reported-By: Mark Duling

commit 7b446e59111e6d0edb4e45a42dc620e5e89bf050
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 14:09:44 2009 +0100

    test_sql: hopefully the final sleep() adjustment to make the test pass
    
    As it seems the sleep() encoded in the check_sql_contents() function
    is skipped if the daemon is already stopped, thus syslog-ng didn't
    have enough time to flush the sqlite tables before the testprogram
    checked it.

commit 89577325b191f6ca029826971bf0744d495ef3a7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 13:36:30 2009 +0100

    The flow-control flag was sometimes enabled even if not requested by the user
    
    In case a final or fallback flag was enabled on a log statement, it could enable
    the flow-control on the same level.

commit 59397522c3c7fe5b9affcff3c5a499dfb66db623
Author: Tamas Pal <folti@balabit.hu>
Date:   Mon Nov 30 13:27:48 2009 +0100

    Added version checking for pcre.

commit 0fb7348dd5625be5b38e55107f1615246d4bfe45
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Mar 14 10:32:37 2010 +0100

    log_msg_format_sdata: fixed possible segfault for incomplete SDATA variables
    
    SDATA variables are in the form: .SDATA.ID.PARAM, and the formatting code
    didn't handle if a dot was missing from the expected format.
    
    This could only happen via a user-specified rewrite rule, otherwise the
    protocol parser always ensured that the .SDATA variable is in the
    proper format.

commit 84950319f09d76bed8d2f98397d25c9d813cabe3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jan 29 12:22:52 2010 +0100

    Fixed a possible segmentation fault in AF_UNIX destinations
    
    This bug affects platforms which crash on NULL reference
    in sprintf strings (Solaris, Tru64).

commit d47259a388ed4beb30efe0f0e1da83a47f8ff074
Author: Tamas Pal <folti@balabit.hu>
Date:   Fri Dec 18 13:49:43 2009 +0100

    [configure.in]: configure checks for C99 compliant C compiler.
    (cherry picked from commit c07446119525aac2ec756539fcde91ce3109f856)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 2fcd309f18c2cb296d8963475c47d302eddf0538
Author: Tamas Pal <folti@balabit.hu>
Date:   Fri Dec 18 13:49:32 2009 +0100

    Ported to Tru64. tgz2build uses $(MAKE) everywhere and supports Tru64.
    
    (cherry picked from commit c7384d0785cf1ea65c4bfc2e790b2304ef83b094)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 8888899122ac79d37b54d2d8b778dd29bfb26353
Author: Tamas Pal <folti@balabit.hu>
Date:   Thu Dec 17 11:09:10 2009 +0100

    added solaris 10 refresh support (fixes: TK-05128)
    (cherry picked from commit 0b8848d4505d746af006edd23a1fa90dbc3d407a)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit a2826681a4fd123d4309265275d5f9bac1ae2325
Author: Juhasz Viktor <jviktor@balabit.hu>
Date:   Wed Dec 16 13:25:00 2009 +0100

    [afsql] Don't get the error message from dbi because it can cause segfault

commit 2cba6f01ea4426f8148b8efc93ec4a77b622d522
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Tue Dec 15 16:22:29 2009 +0100

    [functest] fixed sql functest to use .so on ia64

commit 4d29dc81ec07b2175a6fb0715ceee06cefcf9e8f
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Tue Dec 15 11:40:32 2009 +0100

    [msg encoding] drop the connection on conversion error (fixes: #TK-05131)

commit be7736386ed6d0f326bffe7d2261c90b2f5e984b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Mar 12 09:26:46 2010 +0100

    [sdata parser] fixed off-by-one overflows in structured data parser
    
    When parsing SDATA ID, param and value from the input an off-by-one
    occurs which means that an extra zero byte is written on the stack.
    
    This is clearly a possible DoS situation, but further exploitation is
    not believed to be possible.
    
    The overwritten areas on x86 CPUs:
      * param becomes a zero string if value is overflown
      * ID becomes a zero string if param is overflown
      * the LSB byte of a read-only pointer becomes zero if ID is overflown
    
    Other CPUs may use a different stack ordering.
    
    Reported-By: András Tevesz

commit b63993405a2969fb38d6f1adf41792fe110edd3d
Author: Andras Mitzki <micek@balabit.hu>
Date:   Tue Dec 15 09:45:35 2009 +0100

    Changed in logwriter test case. Modified the template, and the expected result in BSD case.

commit fbbf3960197b2d2a6fe4890dae9f12efc0b73e5c
Author: Juhasz Viktor <jviktor@balabit.hu>
Date:   Mon Dec 14 17:03:46 2009 +0100

    [afsql.c] If sql driver can't insert the message into the database it disconnects from database
    and reconnect after time_reopen time elapsed. After 3 attemps the message will be dropped
    (fixes: #16632)

commit 8457000d13404f38a94996914722c5f9a5f45d11
Author: Andras Mitzki <micek@balabit.hu>
Date:   Mon Dec 14 14:03:50 2009 +0100

    main: avoid using g_poll() symbol directly as it is not defined in glib 2.14
    
    Instead of referring to g_poll() directly, use g_main_context_get_poll_func()
    before setting it.

commit f6e59c7bba0d0a3ee4362becf1737c61581e928f
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Mon Dec 14 09:31:53 2009 +0100

    [unit test] added some sd data unit tests
    
    message part length validation
    sd invalid character validation
    sd escaped character validation

commit e2bbfc37e55a335f14aa7e532881cef277d2d74e
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Mon Dec 14 09:30:35 2009 +0100

    [sd parser] added ']' as ivalid character
    message parse will fail if the sd data value contains unquoted ]

commit fb87e597e4ea2e3841d5bd65e4c2e7b8658f6a32
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Fri Dec 11 14:26:25 2009 +0100

    [timeutils] replaced g_get_current_time with cached_g_current_time in the main thread
    
    added main_context_poll witch will do the poll and update the static timestam used in the log_msg_init
    this will reduce the g_get_current_time calls and add some speed up the centos

commit 8eacbbd9403972bdfeda87dc49c71089c0f42ea5
Author: Juhasz Viktor <jviktor@balabit.hu>
Date:   Wed Dec 9 17:35:42 2009 +0100

    [test_logwriter] new unit test which tests the log_writer_format_log function

commit 6342244e702a04d5d6deb3a76b9e55bc4cb71c57
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 11 14:13:01 2010 +0100

    [logproto] Added structured data escape handling in RFC5424

commit c96f2cd8436781a1040af73a1176381e9511d387
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Wed Dec 9 15:25:13 2009 +0100

    [sdata] fixed sdata lookup to work with multiple "." in the name

commit 7f50b47daa5c4c5948e47e83430eeb6409b105b4
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Wed Dec 9 15:23:45 2009 +0100

    [compat] added memrchr implementation in compat.c

commit f250514126b8d63001015a36f13c5dd54f2253f8
Author: Juhasz Viktor <jviktor@balabit.hu>
Date:   Wed Dec 9 11:33:45 2009 +0100

    Fixed how syslog protocol parser/formatter handling empty lines (fixes: D-01200)

commit 428be867f75be1f8dc6aabd5511932e82ba2e673
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Fri Nov 13 16:55:36 2009 +0100

    [logproto] fixed posible message loss in framed message processing
    
    If the client sent us some data with full messages and a half message
    the framed server read it but some parts may not be parsed until the next
    fetch data call. If the syslog-ng is stoped in this state it may loose messages.

commit ab9aa3fb01f7baf42dc23db544cc5cba27a30f57
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Fri Nov 13 16:30:26 2009 +0100

    [logproto] fixed copy paste bug in log_proto_framed_server_prepare function

commit 90aca21eed47c3ae47c4e78cfb7c7a86942a5fd1
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Thu Mar 11 14:11:25 2010 +0100

    [func_test] added RFC5424 functional tests

commit 3bb6aee1a7448d9ec5e5436e7868fb62b1086a01
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Mar 6 10:19:26 2010 +0100

    accept lower case letters as macro name even when not using braces
    
    To access all name-value pairs, the syntax ${macro_or_value} is preferred,
    especially if the value name contains a '.' character.
    
    However the old syntax $macro_or_value could also accept lower case
    letters, which it didn't without this patch.
    
    Reported-By: Patrick H.

commit 04d189e3df201b7173e4474b0be9e794514f76f1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Mar 5 13:07:02 2010 +0100

    fixed keep_hostname(yes) handling on local sockets
    
    Local applications do not send a hostname as they send it to syslog-ng on
    /dev/log. However syslog-ng should in this case automatically insert one,
    which it didn't since the NVTable reorganization.
    
    Reported-By: Peter Höltzl

commit e13d43f28ab2f4ea002cccd9d2d2a46c909c8f73
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Feb 18 22:37:36 2010 +0100

    added globals.o to the link command line
    
    This seems to solve an issue with MacOSX linker, probably some kind of
    circular dependency that other linkers handle, but this one isn't.
    
    Hopefully this doesn't break other platforms.
    
    Reported-By: Mark Duling

commit b24e685f1ca6df2aaa46b3824fe93259b7983130
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 21 16:46:31 2009 +0100

    afuser: fix a possible buffer overflow if the utmp entry contains an overly long tty name
    
    This is theoretical as the utmp entry only contains 32 characters
    (at least on Linux, other platforms unchecked) and the contents of
    the utmp is already managed by root anyway.
    
    But better safe than sorry, thus it is fixed.

commit bb2985925eed6532388eb899f7c25231ddb9c9a2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 14 10:44:56 2010 +0100

    syslog-ng-ctl: added command to query, enable/disable syslog-ng debug/verbose/trace flags

commit 4f97ae3b764ab2fb477cfa63029cef7ef33c2eb1
Author: Marton Illes <marci@balabit.hu>
Date:   Wed Dec 23 15:23:55 2009 +0100

    syslog-ng-ctl: handle EOF on control socket

commit 0bd1b2fdd391eca6a04ba5624c9c2f3ac5d84414
Author: Marton Illes <marci@balabit.hu>
Date:   Wed Dec 23 14:14:34 2009 +0100

    syslog-ng-ctl: create syslog-ng-ctl command to run-time control syslog-ng

commit f92de6e0321456ef18e6ab0c39c1965482f04784
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Dec 22 17:55:16 2009 +0100

    [pdbtool] added pattern match debuging with colorized and parsable output

commit 4ae11c2ac36b7dd9ece371727793f6585be1c377
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Dec 22 17:53:29 2009 +0100

    [pdbtool] added logging command line options using msg_add_option_group

commit 052e1ca96bccf48af542ba69b86bb32324e38397
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 14 10:34:25 2010 +0100

    [pdbtool] added tags and stat initialization

commit 487de7d4a1e31510d938c99410881beb4b147f6e
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Dec 22 17:47:53 2009 +0100

    [patterndb] created a debug version of radix lookup to troubleshoot patterns

commit 4d6b4afccf51789e6c2a612ed1a66cc8c5f7d845
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Dec 22 17:29:27 2009 +0100

    [pdbtool] fixed "Error parsing command line arguments" message

commit bbc248bc8a577a299036d2ab6898d72f657fc7a0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 14 10:11:33 2010 +0100

    logproto: added log message about EOF in the new style syslog protocol handler

commit e719988e0e0716f2366b8d4faa340bbf42aacf3a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 14 09:59:03 2010 +0100

    config parser: accept comments/empty lines before the version mark
    
    This patch implements functionality to accept empty lines and lines beginning
    with a '#' before the "@version" mark.
    
    Reported-By: Paul B. Hanson & Guillaume Rousse

commit 4c436b2b3689832de4ce3b2a476b657850bfb674
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Dec 18 09:25:43 2009 +0100

    preparations for 3.1beta2

commit 9ef6062c1cf72a3f7da880ac245f9ee080bea992
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 15 17:09:50 2009 +0100

    fixed another memory leak, patterndb had an unused GPtrArray allocated
    
    The match_names array is not used in the new LogMessage payload structure
    however an allocation has been missed when deleting the unneeded code.
    
    Reported-By: Martin Holste

commit bb3301baa8c3324cbb899e1a8b08a1955fe47d39
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 15 14:08:27 2009 +0100

    Fixed memory leak when resolving the sender's hostname
    
    Thanks for the reporter for producing a valgrind log, it was a trivial
    memory leak that was caused by the fact that one of the internal APIs
    were changed: instead of requiring a caller-allocated string, it now
    only requires read-only access to the string.
    
    Reported-By: Martin Holste

commit ce0943c87b1e40e362b1466ffd6e29c5dde833e2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Dec 11 10:22:08 2009 +0100

    logproto.c: fixed compilation warning
    
    /home/bazsi/zwa/work/syslog-ng-ose-3.1/syslog-ng-ose/src/logproto.c: In function ‘log_proto_plain_server_is_preemptable’:
    /home/bazsi/zwa/work/syslog-ng-ose-3.1/syslog-ng-ose/src/logproto.c:215: warning: unused variable ‘buffer_bytes’

commit 8c7349439344abef821426c7be6f41bcdc419088
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Dec 11 10:23:49 2009 +0100

    pdbtool: only link against libs that are strictly necessary
    
    flex (more precisely -lfl) caused linking problems as that requires yylex()
    as a defined symbol, which pdbtool doesn't define.
    
    Make sure that we only link against the libs that are strictly necessary to
    avoid this.
    
    Reported-By: Marvin Nipper

commit e74825508d0067352647b9001ec56182db829d70
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 17:47:35 2009 +0100

    added some late-minute changes to the NEWS file

commit 57ca727378d2c78192a338a5bf3e55a45e09d436
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 17:23:24 2009 +0100

    pdbtool: fixed date header in the converted database to contain zero padding

commit e6e0427db4e771b388acad996bacf6f2c0ceb8f5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 17:22:55 2009 +0100

    fixed SDATA handling in case the SD-ID or SD-PARAM uses a dot in its name
    
    Enterprise assigned SDATA fields can have dots in their names, which prevent
    the proper formatting of structured data fields.
    
    I've used a trick in this case: since the ${.SDATA.xxx.yyy} format used
    to reference structured data fields becomes ambigous once xxx or yyy contain
    a dot, we need to store the length of the SD-ID. This is now stored
    in the NVHandle flags space.
    
    The problematic case is for example:
    
    .SDATA.Events.1234.Param
    
    In this case it is not possible to tell from the value name alone whether
    it is "Events.1234" . "Param", or "Events" . "1234.Param", however it is
    not realistic to have a real-life collision.

commit 81b52d4aa0ea14f513e5aac2191e82a1e811a520
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 17:18:38 2009 +0100

    fixed structured data escaping on output
    
    SD values were not properly escaped on output, this patch fixes that.

commit 1601a95cdceb0bd48ca16a241efa5fca46ab3da5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 17:16:51 2009 +0100

    fixed structured data escaped character handling

commit f2fd7457627a88eb9602a73a5c16cd8b2434b667
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 14:09:44 2009 +0100

    test_sql: hopefully the final sleep() adjustment to make the test pass
    
    As it seems the sleep() encoded in the check_sql_contents() function
    is skipped if the daemon is already stopped, thus syslog-ng didn't
    have enough time to flush the sqlite tables before the testprogram
    checked it.

commit d1235e5226a72eca44738a3d65edaed8d3f3ac84
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 13:47:54 2009 +0100

    fixed rewrite rule processing
    
    In some cases rewritten messages could propagate over branches where they
    shouldn't have been changed.
    
    This patch introduces a new message flag "LF_REFERENCED" that indicates that
    a given log message was cloned _or_ is sitting on a message queue waiting
    to be processed. Whenever we encounter such a message, we always clone that
    instead of refing it.

commit 495bdc3690fe1c01ed95b29f16e97829444973ee
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 7 13:36:30 2009 +0100

    The flow-control flag was sometimes enabled even if not requested by the user
    
    In case a final or fallback flag was enabled on a log statement, it could enable
    the flow-control on the same level.

commit f90b66797412a7a52bbda76e69190a916b5c33fb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Dec 4 09:59:35 2009 +0100

    func_test: increase SQL timeout

commit 2a7d4e08c20603601ecc4dbc2ea5fd96c2ce58b6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 3 18:22:21 2009 +0100

    updated NEWS file with the latest changes

commit caa6c716f8261e3a53ca5e11033d2e5cb23d9ed9
Author: Tamas Pal <folti@balabit.hu>
Date:   Mon Nov 30 13:27:48 2009 +0100

    Added version checking for pcre.

commit f111f885fc3e6ad35826447e1aa66eb59019d0b9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 3 18:20:35 2009 +0100

    preparations for syslog-ng 3.0.5

commit 981c5dac7e7732d7f314f0766e16ced7ce4c2b95
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 3 18:10:06 2009 +0100

    Fixed heap corruption problem in a more workable way
    
    The previous fix (196223af64d2bd09f41123313884b71cdd41bbd5) does not work
    because that patch remove state->current_program in situations when it is
    needed.

commit 3412dce0235e8d65bc3bebedffe8ff6bed02f45b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 1 17:12:38 2009 +0100

    fixed a memory leak in test_clone_logmsg

commit 838c4f544202f8ffa6c36019fabcbadc30d3e9e4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 1 17:02:25 2009 +0100

    nvtable: don't store static NV name part
    
    Instead of storing the NV pair name in case of static entries, assume those
    will be looked up using the NVRegistry. Since static entry IDs will
    not be dynamically assigned, this information is redundant, and spares
    us a few bytes/memcpys.

commit ec49dcdf31d293bbd11ac9c84a7040e3a7919643
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 1 16:46:56 2009 +0100

    logmsg: fixed possible leak when storing the LEGACY_MSGHDR value
    
    Since the LogMessage reorganization, log_msg_set_value() only needs a
    borrowed reference, no need to strdup it.
    
    This means that if you enabled store-legacy-msghdr flag on the source,
    it'd leak memory for every message.

commit e34e041467686fc14cb6868e376bd08c68d9838c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 1 16:45:27 2009 +0100

    added updated manpages.

commit e07709da9cbc3b946d11a35e5ce2c35053edf021
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 30 10:47:10 2009 +0100

    LogParser: make sure the LM_V_MESSAGE pointer remains valid accross parsing
    
    Since parsers add values to the LogMessage being parsed, it is perfectly
    normal to have their payload reallocated in case the parsed values do not
    fit into the currently allocated payload.
    
    log_parser_process() passed a borrowed reference to the parse function,
    which in turn could be invalidated in case this reallocation took place.
    
    The solution is to add a reference to msg->payload, and unref it at the end
    of the parse call, which makes it unnecessary to copy the message.

commit 748987fcaad126fbb0c7f5bb7772e7bf1c5725bb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 30 10:45:04 2009 +0100

    nvtable: make NVTable reference counted
    
    As a preparation of a LogCSVParser bugfix, NVTables need to be reference
    counted. This patch implements that.

commit 4a2555590f2191d9eda90dfb99b340086e45b064
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 29 16:25:57 2009 +0100

    updated NEWS for 3.1beta1

commit 7bc779fdf281de0021e6e49e5efc592505c7220e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 29 16:24:21 2009 +0100

    pdbtool: stylistic changes

commit 20dd89661ced807b1b78ee7acd8378a2457d44ef
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 29 16:24:10 2009 +0100

    pdbtool: call NV registry init and db_parser init functions

commit 90f2677deada4e915fc548372305c53651aabf65
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 29 16:22:54 2009 +0100

    radix: do not try to register zero-length name-value handles

commit 97c9d23b3d14ecebeedf6db76d81bd46d8642831
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 29 16:22:39 2009 +0100

    logparser: new log_dbparser_global_init() function
    
    Earlier the class and rule_id values were registered in a post_config
    hook, however pdbtool doesn't have that, but still it needs to have
    these handles registered.

commit 922e5c0d6a2dcc1ee4e3bdf4841a9df1b8cf1ff8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 29 16:20:51 2009 +0100

    logmsg: create a separate log_msg_registry_init()
    
    pdbtool doesn't have the stats subsystem initialized, thus it cannot call
    log_msg_global_init(). Separate the two functions so that pdbtool
    can call log_msg_registry_init()

commit f4c317fba0283dd06bdcb0e056851d5c629f3b0d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 28 19:16:04 2009 +0100

    preparations for 3.1beta1

commit 7c485e74a9e72e63e1b4b12fe6a14e77338894b6
Merge: 07a51cd c41bda9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 28 19:15:24 2009 +0100

    Merge commit 'mainline--3.0/master'

commit 07a51cd6a811ab8f7d007a21734e672174f9b9af
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 28 19:10:49 2009 +0100

    test suite: small fixes to avoid test failures on some platforms

commit c41bda9a49544d68662b170a859a63f9a7d5ad59
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 28 19:07:58 2009 +0100

    afsql: keep the message queue upon SIGHUP processing
    
    Earlier the queue was dropped if a SIGHUP was received, possibly
    causing messages to be dropped.

commit f619551a37b360542d981dfb77f09f0c8d21d8a9
Merge: 381c3b6 2e93a54
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 28 18:23:40 2009 +0100

    Merge commit 'mainline--3.0/master'

commit 2e93a54d46dd65bca0e0e96440ca376afc1215e4
Author: Tamas Pal <folti@balabit.hu>
Date:   Mon Nov 23 15:04:29 2009 +0100

    Fixed: syslog-ng fixed HP-UX 11iv2 compilation
    
    An earlier untested patch was published on the mailing list, but wasn't
    confirmed by the user in question and it turned out it didn't work.  With
    this patch it should be better.

commit d9595c13adcf864d21ea062d4b9bdd6bcda5b593
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 28 17:21:32 2009 +0100

    tgz2build/rules: modified to allow build on legacy Linux systems. (fixes: TK-03864)

commit a478ef1fdc291def28e87a222069579c51f52f9d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 28 17:15:17 2009 +0100

    test_zone: do not fail on ancient libc versions
    
    The timezone files on Debian potato are not yet updated with the latest US
    zone changes being effect since 2007.  These tests failed on Debian potato,
    comment them out.

commit caa14b6469a80ca2fe62b144914d70d11442793d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Nov 27 17:18:53 2009 +0100

    [test_zone]: test no longer fails, if timezone file missing(fixes: TK-03849)
    
    (cherry picked from commit 8b1b8ca0805e8cdfe0981b5b47a528cc6dbf5f48)

commit 381c3b67e3762579cbcec4e8641aff12c4700fef
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Nov 27 17:11:42 2009 +0100

    fixed some compilation issues on various platforms
    
    This patch fixes some warnings/errors after compile testing it on a bunch
    of different systems.

commit 02ba8525c9147a9c7d8a0aa8b17ebf0ff982b703
Merge: 64670df 1d7aafd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Nov 27 15:27:40 2009 +0100

    Merge commit 'mainline--3.0/master'
    
    Conflicts:
    	src/compat.c
    	tests/unit/Makefile.am
    	tests/unit/test_template_speed.c

commit 1d7aafd4ebfc7c18ed4402148febb44b274e9ab9
Author: Viktor Tusa <tusa.balabit.hu>
Date:   Wed Nov 11 13:22:24 2009 +0100

    Fixed a possible race in file driver preemption, where wildcard driver couldn't change
    file, if it read message without EOL larger than buf / 10.

commit e8b1226b5381c5c0ad5f8094bd12e45b2d53a49c
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Thu Nov 5 15:34:54 2009 +0100

    [afsocket] fixed syslog over udp and framing issue (fixes: #19639)
    syslog-ng used framing in dgram transports

commit d25ad4f5373a6a4bf2f1f5ed37147a10412fe30d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 20:36:26 2009 +0100

    [test_sql]: properly checks the existence of sqlite3 and libdbd-sqlite3.

commit 5c9f64be5b6655e465b7ef5f3c8e5622ef8fd8e9
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Thu Nov 26 20:45:30 2009 +0100

    [init-funtions] added lsb/init-func include to fix the log_*_msg calls
    
    If the /lib/lsb/init-functions file exist on the system, it will override
    our log_*_msg functions and the other management functions will overriden
    by our functions

commit e14326465d58618df290cdbb87cfae225e3f4721
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 16:43:25 2009 +0100

    [main] display installer version along with syslog-ng binary version number
    
    Sometimes the binary packages are re-released with the syslog-ng binary
    unchanged. Thus it is important to display the installer version in
    this case as well.
    
    This patch reads this information from $prefix/etc/install.dat which
    is created by the installer.

commit caf78edb0ea13ccd0f200451bc6e73268c0ba17e
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Fri Oct 16 11:28:15 2009 +0200

    [ASA timestamp] fixed ASA timestamp parser bug on HP-UX
    
    strptime returned NULL on HP-UX because of the last whitespace character

commit 9f1fad96b65e4ccf0f483ac0d985a5991fdf407e
Author: Tevesz Andras <ghost@balabit.hu>
Date:   Tue Oct 13 14:42:06 2009 +0200

    [compat] added __strtollmax function to run on AIX 6

commit 64670df2d2ff75bebec917e327806d5578b739ea
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 16:07:32 2009 +0100

    misc.c: fixed C99ism that prevented compilation on old C compilers

commit e294e79912fbe69535ea60fdb55eaf079ff76aa5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 16:07:14 2009 +0100

    doc/Makefile.am: added all patterndb version XSDs to the dist

commit fe626dbd20e4b1a360d8c2c741944af4d83b4216
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 16:05:59 2009 +0100

    added template formatting benchmark

commit bb7d986b8a68b61c5525e04480fedfdbc9ecb92d
Merge: f7bc3f8 45566d9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 12:51:31 2009 +0100

    Merge commit 'mainline--3.0/master'

commit f7bc3f8f9043f3258dfa249a87039f61ec8799dc
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 10:31:51 2009 +0100

    cfg-grammar.y: remove trailing whitespace

commit 185cfab34bcd6e41ff4b4d430bd9309e2a4e9e87
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 10:31:39 2009 +0100

    grammar: added warning message about '$' prefixes at value references in the grammar
    
    Dollar sign is not needed in this case as value() options are not
    templates, two important differences:
    
    1) macros in templates are not writable
    2) template expansion is slower performance wise

commit 17cc0b279fed0311aea8bf7df781905d945697ce
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 09:44:57 2009 +0100

    LogMessage: add read-only macro support to log_msg_get_value()

commit 694af8ace960ea81b69470fcc5acd48ca6e75faf
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 26 09:43:15 2009 +0100

    NVRegistry: change memory layout to avoid one pointer deref
    
    Since the NVHandle flags are going to be needed in the log_msg_get_value()
    fast path to support macros as values, I want to avoid the extra deref. Also
    functions taking part in the fast path are moved to the header and
    marked as inline.
    
    Among other things this means that the handles are stored in a GArray instead
    of a GPtrArray.
    
    This patch also contains some function renames for consistency and the
    extension of the handle flags to 16 bits.

commit 32c572675f8854c30c0a231e4e846ee2d8b06a2e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 25 10:04:02 2009 +0100

    added some global counters
    
    Some log message related global counters were added to make it possible
    to recognize potential performance problems.

commit f33e7d72228f3d78f75e58f0f6df884baef96806
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 25 10:02:28 2009 +0100

    logmpx: fixed message cloning logic
    
    Some changes were improperly propagated along invalid branches of the
    log pipe tree, which is fixed by this patch.
    
    Basically sometimes a log message was refed instead of being cloned while
    there were some changes still applied to the LogMessage instance.
    
    Since some clones/log queues still referenced the same message, this caused
    some changes to be propagated along branches where they shouldn't have.

commit 26d3f13dca746cfd3f7a6ecbb7ae29ad208d1623
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 23 17:18:55 2009 +0100

    nvtable: remove qsort() and use insert-sort when a new entry is inserted
    
    An external test program was used to prove that occasional qsort() is
    way slower than doing the insert in sorted form in the first place.
    
    Thus the nv_table_reserve_table_entry() was extended to look for
    the proper entry in the NVTable

commit a08aeda79ed3fed54892009800c5ed3df0b10ea6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 23 17:16:07 2009 +0100

    nvtable: added some G_LIKELY/UNLIKELY and inline annotations
    
    Also broke log_msg_update_sdata into two smaller functions, one inline
    taking care of the fastpath and the other non-inline which does
    the slow path.

commit 80dcd73657f5dcd0fcc35a2b11cb66388daf96e9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 23 14:28:10 2009 +0100

    added ltmain.sh to gitignore

commit f947721f7278ecda16c874cecab3af67b37617f9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 23 14:27:53 2009 +0100

    implement SDATA support on top of NVTable
    
    Structured data is a little bit more than simple name-value pairs in the new
    LogMessage/NVTable model as it requires proper ordering in order to
    reconstruct the structured data field in the log message.
    
    This is accomplished by using an array in the LogMessage that contains the
    handles of the SD elements in the original order. Thus the original
    SDATA field can be recovered even after putting them in NVTable.
    
    This algorithm is about 6% slower in microbenchmarks than the original
    with linked lists, but overall it should be a win because of the less
    number of memory allocations and the more cache-friendly layout. I still
    need to run a test or two to confirm that though.

commit 9d40268fed8624354b54d08ee2b1fe3187ddacc4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 22 18:35:56 2009 +0100

    added memrchr implementation in compat.c

commit 17821a660af589d2bc3319eca75f7221a7b3ddb2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 21 16:47:52 2009 +0100

    pdbtool: fixed a possible format string bug
    
    one of the g_string_append_printf()s appended a "buff" using the
    format string argument, which is obviously not very good.
    
    This has no security implications as pdbtool is ran as a user, but could
    be a problem if pdbtool is used behind a web application, feeding data
    unchecked to pdbtool.

commit 931f125540aebe0bfb07540b6510acde20de1b59
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 21 16:46:31 2009 +0100

    afuser: fix a possible buffer overflow if the utmp entry contains an overly long tty name
    
    This is theoretical as the utmp entry only contains 32 characters
    (at least on Linux, other platforms unchecked) and the contents of
    the utmp is already managed by root anyway.
    
    But better safe than sorry, thus it is fixed.

commit fa099e33572a7b56be6cf971b8cf0974a121c320
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 21 16:43:29 2009 +0100

    Implement NVTable to store name-value pairs
    
    This patch is the first of the reorganization to use the same data structure
    API to access all string-like fields of a LogMessage. Instead of having
    4 different implementation for:
    
      * standard fields of a log message (HOST, PROGRAM, MESSAGE, etc)
      * regexp matches ($1, $2, ...)
      * structured data
      * name-value pairs
    
    This patchset aims to uniformize all of these while still keeping the
    performance up. It is believed (and some evidence has shown) that
    accessing standard fields is not slower, while name-value pairs become much
    faster (up to 4 times speedup). It is just an added bonus that all
    client code can use the same APIs, thus the difference between name-value
    pairs and macros can fade even more.

commit 45566d957609026abe41a3292003909b23615124
Author: Anthony Lineham <anthony.lineham@alliedtelesis.co.nz>
Date:   Tue Nov 3 20:44:59 2009 +0100

    cfg-lex: fixed a possible segmentation fault in HUP processing if included files have syntax errors
    
    This patch fixes several use-after-free problems if a file with a
    syntax error is included and syslog-ng is reloaded multiple times.
    
    Thanks for Anthony Lineham for tracking this down.

commit ea34eee9a1172c213aeccbf68ed4fa2881c97b29
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 2 10:59:30 2009 +0100

    affile: set follow_freq to 0 on FreeBSD kernel messages
    
    FreeBSD uses /dev/klog character device for kernel messages. But
    since the file source driver set follow_freq to 0 only on Linux,
    this meant that FreeBSD config files needed an explicit
    
    follow_freq(0) in their /dev/klog source definition.
    
    This patch makes this the default on /dev/klog if the __FreeBSD__ macro is
    defined.

commit ee5421998284021e565a26e869348f4d9e9450c7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Oct 31 14:32:18 2009 +0100

    test_template_speed: new unit test program that measures template formatting speed

commit d1d26ce4eaf4c7f29b54cdb3e72e3347d779bc39
Author: Marton Illes <marci@balabit.hu>
Date:   Wed Aug 19 01:59:10 2009 +0200

    [patterndb] ESTRING parser can match till multi-character string instead of a single char
    
    if ESTRING is given just one char as an end marker it uses strchr to find end
    otherwise it uses strstr to find the end marker which is a string in that case
    the markers are not part of the match in any case

commit cb7249d130f684fb85258a35c678a9fbbb39b1e8
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Aug 13 17:51:22 2009 +0200

    [patterndb] added merge command to pdbtool to merge and upgrade (if required) patterndbs into one
    
    version 1 patterndbs are converted into version 3
    added empty version 1 patterndb for testing/example purposes

commit 3150bdccf9bdf8678b8644908df01729700948dd
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Aug 11 15:53:14 2009 +0200

    [patterndb] fixed ipv4/6 parser to handle patterns where address is followed by a '.' or ':'

commit fb91e721b0a575b61033e323dd23e5911fa796cb
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Aug 11 11:38:47 2009 +0200

    [patterndb] fixed value unicity check in xml schema to check value value name uniqnes

commit 3b59ae56dc78b397839f7833d77ba71ae08f44f4
Merge: b28af21 34b9c4e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Oct 30 09:34:19 2009 +0100

    Merge commit 'mainline--3.0/master'

commit 34b9c4eb6d14d69f0700bb9cd196063ef2bae3b6
Author: Tamas Pal <folti@balabit.hu>
Date:   Mon Oct 26 15:42:13 2009 +0100

    [init.d.freebsd]: start action adds $SYSLOGNG_PREFIX/sbin to PATH.
    Reportedly needed on FreeBSD 7.x, but can't reproduce it. (fixes: #57)

commit b28af21364a97205abc44b5a620c7cd0077f21c3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Oct 23 18:31:17 2009 +0200

    added Solaris specific cron facility

commit e4136cb1f6ac507cf265cb3614af170c301e4a88
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Oct 5 13:28:03 2009 +0200

    [logwriter] fixed a 100% CPU usage if a udp destination is down
    
    Sometimes when a UDP destination is down we get POLLERR from poll. This
    was not always propagated to the dispatch handler by GLib if
    pollfd.events was 0.
    
    This patch makes sure that at least G_IO_ERR is present in the "events"
    field in logreader/logwriter.
    
    Reported-By: Sandor Geller

commit 9848a0ffedb68c2ce0417b8c9ac13c7f99c2bf8b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Sep 29 13:45:23 2009 +0200

    added explicit --enable-sun-streams and --enable-sun-door options
    
    As it seems older autoconf worked with these options without having to declare them.

commit 09708b791005f86fea04c288cc92609353950f46
Merge: 8a02601 2fc30ef
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Sep 16 10:02:04 2009 +0200

    Merge commit 'mainline--3.0/master'
    
    Conflicts:
    	src/logpatterns.c
    	tests/unit/test_radix.c

commit 2fc30ef531d085e4a937909c3a3fbb94ea973783
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Sep 14 09:49:22 2009 +0200

    [syslog-ng spec] removed some more, unneeded PE related stuff

commit 0836f9098d4e4884f7efa4ec6e027c4e48e1f3b1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Sep 7 19:39:54 2009 +0200

    [stats] updated API entry point docstrings

commit 86d3fa605cd1fbf2dd7a78b3a23cba8c3f6c57bd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Sep 6 09:21:19 2009 +0200

    [test_zone] don't attempt to use the SystemV timezones as they may not exist
    
    On Gentoo the testsuite failed because it lacks the SystemV timezones:
    
    Failed to open the time zone file;
    filename='/usr/share/zoneinfo/SystemV/CST6CDT', message='Failed to open file \'/usr/share/zoneinfo/SystemV/CST6CDT\': open() failed: No such file or directory'
    Bogus timezone spec, must be in the format [+-]HH:MM, offset must be less than 24:00; value='SystemV/CST6CDT'
    unixtimestamp: 1252119277 TimeZoneName (SystemV/CST6CDT) localtime offset(0), timezone file offset(-1)
    
    Removed the offending timezones from the testprogram.

commit 8a02601f81791a519de568f900276ceedd3ca6c9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Sep 4 09:55:18 2009 +0200

    [syslog-names] decouple the facility/severity codes known by syslog-ng from the system defined codes
    
    Until now syslog-ng depended on the values defined in <syslog.h> to implement
    the severity/facility name lookups.
    
    Since BSD uses a couple of new facility codes which are not defined on
    other system, this patch removes this dependency and hard-codes the
    values defined by RFC3164, the Linux syslog.h header and the BSD syslog.h
    header.
    
    This makes syslog-ng know about "ntp", "security" and "console" facilities.
    Even on non-BSD systems.

commit 0d6e9ca2afba9b7d78b94b8684fc001acd76b6d8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Sep 2 22:56:22 2009 +0200

    removed old cruft from syslog-ng.spec.bb

commit 8a131a0f250c0b54ce59874383f8d85fa87c59ff
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Aug 31 19:19:43 2009 +0200

    [LogSource] fixed broken program_override/host_override settings
    
    The length for program/host_override strings were initialized to zero and a
    recent performance improvement (in commit 7f9603c) makes uses these length
    values. However the on-demand length calculation of these fields checks if
    the lengths are below 0, which they are not if those are 0 initialized.
    
    Reported-By: Imre Lazar

commit c2e8aa58763a89cab58d05fb7a2b2a18021413b4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Aug 30 12:25:17 2009 +0200

    [logmsg] added support for ASA timestamps
    
    ASA timestamp, expected format: MMM DD YYYY HH:MM:SS

commit 51d40371d5e2abf636220470c8257b8426fa648c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Aug 30 11:41:24 2009 +0200

    [afinter] don't block on the internal_msg_queue even in the threaded case (fixes: pub#48)
    
    A hang was reported in bugzilla ticket #48 which seems to have
    been caused by MARK messages interfering with local messages:
    
      * if the MARK is due in the same poll iteration as a local message
      * the MARK timeout is checked and the internal source is marked as having
        input available
      * then the local message comes in pushing the mark timeout further ahead
        in time
      * then the internal() dispatch callback checks the mark timeout again,
        but at this time it is already in the future ->
      * the dispatch callback falls back to fetching the internal message from
        internal_msg_queue, assuming it was that which caused the dispatch
        callback to be scheduled
      * this blocks indefinitely.
    
    The solution is very simple: use g_async_queue_try_pop() instead of
    g_async_queue_pop(), the dispatch code already takes care about a
    NULL message value.
    
    Thanks for the helpful reporters to hunt down the issue.
    
    Reported-By: Arkadiusz Miśkiewicz, Elan Ruusamäe

commit 2e03c0ea300abc8f727e00981182b0e907194472
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Aug 9 09:21:14 2009 +0200

    [debian] added pdbtool to the syslog-ng package

commit 0195be8fefdce7b090a5fbbda8bce390cad1a2e9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Aug 9 09:18:24 2009 +0200

    [test_patterndb] fixed compilation warning about undefined g_unlink()

commit 167df969c1cc690cfc51359aca1c064f7749be4b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Aug 9 09:18:07 2009 +0200

    [tag filter] fixed compilation warning in the filter_tags_add invocation

commit 1ad4da07d5305ba0140ac385d661ab6de25fc5f3
Author: Marton Illes <marci@balabit.hu>
Date:   Fri Jul 31 17:17:13 2009 +0200

    [patterndb] estring parser length calculation must include ending quote
    
    Also added relevant testcases.

commit 51de3882ee873d9e8a555aef74b5c4eb8ec9a71b
Author: Marton Illes <marci@balabit.hu>
Date:   Wed Jul 29 18:00:07 2009 +0200

    handle unclosed macro/variable references in template compilation

commit 29ff0aa9e23b90cc543df9f8ef74fee818a6cffb
Author: Marton Illes <marci@balabit.hu>
Date:   Fri Jul 31 17:17:13 2009 +0200

    [patterndb] estring parser length calculation must include ending quote

commit 4cc5bd0136f0dd18e59d82129584dbf5b1664691
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 30 13:09:16 2009 +0200

    [patterndb] pdbtool match exits with zero exit status if match is found

commit 26333c9978dd48bae5ac46ae0a838cd275ba5ca0
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 30 12:18:32 2009 +0200

    [patterndb] added patterndb version 3 to support values and test examples
    
    version 3 is backward compatilbe with version 2

commit b1e0cf65c5cae33f7e0a69febfa8ac1693acac93
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 30 11:54:06 2009 +0200

    [patterndb] added dump command to pdbtool to dump pattern database

commit 95879375ff6d5ad90dfa622cd703ea2f14b0885f
Author: Marton Illes <marci@balabit.hu>
Date:   Wed Jul 29 23:19:28 2009 +0200

    [patterndb] added pdbtool utility to handle patterndb related tasks

commit 98dabd4d62cf8871837674fa726939b4a94b3396
Author: Marton Illes <marci@balabit.hu>
Date:   Wed Jul 29 18:00:07 2009 +0200

    handle unclosed macro/variable references in template compilation

commit fa8e3c66e9dce34fa44ec01933949c7f2ef65dc5
Author: Marton Illes <marci@balabit.hu>
Date:   Wed Jul 29 17:58:43 2009 +0200

    [patterndb] name/value pairs can be attached to LogMsg from patterndb rules
    
    values are evaluated as templates on attaching values to a LogMsg

commit 176755ba7f8e0c28d5dd94d76e46b60be4ad0b94
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Jul 28 20:15:19 2009 +0200

    [patterndb,tags] added tags support to patterndb
    
    tags can be specfied for each patterndb rule which are added the matched
    message

commit 8bac54730640452bd68719268baedd8a8958d3bd
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Jul 28 13:50:01 2009 +0200

    [patterndb] added version 2 patterndb XML schema

commit cdc2d13ecbf61a9d00b87900de542540affaa155
Author: Marton Illes <marci@balabit.hu>
Date:   Fri May 1 17:55:27 2009 +0200

    [tags] the message is taged automaticaly with the source group name as ".source.name"

commit 6c76d96f2c89590302dfd374e186d2479ea38992
Author: Marton Illes <marci@balabit.hu>
Date:   Tue Jul 28 13:37:59 2009 +0200

    [tags] tags() option added to source drivers to tag messages
    
    tags(comma separated list of tags)
    the listed tags are added to messages received on that driver

commit 5a78871b340fb9bdc9e315d751297069303bfa44
Author: Marton Illes <marci@balabit.hu>
Date:   Fri May 1 17:50:36 2009 +0200

    [tags] added tags() filter to match taged messages
    
    tags(list of comma separated tag names)
    could be used to match any of the listed tags of the message

commit d31f14cb81dfb5708f0ff76ea535a7b52fe3118e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Aug 9 07:47:23 2009 +0200

    [tags] tags can be attached to LogMessages
    
    Currently maximum 8159 tags could be defined and attached to a LogMessage. The structure
    holding the tags in a LogMessage is allocated automatically as new tags
    are attached. Tags could be set, unset and tested for presence.

commit 9c9ddfba10b26e213712fe2135ed1e327d8770e3
Author: Marton Illes <marci@balabit.hu>
Date:   Fri May 1 17:40:47 2009 +0200

    [tags] created tags framework
    
    Tags could be attached to messages and later tested for tags presence. Each tag is
    represented by its name and unique number which is attached run-time. Run-time
    ids are used for fast lookup and matching.

commit c1645750f7086591ca64817188763a6c015c6fc4
Merge: 64a7fdd 1b5d618
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Aug 8 17:24:56 2009 +0200

    Merge commit 'mainline--3.0/master'

commit 196223af64d2bd09f41123313884b71cdd41bbd5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Aug 8 17:05:16 2009 +0200

    [patterndb] fixed possible heap corruption in case of a parse error
    
    state->current_program wasn't set to NULL whenever it was inserted in the
    radix tree, which means that it could possible be reused later.

commit 1b5d618e301ad94aa20e692ffba16469dece8d10
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Aug 5 16:06:08 2009 +0200

    fixed link error if ipv6 is disabled
    
    ccache gcc  -g -I/opt/syslog-ng/include -Wall -U_XOPEN_SOURCE -U_XOPEN_SOURCE_EXTENDED -D_HPUX_SOURCE  -Wl,+b/opt/syslog-ng/lib -L/opt/syslog-ng/lib -lcl -o syslog-ng  main.o libsyslog-ng.a   -lrt -lnsl  -pthread -L/opt/syslog-ng/lib -lgthread-2.0 -lglib-2.0 -lintl -liconv   -L/opt/syslog-ng/lib -levtlog   -Wl,+s -L/opt/syslog-ng/lib -lssl -lcrypto -ldld   -lz -lnet  -L/opt/syslog-ng/lib -ldbi
    /usr/ccs/bin/ld: Unsatisfied symbols:
       g_sockaddr_inet6_get_port (first referenced in libsyslog-ng.a(afinet.o)) (code)
    collect2: ld returned 1 exit status

commit c7d6f1236a3608c1f91c0b5829ded3192956ac23
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Aug 5 12:55:53 2009 +0200

    preparations for 3.0.4

commit 64a7fdd28cf8e6582c190724a8c3052724db3430
Merge: a4d7533 0fb065c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Aug 5 12:39:51 2009 +0200

    Merge commit 'mainline--3.0/master'
    
    Conflicts:
    	NEWS
    	VERSION

commit 0fb065c45dde64e834196781e6bfc8dcef40709e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Aug 4 09:38:57 2009 +0200

    [afstreams] fixed failure handling in door initialization
    
    Sometimes syslog-ng could close the door fd multiple times, causing
    problems in other drivers if the same fd was reopened for a different
    purpose.

commit 7f9603cd4c8a899570f2df93a08d72dec8a5d85e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 17 10:03:12 2009 +0200

    [LogSource] improve host_override/program_override performance
    
    Since we do have the length of the overridden fields, don't recalculate it
    with g_strdup(), use g_strndup() instead.

commit a69902316b52fcff6d611574baf71604c2960fb1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jul 13 09:26:59 2009 +0200

    [patterndb] fixed error handling
    
    GError instance was not properly initialized to NULL and it might have
    printed garbage in the error message in case GLib returns failure
    with error == NULL.

commit 63ab6b0cbdcf0309212ed816bd221d4444d19453
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jul 9 18:34:53 2009 +0200

    [afsocket] make sure self->transport is initialized (fixes: #19609)
    
    This causes possible NULL derefs under Solaris when the stats
    name is formatted

commit a13c140ab95643635887dd7b9137179f6968a370
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Aug 5 12:34:32 2009 +0200

    [config parser] use the string non-terminal instead of STRING for bad_hostnames()
    
    this allows the user to use both the quoted and non-quoted string forms in the
    bad_hostnames() option.

commit 6fb048334d2859c319914cdf1c97bc0f8a5403af
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Aug 4 17:27:54 2009 +0200

    fixed negative window size problems
    
    the source window can go sometimes under 0, causing a possibly failed
    assertion during SIGHUP processing. Fix proposed by Sandor Geller and
    rewritten completely for 3.0 by me.
    
    Reported-By: Sandor Geller

commit d2158b87895fd7cc7a044af0bbad4df37db19015
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 31 21:14:00 2009 +0200

    don't reset the destination port number to 0 in ipv6 address resolution
    
    resolve_host() zeroes out the port number if an ipv6 address is resolved.

commit 741dcea9e98fe4a7543f0ab705b3a52eab99332c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 31 12:00:03 2009 +0200

    fixed possible abort when using tcp6() destination

commit a4d7533d9c826dcf405d94aa6644587feacf9e96
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 16 22:41:55 2009 +0200

    [patterndb] fixed parser node first char match handling
    
    the mask/match combination is switched to a range

commit 9e7a729f6b450c7ef5bf0b22943771f040fd110e
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 16 22:38:55 2009 +0200

    [patterndb] Consider the value of the parameter when checking if two parser nodes are equal
    
    Earlier only the name and the parser type was checked, but the
    parameter is also important when determining if two parser nodes
    are equal.

commit 73fe61c0dccd0453cb18d41e3bdca54a2525fba1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jul 16 22:34:06 2009 +0200

    [patterndb] use strcmp instead of prefix match when looking up parser name
    
    Because of historic reasons r_parser_new() used prefix matching instead
    of complete string matching. This was obviously wrong.
    
    Updated a bogus testcase that only worked because of this wrong behaviour.

commit 8c9e4099477866829b9de8dbdbcca97806856f00
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 16 22:31:01 2009 +0200

    [patterndb] added FLOAT radix parser
    
    This patch originally added a parser named "DOUBLE", but since I've found
    that to C specific, I've changed the parser name to "FLOAT", while still
    recognizing the old name "DOUBLE".

commit ae1b7fd8f386c141056247264ccd06da78614136
Author: Marton Illes <marci@balabit.hu>
Date:   Fri May 29 15:03:28 2009 +0200

    On error r_insert_node displays more information about the node that caused the problem
     in logpatterns.c for rules, the rule_id is displayed

commit 6be05a55fcfd55b4efa106e5c507ad3fad9cbdbc
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 16 22:03:21 2009 +0200

    [patterndb] adapted db_parser configuration loader to new syntax with rulesets
    
    This patch introduces the v2 patterndb format.

commit b0869709f98566d39b5b3d8bd793cdf12ccc1996
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 16 22:00:49 2009 +0200

    [patterndb] db_parser NUMBER parser now handles hexadecimal numbers in 0xXXXXX form

commit 60dc446418bcb9e41436d5ab287f66a604172a6f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jul 16 21:57:04 2009 +0200

    [unit tests] white space cleanup

commit 32e346803c04c8454ae7f9313ebf5f9fdac83553
Author: Marton Illes <marci@balabit.hu>
Date:   Thu Jul 16 21:56:03 2009 +0200

    [patterndb] added IPv6 and IPvANY parsers to db_parser

commit a2b156f67a4cb7c5ee9438864c6d93870e668ac1
Author: Marton Illes <marci@balabit.hu>
Date:   Sat Apr 25 19:02:53 2009 +0200

    fixed a memory leak around parser match storing, check for parser node name length
    
    
    Reported by: Martin Holste

commit 53c07dc8bba32dab918d6ab782e0e1dfc6b210ff
Author: Marton Illes <marci@balabit.hu>
Date:   Fri Apr 24 19:24:40 2009 +0200

    fixed a memory leak in db-parser() dynamic value handling
    
    Reported by: Martin Holste

commit 1c31f647245df4e6f8773d49c04ca32deb9d9bfc
Author: Marton Illes <marci@balabit.hu>
Date:   Fri Apr 24 19:23:33 2009 +0200

    added testcase for real log radix parsing

commit 08c9bf9d98e4e021756adc12c42605840140ba8b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jun 25 08:57:09 2009 +0200

    [func_test] make func_test run with Python2.6
    
    Under Ubuntu jaunty, Python 2.6 socket.ssl is not imported into
    the importing module if '*' is used for import symbols.
    
    Make the import explicit, this works.

commit 6d44bfd8085a6ef11f6d208397cc22cb32bc971b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jun 25 08:27:45 2009 +0200

    [VERSION] preparations for 3.0.3

commit 453407a16e41da145308019867b3bcf6715b4c70
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jun 25 08:26:41 2009 +0200

    INCOMPATIBLE: fixed command line argument incompatibility with syslog-ng 2.x
    
    syslog-ng 3.0 was changed to use the command line parser from Glib instead
    of the system getopt() which does not support long arguments on some
    platforms.
    
    However there was an unintended conflict in the processing of the -C
    (chroot) and -R (persist-file) options, which caused an unintended change of
    meanings of these options.
    
    Since these options are quite rarely used and it is expected that more users
    are yet to be upgraded to 3.0, it was decided to keep the compatibility
    since 2.x, thus it is an incompatible change within the 3.0 series.
    
    Reported-By: Leonid Chaichenets

commit 82f593ac78a62cfe49b64642cca77b02dada06d8
Merge: c22ee8d 75c5000
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jun 13 10:32:30 2009 +0200

    Merge commit '3.0/master'

commit c22ee8dad59b56b9f2d4f85282570d77e931d2be
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jun 13 10:30:37 2009 +0200

    [radix] implemented ANYSTRING parser
    
    the ANYSTRING parser eats everything up to the end of the string.

commit 75c5000a4d6ea6ab04e4f2158e6008dec0a1cdcd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jun 7 11:47:51 2009 +0200

    [afuser] open the tty in nonblocking mode to avoid blocking on serial lines
    
    Reported-By: Jean-Baptiste Quenot

commit 455011d067635100e05168783b54d219fb207108
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jun 3 13:15:54 2009 +0200

    [logprocess] fixed log_process_queue to handle NULL "next" pointers (fixes: pub#49)
    
    With a configuration which had a filter() but no destination, it can happen
    that the next pointer of a filter() node points to nowhere.  This patch
    handles that case without causing a crash.
    
    Reported-By: Jan Schaumann

commit bbc122dad8a7256368ab8cb95c133895478100c7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 30 19:18:10 2009 +0200

    Changed version number and cleaned NEWS file for syslog-ng 3.1

commit fe8965b5c78cdccaac474c4a8d51961f9aa7b715
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 25 11:28:00 2009 +0200

    [templates] fixed omitted parentheses in the previous patch

commit 32949aaf9a241411f63953926898b5f1e33064ca
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 25 10:30:58 2009 +0200

    [templates] fixed compilation problem if ipv6 is disabled
    
    templates.c:(.text+0x658): undefined reference to `g_sockaddr_inet6_check'
    
    Reported-By: Michael Sterrett

commit e1c8e7f086f5c5b73727cfef6d351614d87574ed
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri May 8 18:05:45 2009 +0200

    [func_test] func_test problem fixes on various platforms

commit b2eba9087c5a5c7b2789654d24bba6070fe24cb1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri May 8 10:55:04 2009 +0200

    [test_zone] omit posix/ and right/ subdirectories from the test
    
    And remove timezone names that are not supported on Debian/etch, e.g
    Kolkata
    San_Luis
    Ho_Chi_Minh

commit 28c88c157b584ea698b0e546aaccd62d864685bb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri May 8 10:48:26 2009 +0200

    [test_zone] always call putenv() on the new TZ string as the current code didn't work on FreeBSD

commit dc6717b358db08fdb1f2a8be2cc7f6388acd79dc
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu May 7 21:58:40 2009 +0200

    preparations for 3.0.2

commit 691c7a3a49eb3f5d019bfa753b80aabd875af1fd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu May 7 16:57:55 2009 +0200

    [affile] restore changed caps unconditionally (fixes: pub#42)

commit 7218abcbc4c6fbb29491e9140946b47f5795998d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 4 15:40:04 2009 +0200

    [config parser] use LL_ prefix for non-keyword tokens in the parser
    
    To avoid namespace collisions with openssl.
    
    Reported-By: ruiyen@gmail.com

commit 355f1bdce9f86df5d2ad85e1a0a250ff317c107d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 2 13:42:49 2009 +0200

    [func_test] readded default syslog-ng options to test_performance

commit f86c598f2e74e4e8b7ae893de233d17d842d1fd0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 2 13:42:22 2009 +0200

    [func_test] added validation to SQL test case

commit 9ac94e61a387da76c420d17202b148fb409f0c99
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 2 13:41:48 2009 +0200

    [func_test] added PID information to the generated messages

commit 2a6fa5bf06620358d3acc369b4fc601f022119d6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 2 13:41:31 2009 +0200

    [func_test] iterate test cases inside a given module in alphabetical order

commit 14d87e003ed1b3b4f814115147d0d588bd212270
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 2 13:22:16 2009 +0200

    [func_test] messagecheck was generalized somewhat to cope with SQL

commit cfc62e755a339c732a26a24fa5486f185993a38b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 2 13:20:38 2009 +0200

    [func_test] fixed start/stop logging in case syslog-ng is stopped in the testcase
    
    also fixed FAIL logging, in which case test case ends were printed twice.

commit 001214236f7c94280a3ffe259cb032927bc60df3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri May 1 14:34:29 2009 +0200

    [gitignore] added .pyc files

commit b911e8b288691060dde0e085a4b66db238448efe
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri May 1 14:32:05 2009 +0200

    [func_test] split func_test program into several more maintainable modules
    
    instead of having one thousand line script, split func_test into small,
    more maintainable modules.

commit 679a70e10bb1953d7c47ee68431ec492d8f83862
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 22:45:53 2009 +0200

    [func_test] added primitive SQL test
    
    it does not yet validate the contents of the SQL table after inserting
    logs, but it starts it nevertheless.

commit 354136667130a7ceb058aeab0a6a4e84be7e7c49
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 22:44:44 2009 +0200

    [func_test] added test cases for SSL
    
    This requires SSL support in Python's socket module, but for now we will
    simply fail if it's not available.

commit b6e9ea617567b9da300adfc8b2462a6bf5efd892
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 22:41:23 2009 +0200

    [func_test] added some basic performance testing
    
    Run loggen against a simple syslog-ng configuration. The baseline still
    has to be found, we currently require 1000 msg/sec everywhere, an 10000
    on my development box.
    
    I plan to specify more exact numbers for all of our build hosts.

commit bbd987cb2d21899e79c277eec2bfe8df0e291a6c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 20:15:17 2009 +0200

    [func_test] readded port number randomization
    
    The previous patch dropped an OSE feature in func_test namely to
    randomize the port numbers used while testing. This patch readds
    this functionality.

commit a0e2e7e889dd1a9c1e40475a0c1e6a33e2888bb7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 19:53:32 2009 +0200

    [test_zone] on Linux always run all tests
    
    fixed up tests with long zone names (> 32 chars), also fixed
    timezone setup by adding clean_time_cache() to all cases.

commit 1b0b2a1fbb3cbadbec7774e48ae6f2f759da80b9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 19:51:44 2009 +0200

    [tests] added the collection of test coverage data

commit eb0baa34450681d1cf7ca23ed8fc28b251258a35
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 12:54:34 2009 +0200

    timezone related variable naming cleaned up for readability, added support for local_timezone() (fixes: pub#44)
    
    This patch clarifies time_zone related variables by adding "recv" or "send"
    prefix to indicate the information that was previously implied.
    
    Also added a 3rd time zone named "local" which controls the timezone to
    be used for naming files/SQL tables. The local timezone is supported by
    the SQL and the file destination.

commit 7d21d16bae466094cf9ac3cfb652c3ffe9d5296d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 11:06:56 2009 +0200

    [afsocket] added shutdown call prior to closing fds (fixes: pub#21)

commit 10c11e65fcf02aca60b05d265be694d771fa57ad
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Apr 14 13:16:04 2009 +0200

    [afsql] implemented NULL value support
    
    Reported-By: Liam Kirsher

commit 3672c6a2daff166fa358e079ba79e8ba4eb4d055
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Apr 30 10:30:14 2009 +0200

    [afsql] added warnings about the use of default values for columns/values/indexes
    
    The same set of defaults will not work on all SQL databases, so it's
    preferable to rely on the admin to specify values explicitly.
    
    For now I added a warning, but the defaults will be removed in the future.

commit 62dd98b5a803275954a09fc04feb6cea9ac7f5d1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 29 17:45:59 2009 +0200

    [config parser] don't use facility/level keywords for specifying the default values for file sources
    
    There was an experimental feature to add support for controlling the
    default facility/priority values for sources in case the incoming
    message lacked this value.
    
    This used the same 'facility' and 'level' keywords but this was misleading
    as it does not override the value received if it was present.
    
    This patch changes it to use distinct keywords.

commit f96ae94df8abdc92402247682537404613db26b9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 29 17:38:49 2009 +0200

    [affile] fixed capability management around file opens (fixes: pub#42)
    
    caps are always saved not just in case of "privileged" operation.
    instead of using DAC_OVERRIDE use CAP_CHOWN and CAP_FOWNER for
    changing file ownership.
    
    Reported-By: Zbigniew Krzystolik

commit fcf037d02d5f1711badea1d090932da0ccedb688
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Mar 27 16:31:09 2009 +0100

    [configure] fixed error message caused by an uninitialized variable

commit cd01226254a4f8f7233fd8fcd5628c5b945facfa
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 29 16:11:23 2009 +0200

    [affile] fixed default follow-freq() value for regular files
    
    This was broken since fraction of a second support in follow-freq was
    introduced, ever since the default follow_freq was 1ms and not 1 sec.

commit 651744055916ec867d30e28354056e09a5fa2403
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Mar 14 18:23:01 2009 +0100

    [string matcher] fixed a string matcher bug which causes bogus matches (fixes: #17990)
    
    Since the value can be shorter than the pattern, limiting the length of the
    strcmp() with the value_length may cause a success to be returned even of
    only the first couple of bytes of the pattern & value match.
    
    Added a couple more testcases to cover this as well.

commit da1045cff8e28f27ee2c16c82e4b42437d8fcb08
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 21:35:31 2009 +0100

    [loggen] fixed compilation warnings
    
    loggen.c: In function 'gen_messages':
    loggen.c:151: warning: format '%lu' expects type 'long unsigned int', but argument 2 has type 'time_t'
    loggen.c:151: warning: format '%lu' expects type 'long unsigned int', but argument 3 has type 'suseconds_t'
    loggen.c:210: warning: format '%ld' expects type 'long int', but argument 5 has type 'time_t'
    loggen.c:210: warning: format '%03ld' expects type 'long int', but argument 6 has type 'int'

commit 2bed92d17169636cdde0fd6d01e2a552cd634a49
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 29 16:06:18 2009 +0200

    fixed compilation warnings on Solaris
    
    by adding a couple of #include <string.h> instances here and there

commit a3761351df4d8c389abf0d7cafa062693b28b5d4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 17:01:46 2009 +0100

    [logproto] fixed compilation warning

commit 2893eaa54bc5ff683e414968322d4bdd041d0123
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 29 16:00:39 2009 +0200

    [func_test] backport functional test programs from PE, make it PE/OSE aware

commit da4fbcd19371ad091094faa929dae7032ebc2508
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 22 13:20:57 2009 +0200

    [templates] fix SOURCEIP macro expansion for IPv6 addresses
    
    Reported-By: Michael Granzow

commit 642880801b5d8f2cb25b310724ca758e4d1f671f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 22 13:12:34 2009 +0200

    [compat] fixed HP-UX portability issue
    
    the __pread/__pwrite symbols might clash with system supplied names. Use
    bb__ prefix instead.

commit 57b737be8b9b0a319f62f36dfa6eaf973d661ba2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 22 13:03:26 2009 +0200

    [logreader] print a log message if a polled file source does not exist

commit b014fcb2dafc358c2f7b7f62fef7eed65eb1fe57
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Apr 14 21:57:35 2009 +0200

    [debian] added delaycompress option to logrotate configuration file

commit 34adcc3bd04fbd966369bee600e0a9f88ab3c9d8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Apr 14 13:15:15 2009 +0200

    [func_test] randomize TCP/UDP port numbers (fixes: pub#41)
    
    In order to make it possible to run several func_test instances
    in parallel, randomize TCP/UDP ports somewhat to avoid collisions.

commit 8e484f873046bff64cbfc43f3170d9e5920fd1d0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Apr 7 12:52:41 2009 +0200

    [cygwin packaging] fixed version information in the generated config file
    
    Problem reported and patch submitted by Corinna Vinschen.
    
    Reported-By: Corinna Vinschen

commit 70d758fe40ad64f78e28e87b629c54fbd1fdc09e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 1 10:00:35 2009 +0200

    [LogStamp] make it possible to use frac_digits with non-ISO timestamps

commit 6fbea222dd8b8531db12c14d23120cfcc3150f5d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Mar 25 11:27:28 2009 +0100

    [afsocket] clarified logging about rejected connections
    
    Liam reported that the error messages generated when tcp wrapper
    rejected the connections can easily be misunderstood. This behaviour was
    fixed. Also, when connections are rejected, the closure of the
    file descriptor was refactored to a single spot instead of closing it
    in all failure branches.
    
    Reported-By: Liam Kirsher

commit 0a5d52a70ec47e0e3e2a29a3c427afbad1cae2d9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Mar 14 11:02:29 2009 +0100

    [csv-parser] implement greedy and drop-invalid flags
    
    greedy:: the new greedy flag makes the last column of a csv-parser() greedy,
    e.g. it gets all the remaining characters at the end of the parsed line.
    
    drop-invalid:: the new drop-invalid flag makes the parser drop all messages
    that do no have enough columns to fill the required number of fields.

commit 555574a984eaef9410a2869db0af1be0d52b269b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 17:27:03 2009 +0100

    [configure] minor updates

commit 451f5f5b251d73ab8314c5402605c6ad76d8739a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 16:30:50 2009 +0100

    updated copyright notices

commit 1eb58c252f1e2122d6dfa94586a089608ddac3a6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 15:50:49 2009 +0100

    [compat.h] include config.h instead of syslog-ng.h

commit bd6f232410b1d42b2aaa9fa37cd0e6fe643a0ebb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 15:50:31 2009 +0100

    [tgz2build] accept 1 successful "make check" run out of 3 enough for success
    
    Since the func_test can fail if the timing is bad, accept 1 successful run
    as success out of the three that is performed at build time.

commit 4766533b4d965c747da47d06bb0ad490a3c47e19
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 15:49:31 2009 +0100

    [func_test] removed time.sleep() calls scattered around the code

commit 5cd2423b2f5ab96c15136664ca3af5a462a592e1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 15:07:53 2009 +0100

    [templates] removed dead code
    
    there was a g_assert_not_reached() call without a label in the macro expand
    switch() statement. It was removed.

commit b44bacd3fd121c8cd0b166c7794ba68fe5cea9ee
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 15:02:09 2009 +0100

    [loggen] report the effective bandwidth used at the end of the run

commit e887174d1c4ecea92f7d06747298cabe85eb3fc9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 15:01:31 2009 +0100

    [loggen] don't allow message sizes that'd cause stack overflo

commit a0cec40eff22be0d825e28fe7bb893ef4a9f8d60
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 14:57:38 2009 +0100

    [loggen] readded sequence number & timestamp generation
    
    It was commented out for some testing and remained there.

commit 55f47d79174af753a67beaa16676e66615fde083
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 14:56:54 2009 +0100

    [radix] stylistic changes

commit 15bd73e8d5dccbc5135d613614a976fd299bc552
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 14:55:38 2009 +0100

    [messages] added support for sending the internal messages to syslog()
    
    also delegated up logging related parameter parsing to the messages
    module.

commit e0224fd96f01278d920441db76bf351700625f81
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 14:49:57 2009 +0100

    [logwriter] fixed write suspend in case the GSource instance is replaced

commit 15779d4095ee1e150589fc666f30e8a4230b6c5d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 14:48:07 2009 +0100

    [db-parser] move the patterndb file checking into log_db_parser_reload_database()

commit 8d851472e9a81cae91313f55adbafb119d7499d9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:47:08 2009 +0100

    [logmsg] rename log_msg_ack_func and remove static
    
    mostly to sync up with PE.

commit 56c60c3967dcf032570e8d29109897058fab0d06
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:46:49 2009 +0100

    [logmsg] fixed signed comparison problems

commit 58086421b09eab362cae7989ab586fc83c8a9d65
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:44:28 2009 +0100

    [child manager] don't call destroy notify if one is not set

commit 53b2c3143c687c0449502e2d3ac4738d88b8cd55
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:44:00 2009 +0100

    [config parser] add an error message if the user requests to rewrite using "glob"

commit ae6398ac8d97f165f115d3f21b9e9b7b3b4de282
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:42:34 2009 +0100

    [afsql] recognize "mssql" as an alias to "freetds"
    
    It is not very intuitive to call MSSQL as FreeTDS, thus an alias was added.

commit 6a63cd91b31fbb06c55a14836fee02369dc16353
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:41:36 2009 +0100

    [afsocket] clarified log messages
    
        The messages, parameters and log levels were cleaned up.

commit 25b374973049d013d4f7287fdb6a9c3bd3be9717
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:41:18 2009 +0100

    [afsocket] properly drop connections in case SSL handshake fails
    
        This patch was missed previously in OSE and is now backported from PE because
        I'm reviewing the differences between the two.
    
        The bug that is present in OSE is, that if an SSL handshake fails, the
        connection is not properly closed and also the connection is counted when
        checking max-connections(). Therefore it is quite easy to DoS the SSL
        enabled listener.

commit 3bbec6667431bd1f46d2d6d7d437aa78323c256a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:40:22 2009 +0100

    [afsocket] the member used to hold target hostname was moved to afsocket
    
    This is mostly serves to sync up with PE where the target hostname is used
    by both afsocket & afinet.

commit 59c2da10acbc70833d14e20b875f7e714e15d9d5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:29:43 2009 +0100

    [init script] balabit-initscripts fixes
    
    there were some missing initscripts patches that I forgot to backport from
    the PE branch:
    
      * killproc implementation in init-functions
      * the LSB implementation was not always included by the init script

commit eadda4c403a8b0942f6bc6ee69c7c13b8357a1ce
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 12 12:27:40 2009 +0100

    [unit tests] udapted to the changed log_msg_new() prototype

commit a1fa9b022563dcae4cf5ef3b6e262946f5ec5907
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Mar 10 22:44:20 2009 +0100

    [func_test] enhanced functional test program
    
    now it also covers filter/facility filters

commit 2bddf91e2dc3b1f590f3cff2f735cb6ccd5531a7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Mar 10 22:41:00 2009 +0100

    [logreader] added support for specifying the default priority for those messages that lack one
    
    Instead of using a hard-coded default, make it possible to specify the
    level/facility information on a per-source basis. A patch was submitted
    by Xavier Lapie and was significantly modified by me:
      * the old file-specific mechanism was generalized to be LogReader specific,
      * the common code in the configuration parser was merged

commit b758e95702f642e2c343539b4c8e250a6bc9aba1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Mar 10 07:19:12 2009 +0100

    [tgz2build] fixed etc/install.dat generation

commit 7ff35ea7621f5bf375c27a88f3ecc5f4a640b215
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Mar 10 07:18:51 2009 +0100

    [func_test] use SNDTIMEO on Linux platforms only as it does not work everywhere
    
    Solaris for instance does not support SNDTIMEO for UNIX domain sockets.

commit c8a231b573283fcd7204ff402f186acb25c980a5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Mar 6 13:51:36 2009 +0100

    fixed a segfault in SSL support
    
    Due to a typo some parts of the SSL compilation were not compiled in,
    causing a segmentation fault during startup.

commit faa9bee7610594bcced5b439f1fa38487a2f20c5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Mar 4 18:20:14 2009 +0100

    [debian] fixed build-dependencies to work with packages in lenny
    
    The reference to libdbi-dev was fixed, as this package is called libdbi0-dev. Also libssl-dev was added.

commit 731a28515dffa4f5de09fd1de3b3c7b262fc6093
Author: ILLES, Marton <marci@balabit.hu>
Date:   Wed Feb 25 22:56:10 2009 +0100

    only stat dns_cache_hosts file once in a second and not at each lookup
    On my dual-core 2.4GHz x86_64 laptop it yields 10%
     while on an 2way quad-core 1.9GHz x86 Opteron server it yileds 100% gain

commit dd7b45a8f230ceb204fb7de5f48a2d03ced97ab7
Author: Chris Packham <chris.packham@alliedtelesis.co.nz>
Date:   Sat Feb 28 14:39:39 2009 +0100

    fix file descriptor leak when using includes
    
    When using the newly introduced includes feature the files that are
    included are not closed and cause a file descriptor leak.
    Depending on the system ulimit, number of includes and frequency of
    re-configuration this can cause configuration not to be applied.
    
    To address this it is necessary to close the included file after
    processing it.
    
    Signed-off-by: Chris Packham <chris.packham@alliedtelesis.co.nz>

commit 765516b8d04fcc5cff0fe9eb432a3bc9b7f08a25
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Feb 27 23:34:44 2009 +0100

    [logwriter] only report POLLERR as "idle" if num_elements is zero
    
    Only handle POLLERR flag as an indication of broken connection in case there
    are no messages pending. The reason is that the write() failure is handled
    with better error messages, e.g. you'd get
    
    Feb 27 23:34:31 bzorp syslog-ng[19131]: I/O error occurred while writing; fd='11', error='Connection refused (111)'
    Feb 27 23:34:31 bzorp syslog-ng[19131]: Connection broken; time_reopen='1'
    Feb 27 23:34:31 bzorp syslog-ng[19131]: Suspending write operation because of an I/O error; fd='11', time_reopen='1'
    
    instead of
    
    Feb 27 23:30:11 bzorp syslog-ng[18855]: POLLERR occurred while idle; fd='11'
    Feb 27 23:30:11 bzorp syslog-ng[18855]: Connection broken; time_reopen='60'

commit 857c2576c4247755e60bd6f8c1f414c87978fbeb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 28 09:41:41 2009 +0100

    [apphook] fix run_application_hook to run _all_ hooks registered at a given point
    
    due to a bug in the loop in run_application_hook() the next pointer was
    always null after running the first registered entry. This was fixed.
    
    This fixes a problem with multiple SQL destinations reported by Liam Kirscher.
    
    Reported-By: Liam Kirscher

commit 865261fd2c6332f7da390a466b06aef6a1bf3806
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Feb 17 10:07:46 2009 +0100

    [autogen.sh] use -i instead of --in-place
    
    BSD sed does not understand --in-place, use -i instead.
    
    Reported-By: Csaba Szep

commit 41f77f536a4e442d8dd2e0b6276987c07ac09b45
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Feb 15 09:46:35 2009 +0100

    [logreader] implement 'empty-lines' flag
    
    This new flag allows the transmission of zero-length messages.

commit bcabf5b4985d7360cce20403d5ff36a033b9ee26
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Feb 15 09:27:18 2009 +0100

    [configure] clarified error message about missing static openssl libraries

commit 6b299cf2c9e577acd6b48eb686cec45ff209aa6a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 19:10:54 2009 +0100

    [configure] fixed LIBDBI detection, the previous change always enabled SQL support regardless if libdbi was installed or not

commit 2960e61a46bdb3414dd1ad334251e1176c5a1117
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 18:20:45 2009 +0100

    [configure] change default linking mode to "dynamic"
    
    This patch forward-ports functionality that was already present on the
    syslog-ng OSE 2.1 branch. It gives the following three linking option to the
    configure script:
    
         * dynamic: are libraries are linked in dynamically, requires dynamic
           libraries on all hosts (--enable-dynamic-linking))
    
         * static: all libraries are linked in statically, requires static versions
           of all libs on the build host (--enable-static-linking)
    
         * mixed (used to be default for 2.0): most 3rd party libraries are linked
           in statically, but the system libraries are linked dynamically.
           (--enable-mixed-linking)
    
    The patch also changes the default linking mode from 'mixed' to 'dynamic' as
    it is much easier to compile syslog-ng that way.

commit 3d3aafe4f3ec3799676ad987874f4912937c973f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Feb 10 10:30:37 2009 +0100

    [config parser] removed unused KW_FRAMED keyword

commit ddc2b2cd0948dd8d4861b0ab0c9dc0fe1735175e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 18:03:16 2009 +0100

    [config parser] accept newly introduced keywords as identifiers (fixes: #17653)

commit f94fe1c758d7ad31d044c8b11e63f4dc88dd5541
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Feb 9 19:56:47 2009 +0100

    [templates] use the correct timezone offset when time_zone_info_get_offset() returns -1
    
    sometimes a time_zone_info_get_offset() returns -1 even for
    zone_info != NULL. Use timestamp->zone_offset in this case.
    
    Also updated the unit test program to use such a TimeZoneInfo instance to
    discover this case in the future.

commit ef216e489d0237a7cab5ff165a4fd090382de504
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Feb 8 15:51:19 2009 +0100

    fixed compilation error on FreeBSD
    
    cfg.c: In function `cfg_reload_config':
    cfg.c:512: warning: implicit declaration of function `kill'
    cfg.c:512: error: `SIGQUIT' undeclared (first use in this function)
    cfg.c:512: error: (Each undeclared identifier is reported only once
    cfg.c:512: error: for each function it appears in.)

commit 0e6f3b03f8eba405a77cacf454607b4a88ba26be
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Feb 8 15:13:12 2009 +0100

    kill the syslog-ng process if reverting to the old config fails
    
    When the configuration is reloaded, syslog-ng attempts to init the new
    configuration and reverts to the old one in case it fails.
    
    However reverting to the old one can fail too, this case was not
    really handled previously. Now syslog-ng tries to kill itself
    using SIGQUIT, in order to have itself relaunched by the supervisor.
    
    There's really nothing else to be done here.

commit 42cb9aa80cf76f71954d32ce6720e0106f38cb87
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Feb 8 15:07:19 2009 +0100

    [main] never initialize the configuration in the supervisor process
    
    Earlier versions of syslog-ng 3.0 initialized the configuration in the
    supervisor process (as root) on non-Linux platforms. However this
    causes trouble on FreeBSD: /dev/klog is kept opened in the supervisor
    which prevents the child process to open the device.
    
    Also, the fds initialized early during startup might be completely bogus
    by the time syslog-ng crashes and the supervisor relaunches syslog-ng.
    (e.g. the fd to /dev/log might already be stale). Thus this behaviour to
    support initializing the configuration as root is changed: now everything
    is done as a non-privileged user if that is requested by the user
    (with -u/-g command line options).
    
    This is somewhat incompatible but I can see no other solutions (except maybe
    supporting other capability-like systems on other platforms).

commit d1b0a90e484c53ddef050836b9f850d3ab340c93
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Feb 8 15:03:57 2009 +0100

    [afsocket] fixed a possible reference of invalid file descriptors

commit 4d8ace150deef4798b0fabf8b2bc1a9444c66932
Author: Tamas Pal <folti@balabit.hun>
Date:   Thu Feb 5 16:37:34 2009 +0100

    Fixed: on linux, dash no longer prinst -e (fixes: #17559)
    
      * contrib/balabit-initscripts/init-functions: if /bin/sh isn't bash on linux,
      use /bin/echo instead of shell buildtin.
    
      * contrib/balabit-initscripts/init-functions: all logging functions use the ECHO variable in an uniform way.
    
    (cherry picked from commit 25d78dcdc57369b63674f86f8d4eba3dd91fea4b)
    (cherry picked from commit d5f8318a272be8571f185f55de4648fb18cf0499)
    (cherry picked from commit e22028a405a8081a74f0c93d60aa159d7754c4d1)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 7836be882431a14602ad162b0062901b9e43c2ea
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Feb 3 20:56:55 2009 +0100

    [tlscontext] added basicConstraints validation even for trusted CA certificates
    
    OpenSSL does not require basicConstraints.CA == TRUE for CA certificates
    that are imported to the trusted certificate store. This check was
    added to syslog-ng's tls_session_verify() callback.
    
    Also clarified added some log messages to make certificate related
    troubleshooting easier.

commit 52ffcead354aeb17b7ee26af53c7123083f450ca
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Feb 3 09:53:26 2009 +0100

    [tlscontext] reorganize cert validation somewhat, fixed "required-untrusted" (fixes: #16671)
    
    Earlier the certificate verify callback was only enabled if the application
    code called tls_session_set_verify(). This was changed in order to always
    enable tlscontext callback, even if app callback was not enabled.
    
    The verify_mode combination previously used for 'required-untrusted'
    (SSL_VERIFY_NONE | SSL_FAIL_IF_NO_PEER_CERT) was not working, in case
    SSL_VERIFY_MODE is set, no validation is performed at all. This was changed
    to use the same value es 'required-trusted' and then the exception is
    handled from the verify callback.

commit d7bbd122ad39e7833ba42a748a568f452ecae091
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 17:58:23 2009 +0100

    [security] enable SSL X.509 policy check

commit 9e1b9e5187837dff059c721073f63092afdba764
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Feb 2 18:07:38 2009 +0100

    Fixed: init script on solaris 8 links /etc/syslog.pid to pidfile. (fixes: #16710)
    
      * contrib/balabit-initscripts/init.d: On Solaris 8, /etc/syslog.pid is
      symlinked to pidfile instead of /var/run/syslog.pid
    
    (cherry picked from commit 9a251ec58f8aab38b2a24abd089000ea8124329d)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 2c58d431c63f76299c775d3bd79b90aa608fd5a6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Feb 2 17:06:29 2009 +0100

    [logproto] don't let the conversion buffer increase to unlimited sizes
    
    the buffer used for converting the incoming byte stream to utf-8 characters
    was not limited in any way, thus making a DoS possible. this patch
    enforces a limit of (max_msg_size * 6) bytes and closes the input stream
    if that number is ever reached.

commit 57498ae22f7a8170e2de30674eba1fb9859c6320
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Feb 2 12:32:20 2009 +0100

    [logproto] properly handle incomplete encodings (fixes: #15680)
    
    since characters can span multiple reads, it is not guaranteed that a single
    read will always result in a completely successful character conversions.
    
    this change makes the char conversion code to remember the leftovers of
    character conversion and uses those during the next read.

commit 04e58c803f896d70c84720e40c2c79aeafe9a6a8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 17:57:11 2009 +0100

    [logproto] remember "encoding" value, so that log messages can contain it

commit b4261ba6ea83ee7a79fe2c3e625deb7785b93b6f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Feb 2 11:09:15 2009 +0100

    really only move to the newly rotated logfile if the new one already has data
    
    The patch 2952187fc67067023870bea565072d78b3162e1a contained a bug which
    caused it to be ineffective, thus the previous behaviour remained. This
    patch fixes this issue, and syslog-ng now properly switches to the new file
    only in case it has received the first chunk of data.

commit 5f57e4de88435638298bd71cc61f28ff77334acf
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 29 13:18:55 2009 +0100

    Fixed: init script don't start syslog-ng when it doesn't run (fixes: #16011)
    
      * contrib/balabit-initscripts/init.d: Added extra check for pidofproc's
        return value in syslogng_start function.
    (cherry picked from commit 1d1e56b9e822107bee9484ca4de0b7be7d571bdb)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 6d1438447d3bb6e590aa179672f85147aec25183
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 29 13:18:38 2009 +0100

    Fixed: init.d  script uses different syslogd pid on redhat (fixes: #16710)
    
      * contrib/balabit-initscripts/init.d: init script links pidfile to
        /var/run/syslogd.pid on redhat.
    (cherry picked from commit 9d27665de284656ab9033ee07ec98dcee421e90b)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 92e2d3963dd0ec67b05e051b9a595f0c8369129d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 29 13:18:07 2009 +0100

    fixed LogMessageMatch structure layout on big-endian 32 bit machines (like PA-RISC)
    
    	this also fixes a failed testcase on HP-UX (test_msgparse).

commit 6a890229568f42fb3f5e5a764b4e91acd1075397
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 17:51:05 2009 +0100

    fixed compilation warnings

commit cacd87d3f7ba9f7974703afa2f59ae7836caf360
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 28 13:40:49 2009 +0100

    [security] user names were not resolved properly, do it right this time

commit 7795bc986773df585a7fccb7d9b173963e430ade
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 28 13:32:01 2009 +0100

    [config parser] fixed a failed assert in case an include directory does not exist

commit c39967aebf1ff969be6990ac7b85edee9ba00e6c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 27 11:48:22 2009 +0100

    Fixed: Solaris 10 method script links /var/run/syslog.pid to syslog-ng's pid. (fixes: #16710)
    
      * contrib/balabit-initscripts/init.d: fixed tabulation.
      * contrib/solaris-packaging/syslog-ng.method: method script makes symlink to
      syslog-ng's pidfile as /var/run/syslog.pid
    
    (cherry picked from commit c2688150fbaf1a2bcdac55c75afc6b5b3e0b58ee)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 73fa6a5f8a5c1c1b7545dd6d1f74ee503cdca59d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 27 11:47:41 2009 +0100

    Fixed: Init scripts link /var/run/syslog.pid to syslog-ng's pid. (fixes: #16710)
    
      * contrib/balabit-initscripts/init.d: Script creates/erases
      /var/run/syslog.pid symlink to the real pidfile. Added reload-or-restart
      target to allow script to be a drop-in replacement to Debian/Ubuntu's
      sysklogd initscript.
      * contrib/balabit-initscripts/init.d.freebsd: Script creates/erases
      /var/run/syslog.pid symlink to the real pidfile.
    
    (cherry picked from commit 94a6d3ccd2ddea2a788028e074386921492b1e3f)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 92842550b763242bbd240d46058d4e8377a3e6b5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 27 11:46:02 2009 +0100

    Fixed: obscure missing file error on HP-UX (fixes: #16710)
    
      * contrib/balabit-initscripts/init-functions: silenced head(1) in
      _pid_from_pidfile. It no longer complains about missing pidfile on a slower
      machine.
    
    (cherry picked from commit e20345664b0a6d9345b7edcb0da549f076cfd674)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit f9099b29dfc1d6f59d63dda4ac430e2ff7c26b27
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 27 11:45:25 2009 +0100

    Fixed: On SuSE -n no longer echoed (fixes: #16025)
    
    init-functions:
      - Changed handling of special characters.
      - echo paramters and bash's string handling changed according to OS
    
    (cherry picked from commit 3ecde3fad10c3d3d4fae11ba02cb46294950afc1)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit a0e6a4eb944c8517bf662f9b7c1510fa3fc320c3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 27 11:43:57 2009 +0100

    Fixed: logic error when checking whether an instance already running. (fixes: #16011)
    
    after `pidofproc -p ${PIDFILE} ${SYSLOGNG} | head -1` $? contains the exit value of head, not pidofproc.
    
    (cherry picked from commit ebae5fdc72aa7e07251c314a4f2679bbda18481c)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit b4c9cac53af79f82d0937f3fb2e22d4914ea5832
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 27 11:42:46 2009 +0100

    Fixed: slng_start checks whether syslog-ng already running before starting a new session. (fixes: #16011)
    
    Some start_daemon implementations don't check if the applicatioin in
    question already running before they blindly start a new instance.
    
    (cherry picked from commit 8389befeca97d26fe9dda2a64a0987e2252b80ba)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 3c5799cf3772c52a080e9568c72dcb0487b6d7a2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 17:49:12 2009 +0100

    [tgzbuild] fixed --with-pidfile-dir configure option
    
    	it lacked the '=' character and therefore the configuration was
    	broken.

commit 5a23b54e3c8cf6f02cfdaba3659f68fed36e040d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 22 11:50:39 2009 +0100

    don't use long double in the parser
    
    	strtold is not portable, thus use a simple double when floating
    	point is needed.

commit 07f7721de85e6c6ca5860d515ff571b4eb73f7b8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 17:31:32 2009 +0100

    [configure script] allow the use of OPENSSL_LIBS/CFLAGS environment variables
    
    Earlier the configure script nulled out these values. This was removed.

commit 0844f9fdfdd12461e09fe8516e3054f3b9363bf4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Feb 14 17:25:58 2009 +0100

    [afsocket] ignore zero sized packets for incoming UDP listeners
    
    This is a regression over 2.1, upon the receipt of a zero size UDP
    datagram syslog-ng interpreted it as an EOF and gave up listening
    for messages.
    
    Added automated testcase to cover this.
    
    Reported-By: ffs@ccn.net

commit 6ca874d7ea362e4f0286245542f7ea601743c72d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Feb 9 11:44:09 2009 +0100

    [configure] added kludge to recognize libdbi without an installed dbi.pc file
    
    libdbi does not always install a pkg-config file, work without one, assuming
    it was installed to the default location.

commit 8ad0edb1e4198bbf657708d07360bbac8b30b55a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Feb 5 11:26:18 2009 +0100

    [affile] validate file type before opening
    
    report an error if a file is opened using the pipe() driver, OR a
    fifo is opened using the file() driver. named pipes should really be
    driven by the pipe() driver.

commit 44fbc3f955755d6772f5a8919b647d61b10bccd5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Feb 5 11:09:17 2009 +0100

    [affile] allow the use of macros in the case of named pipes
    
    previously syslog-ng did not allow the use of templates in naming
    destination named pipes. now it can do that.

commit 5f5d4bd914798c10eef01f6baaf575bc0e3c1557
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Feb 5 11:08:11 2009 +0100

    [affile] make it possible to create named pipes
    
    As reported on the mailing list, syslog-ng is not currently capable of
    creating named pipes on its own. This patch will make syslog-ng
    autocreate pipes when needed.

commit 60aeab750e952b3a69714ea47e2aa31683c761fd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Feb 5 10:50:45 2009 +0100

    fixed the references for non-inline templates
    
    this patch fixes template expansion for non-inline templates. The parser code
    caused these templates to be compiled as many times as they were referenced,
    which in turn concatenated the previously compiled value and the currently
    compiled value.

commit 0a7e892b1a045f9dadeb6650f94639b4f8f22cbe
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 27 11:29:58 2009 +0100

    define TLSSession/TLSContext structures even if SSL is disabled

commit f0bae201b2e9f71f862db170b309aa7a14b4e0c1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jan 26 12:22:46 2009 +0100

    fixed compilation error in tlstransport.c if SSL is disabled

commit 734890b89722889b601600226135e8fea007de0c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jan 23 13:21:08 2009 +0100

    set the default fd limit to 256 on cygwin
    
    	As Corinna Vinschen reports, cygwin does not support very high
    	values for RLIMIT_NOFILE, and the default of 4096 that syslog-ng
    	ships with is too high. This patch uses 256 on cygwin and 4096
    	everywhere else.

commit f7c5cdc40035ddd53aed4aa7032ebd6e3d280af3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 22 20:55:00 2009 +0100

    cygwin packaging updates
    
    	These patches update the cygwin packaging files. Contributed by
    	Corinna Vinschen.

commit ac991448a631bacaea41cf7d255dcb47113d9d8d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 22 10:39:55 2009 +0100

    use #if instead of #ifdef in tlscontext.h to decide whether SSL is enabled

commit 733b0c008a6ced11d92acde1b3ba11d8f24216cc
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 22 10:35:40 2009 +0100

    added documentation link to the "syntax error" message

commit 1c37f96d5fcc71e982685a7af530cd8fb4fb2055
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Sep 17 10:33:22 2008 +0200

    don't write pidfile in case only --syntax-check was requested (fixes: #15374)

commit 11f8d45b016107a686dbfa29497960ae3f6145ac
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jan 16 14:44:53 2009 +0100

    [config parser] "syslog" became a reserved word, make it possible to use that as a facility name
    
    	In syslog-ng 3.0, "syslog" became a reserved word, thus the facility()
    	filter couldn't use it as name for the facility named syslog.
    
    	To avoid having to quote this word, I added a kludge to the
    	config grammar, to make it recognize syslog as a facility name
    	based on context.

commit 2454c75fdc19cf5861cb15e4016b8d31fae662ba
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 14 17:47:31 2009 +0100

    [memtrace] fixed GStaticMutex initialization

commit 239056c762d4ebd41041e6d6ebaabe9c09efae86
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 14 17:47:16 2009 +0100

    [test_logqueue] added threaded testcase for logqueue
    
    	This is currently commented out as some synchronization would be needed
    	between the threads, but as the current problem is now solved,
    	and the synchronization is not trivial, I leave it commented out for
    	now.

commit c62e656554681f365429f317fb93f2eb257145ca
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 14 17:42:56 2009 +0100

    [afsql] fixed crash on AIX where zero-initializing a GStaticMutex renders the mutex useless (fixes: #16306)
    
    	G_STATIC_MUTEX_INIT is not equivalent to zero initializing the
    	mutex on AIX. self->queue_lock has only been zero-initialized
    	and this causes races on the LogQueue instance used to transfer
    	messages between the main and the SQL thread.

commit a60105885c223a879d22f2a41b4a0972061085f9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 14 13:13:55 2009 +0100

    [configure] make pidfiledir default to ${localstatedir}

commit dc7d42b61462c280f945a9bb5a01971d04e79dab
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 14 12:19:06 2009 +0100

    [affile] disable NOMREAD for regular files
    
    	The LPPF_NOMREAD flag is present to prevent multiple reads on
    	/proc/kmsg, however regular files do not need this flag enabling
    	it causes a major limit on the number of messages syslog-ng
    	can read from a regular file.
    
    	With this patch, file sources can fully saturate destinations, and
    	the only limit on the number of messages read from a file is
    	log-fetch-limit() and the flow control window if that is enabled.

commit 701cf5868a75c1531d873a55a7b0a3d15adb1049
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 14 12:06:02 2009 +0100

    allow follow_freq to be a floating number
    
    	This makes it possible to poll files more regularly by specifying
    	a number smaller than 1.

commit 762b961c1aad377e9deb355b70c7d3e7042f3e93
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 11 23:30:25 2008 +0100

    added support for include files/directories
    
    This patch adds support for include files and directories. The syntax to be used
    is simple:
    
    	include "something.conf";
    
    or to include a run-parts style directory (the same filename
    restrictions apply):
    
    	include "conf.d";
    
    Relative paths are relative to the value of ${sysconfdir} and not relative to
    the directory the current file was read from.

commit 6a1313a2158c1e4f98b808dc1b2024ee9c8d3d7f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jan 12 20:16:47 2009 +0100

    fixed an uninitialized variable warning
    
    The warning message is right, when a non-IPv4 & non-UNIX peer sends a
    message is received, then the "netmask()" filter uses an uninitialied
    variable. However the function probably was returning the right value even
    in this case as well by accident.
    
    filter.c:452: warning: 'addr.s_addr' may be used uninitialized in this function
    
    Reported-By: Chanchal Verma <cverma2@csc.com>

commit 781aaab52d397536f4d7dbf8480062a31ebf17f4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 8 21:02:11 2009 +0100

    [parser] implemented store-legacy-msghdr
    
    	for compatibility reasons the original value of the $MSGHDR macro
    	should be saved as otherwise syslog-ng might change this value by
    	adding/removing a space. In some environments this is not
    	permitted.
    
    	This patch implements the 'store-legacy-msghdr' flag which does
    	what the name implies: saves the original value of the MSGHDR.
    
    	Any reference to MSGHDR will pull this value transparently.

commit 266147d51822d7e844c93101787df8dd607a01f2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 8 20:54:55 2009 +0100

    [LogMessage] added support for 32 bit flags field
    
    	The flags field in LogMessage was constrained to 16 bits, and
    	all flags were already taken. This patch expands that field to
    	32 bits.

commit 498b873beb414aeab7579cbb5ed6503e84642fd3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Nov 21 11:52:36 2008 +0100

    make user/group name resolution prior to calling chroot
    
    	Otherwise the chroot would need to have an
    	/etc/passwd & /etc/group file.

commit 1e9761eb06574538a0c0991221912c8504bd1c30
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 19 10:59:04 2008 +0100

    fixed user resolution
    
    	in 2.1.2 a patch was added to properly error-check username
    	resolution. in this patch a typo was present which prevented
    	usernames to be resolved properly.
    
    Conflicts:
    
    	src/misc.c

commit bef64c6b17d54c0e9dea13fd75c32901710a313b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 8 09:27:55 2009 +0100

    fixed compile error: use gint64 instead of off_t in some logreader declarations
    
    if cc -DHAVE_CONFIG_H -I. -I. -I..    -I/usr/local/include/glib-2.0
    -I/usr/local/lib/glib-2.0/include -I/usr/local/include/eventlog
    -D_GNU_SOURCE -D_LARGEFILE_SOURCE -D_FILE_OFFSET_BITS=64  -O2 -pipe -Wall
    -MT logreader.o -MD -MP -MF ".deps/logreader.Tpo" -c -o logreader.o
    logreader.c;  then mv -f ".deps/logreader.Tpo" ".deps/logreader.Po"; else rm
    -f ".deps/logreader.Tpo"; exit 1; fi
    logreader.c:537: error: conflicting types for `log_reader_update_pos'
    logreader.h:89: error: previous declaration of `log_reader_update_pos'

commit ef5eb95d26fcfe3746b78bba8d39cfa2cdb9eeeb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 30 15:22:00 2008 +0100

    [LogReader] only assume that a file was moved if the size of the file is non-zero
    
    If an external logrotate program is used to rotate a logfile, a
    small race still exists when using syslog-ng to read that logfile,
    as described by Evan Rempel:
    
    "
    1. Application is writing to log file named "A".
    2. External log rotation renames "A" to "A.1"
    3. External log rotation touches/creates file named "A" and sets appropriate
        permissions.
    4. Internal timer of syslog-ng is triggered by follow_freq() setting. Syslog-ng will
        switch to the new file "A" because it exists, even though it was created only
        milliseconds earlier.
    5. log rotation signals the application to switch log files (reload or restart).
    6. Application flushes log buffers to current file which is now A.1, but syslog-ng
        is no longer reading this file.
    7. Application closes current log file "A.1" and opens new log file "A".
    
    This sequence will result in the last buffer flush (step 6) from the application to
    be missed by syslog-ng.
    "
    
    This patch makes syslog-ng to switch to the new log file if it already
    received some data.

commit 93a342dae3a2b0cb15811d0c34ea7f58b3fba14e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Dec 24 12:29:34 2008 +0100

    preparations for syslog-ng OSE 3.0.1

commit cbe5443187421a8e43cd14f2608e4e95a7478c36
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Dec 24 12:06:08 2008 +0100

    [macros] changed MONTH_WEEK to mimic strftime week number semantics
    
    	The first week of the month is the one with the first monday in it,
    	everything before that is the 0th week.
    
    	Implementation contributed by Vijay Ramasubramanian
    
    	Also updated test_templates.c to cover this change.

commit c98dda5238a45e8d9881cc908447bfdbdd931446
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 9 22:44:55 2008 +0100

    added implementation of new time related macros
    
    	Patch originally contributed by Vijay Ramasubramanian and reworked
    	by Balazs Scheidler.
    
    	This patch adds the following new macros:
    		YEAR_DAY - the number of the day in the year (1-366, zero padded to 3 digits)
    		MONTH_WEEK - the number of the week in the given month (1-5)
    		MONTH_ABBREV - the English abbreviation of the month name (3 letters)
    		MONTH_NAME - the English name of the month name
    		WEEK_DAY - numeric day of the week (1-7)
    		WEEK_DAY_ABBREV - the English abbreviation of the name of the day (3 letters)
    		WEEK_DAY_NAME - the English name of the day
    
    	Day and month names don't use the locale setting and always expand
    	to the English names.

commit 3716f3fbfffbf219c39bdbe96df299a027cad935
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 9 09:30:25 2008 +0100

    fixed path to the syslog-ng-failure script

commit 2daf3c79cf961d6cf1ab423b99c54c65118caacb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Nov 23 16:34:55 2008 +0100

    rewrite: fix up reference matches before changing the referenced value
    
    	syslog-ng tries hard to store regexp matches as references to
    	the values the match was parsed from. However in case the
    	referenced value gets rewritten, these matches become corrupt.
    
    	This patch basically duplicate the referenced values before those
    	are overwritten.

commit 02a9e580135dfae55bdbcbdf0fd2c509ed3d88ac
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Nov 18 15:04:59 2008 +0100

    fixed compilation error in tlscontext.c if SSL is disabled
    
    	Modified patch by Joe Shaw, tlscontext.c used various openssl
    	references which should not be compiled if SSL is disabled.

commit e1cc669c935c20aad18ca613cb2923679f42113b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Nov 18 14:43:01 2008 +0100

    fixed compilation error because of a bogus forward-port of the last HP-UX fix
    
    /home/bazsi/zwa/work/syslog-ng-ose-3.0/syslog-ng-ose/src/logwriter.c: In function ‘log_writer_fd_dispatch’:
    /home/bazsi/zwa/work/syslog-ng-ose-3.0/syslog-ng-ose/src/logwriter.c:241: error: ‘LogWriterWatch’ has no member named ‘fd’

commit af3885097c3e65c708bf3d69e62ca26550aee3b4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Nov 18 14:40:37 2008 +0100

    when TLS support is not enabled and no openssl libraries are present

commit 3cc8403d03f1e1125f69f17fb0969779af776f59
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Nov 18 10:25:41 2008 +0100

    added chdir call after chroot, fixes CVE-2008-5110
    
            syslog-ng did not change the current directory after
            restricting itself to a chroot jail, which makes it
            possible to break out of the jail.
    
            Please NOTE that this does not constitute an exploitable
            vulnerability on its own. It only means that _if_ there'd
            be a vulnerability, it'd be easier to break out of the
            chroot jail.
    
            Please also NOTE that if syslog-ng is running in the chroot
            as root, the same vulnerability still exists. Please use
            --user and --group command line options in combination with
            --chroot.

commit 962745eab12396da117586c0c4ea8d9abeea0f81
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 6 12:04:28 2008 +0100

    fixed 100% CPU spinning on HP-UX upon a connection break
    
    As I see the problem seems to be caused by the fact that HP-UX returns
    POLLERR only without the other bits (e.g. POLLHUP) syslog-ng would
    handle this gracefully if either the other bits would be set, or there'd
    be some pending messages to send, in which case a normal write() error
    would occur.
    
    Conflicts:
    
    	src/logwriter.c
    
    Conflicts:
    
    	src/logwriter.c

commit 4baf320d71ad3419d7ecd7e41614a35080a36ed7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 6 11:44:47 2008 +0100

    add x permission to debian/rules

commit e31a593a0b184409246a0c9a9c0e7a27713b3741
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 6 11:44:37 2008 +0100

    removed flex 2.5.34 dependency
    
    	an AIX compilation issue was fixed by using the flex directive
    	%top, but that's not supported in older flex.
    
    	however the same can be achieved by defining the _LARGE_FILES
    	macro on the command line, and then no %top is required.

commit 8ee7d72e8c8015e214edd39629af7779e5167d74
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 6 11:06:08 2008 +0100

    updated AUTHORS file

commit f53550471db700ea94037f60f562f4e3338b50f6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 5 09:54:32 2008 +0100

    don't redefine the MIN macro in loggen if it is already defined
    
    loggen.c:26:1: warning: "MIN" redefined
    In file included from /usr/include/netdb.h:90,
                     from loggen.c:12:
    /usr/include/sys/param.h:192:1: warning: this is the location of the previous definition

commit 0e630ceddfa345a39c2971d715f573f4c820a92e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 5 09:12:30 2008 +0100

    added inclusion of <string.h> into cfg-grammar.y to fix compilation errors on OpenBSD (fixes: nobug)

commit a58cf918685201d06a4efec7f746beb9f7338b7e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Oct 6 18:31:48 2008 +0200

    fixed filter() evaluation operators, evaluate LHS and then RHS instead of the other way around
    
    	Problem reported by Csaba Martha, an expression like this:
    
    	  match(a) AND match(b)
    
    	is evaluated in the order match(b) and then match(a). This ruins the concept
    	of extracting fields from a message with regexps.
    
    	This patch fixes the issue and also might improve performance as
    	it is usually recommended to use less-expensive filters first.

commit d92cf796bacbe1b378a4e83bdd8389019ff32581
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Sep 23 10:22:32 2008 +0200

    handle non-numeric user/group names as errors instead of silently falling back to the root user
    
            Heath N. Caldwell contributed a fix to report invalid numbers as
            errors. This patch is a slightly modified version.

commit 0cf087192ae79351ec3df75ca467e51241ae4950
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 5 20:56:55 2008 +0100

    added log message about peer connections

commit 81090c4610cf9259819a63b961a237a9033784d3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 5 20:54:26 2008 +0100

    configure.in: make sure enable_env_wrapper is either set to yes or no
    
    	previously "auto" was also possible, but that's not a valid value.

commit 24465c23c3b365fb3863018dae08c05359f45c81
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Oct 9 15:25:54 2008 +0200

    Fixed: Use BalaBit's LSB implementation on all redhat platforms. (fixes: #16012)
    
    RHEL 5's start_daemon implementation accepts only the -f (force) and -n
    <level> (nice) options. Any other option causes an infinite loop...
    
    (cherry picked from commit 46e63ce6d29e650201689e28aad7d61b85aaa68b)
    (cherry picked from commit 3fe55754cfcea2c24b702d76c4a45b114b143567)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 94f36fa8b2c273d6f8f1623a2e8aa2459b817fda
Author: Tamas Pal <folti@balabit.hu>
Date:   Thu Oct 9 14:17:16 2008 +0200

    Fixed: stopping daemon now works on solaris 10 (fixed: #16013)
    
    (cherry picked from commit 6f433b36a64942c93e2386fdb419b4fcbc6aa5f8)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 686c9d87b28e5463c54fbe46a16b04a038f40e12
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Oct 9 14:11:19 2008 +0200

    Fixed: waiting for syslog-ng to shut down now works. (fixes: #16009)
    
    slng_waitforpid's second parameter is the binary's name, not the pidfile....
    (cherry picked from commit cb14d763c3c6e4574c71a7e09c8cdaa346553f73)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit e1f99ceca5e13ec69819e24c151dea5b7a2aa885
Author: Tamas Pal <folti@balabit.hu>
Date:   Wed Oct 8 19:17:52 2008 +0200

    Fixed: initscript on SuSE uses BalaBit's init-functions (fixes: #16008)
    
    SuSE's LSB function implementation is broken throughly. Init script now uses our implementation of init-functions.
    
    (cherry picked from commit 1e9c224a3d489aaa2a823b7d819bd90df83504d5)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 90326afb417f4fa1f12f1550b91e0c87bac0f2e9
Author: Tamas Pal <folti@balabit.hu>
Date:   Wed Oct 8 14:31:04 2008 +0200

    Fixed: initscript checks whether syslog-ng runs before it tries to stop it. (fixes: #15961)
    
    Amalagated init script now checks properly whether syslog-ng runs before it tries to stop it.
    (cherry picked from commit e3fdfe91249f50347d5af059de1e410d7c898afc)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 020699ddc821075beb9dcf73dc7b5991fbaf1dac
Author: Tamas Pal <folti@balabit.hu>
Date:   Wed Oct 8 14:30:35 2008 +0200

    Fixed: Restart now works properly when init script uses our init-functions. (fixes: #15238)
    
    _pid_of_proc() always initializes the pid variable in the BalaBit's init-functions.
    (cherry picked from commit 7ad7d62c04feaf4877f8bc3594b29f0eecfa0cdc)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit bd6ae15b38b11eb68c1896c2dec271e5d2b1e17f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Oct 8 14:01:08 2008 +0200

    fixed syslog-protocol receiver related leak, the buffer was not freed (fixes: #15976)

commit 25723391baab06bf294e217dfc133b607603c591
Author: Tamas Pal <folti@balabit.hu>
Date:   Wed Oct 8 10:41:08 2008 +0200

    Fixed: Pass pidfile to pidofproc in syslogng_status(). (fixes: #15963)
    
    (cherry picked from commit 5f07d7b9868d306934bcfd6bbc631cd26dd39294)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 1d4e72ad6a60f61c4a5d4e60e356a4e1465af46d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Oct 8 10:33:00 2008 +0200

    search local timezone files first, then the system supplied files (fixes: #14860)

commit b607d0c2dffcfa86e075e1ff73c6a7cded756cb6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Oct 8 09:57:54 2008 +0200

    block TERM/HUP/INT/CHLD signals in worker threads (fixes: #15109)
    
    	HP-UX delivers these signals to a random thread unless they
    	are blocked in the given thread. Block these signals in all
    	threads except the main thread, this ensures that the main
    	loop wakes up if it needs to.

commit 3ddbcd73dc98a9611c9ff54dc67a095270559735
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Oct 7 22:29:24 2008 +0200

    fixed wrapper related regressions
    
    	the wrapper related changes caused syslog-ng not to be built
    	on some platforms, these were fixed in this patch.

commit 0acacd3a3d9008cbe09bbc65bd5b1f47e1c7080d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Oct 6 13:50:01 2008 +0200

    added support for a separate env setup wrapper program (fixes: #15828)
    
            Solaris does not allow a process to set its own LD_LIBRARY_PATH
            before calling dlopen(), thus we need a wrapper for that purpose.
    
            This patch introduces --enable-wrapper flag that will generate
            syslog-ng in libexec, and a small program in sbin that executes
            libexec/syslog-ng once environment variables are set up.

commit dfd8a71cbfbb7cf0632bacb8afd1ad42e72dd999
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Oct 7 12:07:54 2008 +0200

    added some more termination points to the SQL thread to make exit faster (fixes: #15109)

commit 17603d1aedf691403595993b62c4b0cbf4a6e341
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Oct 7 11:44:10 2008 +0200

    fixed a possible partial initialization/deinitialization problem (fixes: #15957)
    
    	In some cases the configuration could be initialized/deinitialized
    	only partially which may cause segfaults. For instance on
    	FreeBSD if /dev/klog is opened, the config after the HUP cannot
    	be initialized. In that case the new configuration will only
    	partially be initialized causing possible segfaults.
    
    	See the bugreport for more information.

commit add67657ef3b527260aceb3e7e00c316ce20bc2d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Oct 7 10:25:52 2008 +0200

    link against libcl.so on HP-UX to solve Oracle dynamic loading problem (fixes: #15959)

commit c46a218111023dafb044fc608549448dd3080122
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Oct 6 16:29:25 2008 +0200

    added AIX support for LD_LIBRARY_PATH setup (fixes: #15828)
    
    	For some reason AIX uses LIBPATH instead of LD_LIBRARY_PATH.

commit d33c496e672c12a8d27ae31fff1c09b961e86327
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Oct 6 13:50:01 2008 +0200

    set LD_LIBRARY_PATH explicitly from the syslog-ng binary in order to find database library dependencies (fixes: #15828)

commit b65e81cae60ac18ec92ba6d37937641272d3ccfc
Author: Gabor Palasti <pala@balabit.hu>
Date:   Sat Oct 4 16:05:50 2008 +0200

    Added the xml and method file for solaris-10 install. Fixes: 15822
    
    (cherry picked from commit 0ec597b32b84a7ea0b388c67eeef37d36b5b5661)
    (cherry picked from syslog-ng-pe--dev-pala--3.0)

commit fa3cbe0744ca1e16a0db0548c7dd7f16bb210ff6
Author: Pal Tamas <folti@balabit.hu>
Date:   Sat Oct 4 13:35:15 2008 +0200

    init scripts wait while syslog-ng exists before exiting/restartting.(fixes: #1306)
    
    (cherry picked from commit 2aaf8fdae488e04acc43cd5efa65081f144c0eb8)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 5c5bffe24f13d9c4521c4f98d9c628aec6aae184
Author: Pal Tamas <folti@balabit.hu>
Date:   Sat Oct 4 13:33:20 2008 +0200

    fixed solaris unfriendlyness init init-functions. (fixes: #15907)
    
    (cherry picked from commit 4ce6fda9b5282ea6eb935e15c48a782796fb7b96)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 0acb421e6bf41a7d105834b7ea3b028f43655816
Author: Pal Tamas <folti@balabit.hu>
Date:   Sat Oct 4 13:31:38 2008 +0200

    fixed LSB typos in init.d. (fixes: #15826)
    
    (cherry picked from commit 5090872d9ce65efeece16fa6d0c06edfd18571b9)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 892d4672552771fe1a7f3d4fedeeb79806eeff33
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Oct 4 13:27:00 2008 +0200

    fixed logic error in killproc. Added reading check for slow machines. (fixes: #15238)
    
    (cherry picked from commit 40215a8d5aa24001ce7a14fd5eb2d1ef27d55a96)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 5f2faa7fd09ec66c3d1336133e65657020a65dd9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Oct 4 13:12:25 2008 +0200

    fixed evt_tag_printf() format string problems (fixes: #15904)
    
    	after telling gcc to validate evt_tag_printf() calls, some
    	warnings were triggered, one of them causing a segfault.
    	this has been fixed.

commit 559e160efd9a4f5ed608533c3f3884cde9de02dd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Oct 2 17:08:52 2008 +0200

    fixed possible corruption of the afsocket source connection list in case the TLS context couldn't be initialized (fixes: #15872)

commit 11611b12aea3f5a2528413535ed6d0370e7d0683
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Oct 2 16:06:14 2008 +0200

    fixed possible read-only use after-free in log_writer_flush_log (fixes: #nobug)
    
    ==29313== Invalid read of size 2
    ==29313==    at 0x43898F: log_writer_flush_log (logwriter.c:655)
    ==29313==    by 0x437714: log_writer_fd_dispatch (logwriter.c:222)
    ==29313==    by 0x45A617: g_main_context_dispatch (in /home/bazsi/.zwa/install/syslog-ng-pe-3.0/sbin/syslog-ng)
    ==29313==    by 0x45D515: g_main_context_iterate (in /home/bazsi/.zwa/install/syslog-ng-pe-3.0/sbin/syslog-ng)
    ==29313==    by 0x45D999: g_main_context_iteration (in /home/bazsi/.zwa/install/syslog-ng-pe-3.0/sbin/syslog-ng)
    ==29313==    by 0x406DBB: main_loop_run (main.c:144)
    ==29313==    by 0x4076F4: main (main.c:489)
    ==29313==  Address 0x7d5b218 is 8 bytes inside a block of size 184 free'd
    ==29313==    at 0x4C22B2E: free (vg_replace_malloc.c:323)
    ==29313==    by 0x40ECE4: log_msg_free (logmsg.c:2323)
    ==29313==    by 0x40EDAA: log_msg_unref (logmsg.c:2352)
    ==29313==    by 0x43898A: log_writer_flush_log (logwriter.c:654)
    ==29313==    by 0x437714: log_writer_fd_dispatch (logwriter.c:222)
    ==29313==    by 0x45A617: g_main_context_dispatch (in /home/bazsi/.zwa/install/syslog-ng-pe-3.0/sbin/syslog-ng)
    ==29313==    by 0x45D515: g_main_context_iterate (in /home/bazsi/.zwa/install/syslog-ng-pe-3.0/sbin/syslog-ng)
    ==29313==    by 0x45D999: g_main_context_iteration (in /home/bazsi/.zwa/install/syslog-ng-pe-3.0/sbin/syslog-ng)
    ==29313==    by 0x406DBB: main_loop_run (main.c:144)
    ==29313==    by 0x4076F4: main (main.c:489)

commit ea31745c38b32673807075d13ada7a21632280c3
Author: ILLES, Marton <marci@balabit.hu>
Date:   Fri Sep 26 19:41:17 2008 +0200

    only store pattern db matches if match has a name (fixes: nobug)

commit 6896291f3003f9495aea056cc5eeed3d45bf1b0a
Author: Tamas Pal <folti@balabit.hu>
Date:   Fri Sep 26 09:55:04 2008 +0200

    _checkpid works on solaris. (fixes: #15585)
    
    (cherry picked from commit 1811aaaf7d2ace681634c4563d6bdeb6d7c3b9ab)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit bcd8d1c19511f139cc1dabf3ddec4b7b47809159
Author: Tamas Pal <folti@balabit.hu>
Date:   Fri Sep 26 09:54:11 2008 +0200

    use our roll of init-functions on hardy (fixes: #15584)
    
    (cherry picked from commit 3ea8e0dbc238ddfd5d8424175140dd1dcad21abf)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 7c172d3747f62f2a1035994afeff2fff07636aa7
Author: Tamas Pal <folti@balabit.hu>
Date:   Fri Sep 26 09:44:59 2008 +0200

    reload passes pidfile to killproc. (fixes: #15582)
    
    (cherry picked from commit 1b7015e60cca595e68137260a0f784af0cadf7d3)
    (cherry picked from syslog-ng-pe--dev-folti--3.0)

commit 64ea922915759b9aa723b8c53eb2829d781fa807
Author: Tamas Pal <folti@balabit.hu>
Date:   Fri Sep 26 09:44:07 2008 +0200

    install only the needed directories from contrib
    
    (cherry picked from commit f887b600f6c253611bf47fc31f8fc888e30f61e4)

commit b3fad5f844f91746aee269f8542ca97f1736e27d
Author: Gabor Palasti <pala@balabit.hu>
Date:   Fri Sep 26 09:39:30 2008 +0200

    Save buildopts at the end of the build
    
    (cherry picked from commit d9ba59a50f7a1b035da10a23d4bd4ae543515282)
    (cherry picked from syslog-ng-pe--dev-pala--3.0)

commit 517b3f041b89e64937d4c52784ff0c4c6c59c196
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Sep 25 17:49:14 2008 +0200

    fixed SEQNUM processing (fixes: #15791)

commit 81eaecb6cdf76d9249bf7db291345a2f886ee69b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 5 17:32:34 2008 +0100

    changed VERSION to 3.0 to avoid confusion

commit b0770b9706a9f99ba91d9927379de286e0cd30ee
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Oct 18 13:27:03 2008 +0200

    fixed multiple compilation problems in afsql.c

commit 4ec847a1cf5557b1c84990923922cca6de898ecd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Oct 6 09:47:24 2008 +0200

    fixed tgz2build/Makefile.am not to reference a syslog-ng-premium-edition.files file
    
    It fixes make dist failing with this error message:
    
    make[1]: *** No rule to make target `syslog-ng-premium-edition.files', needed by `distdir'.  Stop.
    make[1]: Leaving directory `/var/etalon/compile/snapshots/syslog-ng-3.0/syslog-ng/tgz2build'

commit e5cc770d7c6d29060929789549120d9c8c1fccbd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Oct 6 09:25:47 2008 +0200

    removed remaining refguide rules from doc/Makefile.am

commit da034a9e5b2e1db46954ebeb2d39c40f2ac514c7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Oct 5 14:59:55 2008 +0200

    removed unnecessary rnd.in file from unit tests

commit 0a287bd61240503a970e6431d4ebfb65d42b469d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Oct 1 15:06:34 2008 +0200

    backport most of the 3.0 PE features into OSE

commit 1bffb002ab3ef4b9854e1379cd9dc329523059df
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Sep 4 09:12:37 2008 +0200

    fixed port number in tcp statistics messages (fixes: #nobug)

commit ab7b55509881f0bfb76ba76a2e8d5fe762b92b96
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Sep 3 12:36:40 2008 +0200

    changed GAtomicCounter type to gint instead of guint16 to allow window sizes larger than 65536
    
    	This also synces syslog-ng with the 3.0 branch, where this is already gint instead of guint16.

commit 71becaa9f5aad8f82a43284dfec34e769dfd6b9e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Aug 28 09:29:25 2008 +0200

    preparations for 2.1.1

commit fdfe73646fdd8aa91ec1380c38cd5b0cb5720f9c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jul 29 15:13:37 2008 +0200

    the netmask filter matches messages with no sockaddr as if they came from 127.0.0.1 (fixes: #nobug)

commit 49416f5e605cc8778ed5ba0c2ec5945198e763e8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jul 20 20:37:09 2008 +0200

    added "suppressed" type to stats_generate_log()

commit 45c5c3cd2e4c40759606a011dd056884598d9f08
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jul 2 12:49:46 2008 +0200

    loggen: fixed compile issue for platforms which lack the AI_ADDRCONFIG flag

commit a52b518aef79c95b07a1e50e98dff866d2a0e7b8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jun 13 14:44:17 2008 +0200

    preparations for syslog-ng 2.1beta2

commit 521fa3d0d1fd7e0f3b1075616c216d248c96e625
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jun 10 15:38:48 2008 +0200

    fixed $PID macro evaluation to only parse pid information in the syslog header (fixes: pub#22)
    
    	Earlier $PID attempted to seek for a '[]' enclosed string within
    	$MSG but that may include non-pid values if the message payload
    	contains a bracket enclosed string and the application does not.

commit f29847f042fb40e54f10b36bc0ef8dc8612f9b08
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jun 9 14:08:01 2008 +0200

    make dynamic linking the default
    
    	Some users have trouble compiling syslog-ng in the default
    	semi-static build as several operating systems lack a proper, static
    	glib library. Therefore the default was changed to use dynamic
    	linking and the previous behaviour can be used by passing
    	--disable-dynamic-linking to the configure script.

commit f39e60ac40e3a980039aae50b216e7afad5d80fa
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jun 9 12:27:50 2008 +0200

    don't suppress messages that are too long apart
    
    	My changes to the suppression patches caused it to suppress messages
    	even if two messages came in in a longer time than was specified for
    	suppress(), the reason is that I missed an additional condition in
    	the if that checks for suppressions.

commit a9c4e45f22162ca8bd450897c0280b8a88458e88
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jun 9 12:21:54 2008 +0200

    Implement "Last message repeated N times" functionality.
    
    	This behaviour can be enabled by adding the new "suppress(<num>)" option to
    	an output configuration e.g.
    
    	destination tologfile { file("/var/log/messages" template(t) suppress(30)); };
    
    	As a log message is added to the queue it is remembered as the last message
    	seen.
    
    	When a new message is added to the queue it is checked against the last
    	message. If its contents are the same the message is dropped and a counter
    	incremented.
    
    	A message summary indicating the value of the last message counter and a
    	snippet of the message will be inserted into the log queue if a new message
    	that differs is seen or if the configurable timeout period expires.
    
    	This patch was contributed by Chris Packham <chris.packham@alliedtelesis.co.nz>
    	and modified by Balazs Scheidler.

commit f7b9c007db6b0d472b5d11710b25f32b10c461ac
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jun 9 11:41:18 2008 +0200

    added lseek before write instead of O_APPEND as the latter is slow on NFS

commit bb4848d519f7156163590f2cb9e843562c0ad46c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jun 3 11:08:29 2008 +0200

    added setsid() and chdir to daemonize function
    
    	Become the session leader and chdir to root once syslog-ng is
    	daemonized. It will stay in the current directory if it is requested
    	to run in the foreground.

commit 6598835ec3e79017b8d18b9792a88fe0a41171db
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 26 17:11:38 2008 +0200

    attempt to resolve the target hostname during initialization (fixes: #13879)
    
    	The IP address might have been used by an old version of syslog-ng
    	in the naming of the peristent-config entry.

commit 74d469009cda865684dffdbb7f90fedfb73dac8a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu May 29 21:19:48 2008 +0200

    use destination hostname in statistics message in place of the numeric IP

commit 3eee0a4e0b9070cdceaaad092fe5119852cf6bd5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu May 22 15:41:29 2008 +0200

    removed testing code that injected write errors into syslog-ng
    
    	There was an error injection code to test the new destination file
    	write suspend patches. This code was removed.

commit c25daae97e7821f788f6cec66201838b618c8449
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu May 22 11:16:55 2008 +0200

    changed autogen.sh to force pkg-config dependency to 0.14 in distributed packages

commit 46d06a96cebcd76248a76b1c5d072acd7541834f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed May 21 19:06:12 2008 +0200

    fixed 100% cpu spinning for pipe destinations
    
    	Pipe destinations are handled the same as files, and a patch was
    	committed to 2.1.10 to avoid polling files, as they are always
    	writable. The problem that this also covered pipes, effectively
    	causing a spinning poll loop.
    
    	This patch turns off this new feature if the destination is a pipe.

commit dc59a79522ebf37ba80c08d47a9bca4b14b966d0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed May 21 18:31:50 2008 +0200

    ignore CR in line endings

commit e2e266c0d6c9480c3b9321d2bb89322469093a45
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Apr 21 12:50:59 2008 +0200

    added the creation of the /var/lib/syslog-ng directory to RPM postinst (fixes: #13031)

commit 4e7bb9e47c0f11614f91d0d7335ef8ebd7d1ded7
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Apr 18 18:15:36 2008 +0200

    Preparations for syslog-ng 2.1beta1

commit d1d497b9654a6ede2a9bfb1541a12058ad194e07
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Apr 18 18:12:25 2008 +0200

    fixed year recognition heuristics
    
    	When the syslog sender's clock is too fast, the heuristics used to
    	determine the year value in timestamps that do not contain one, was
    	wrong. The extracted year value was one year before the actual year.

commit a583ac77ce3f6228d86230c248fee93ecc4e8932
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 13 18:39:45 2008 +0200

    suspend writing a destination file when an I/O error occurs
    
    	Instead of continously looping on a failed file destination, log I/O
    	error once and retry writing after some time elapses. Solves the
    	problem with disk full problems.
    
    	Fixes public bugzilla #3.

commit 56f6115c623f793a75a37ba9af6e505d7c781907
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Apr 12 19:27:51 2008 +0200

    do not fail startup if connection to the server fails
    
            Do not fail startup if connection to the TCP server fails for any
            reason, like DNS resolution errors or any other TCP problem. Also,
            DNS names are automatically re-resolved for further connection
            attempts.
    
            Fixes public bugzilla #19.

commit 476a72e1d927d3404e22866bd9310c6013938d1b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Apr 9 21:30:50 2008 +0200

    made LinkSys timestamp parsing stricter
    
    	Only take the year value as year if the timestamp is terminated with a space.

commit 1749c8abbea0ac917d1937bee1e0c8a9900bc392
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Apr 7 17:02:19 2008 +0200

    added support for the BSDTAG macro
    
    	This patch was contributed by Jung Christian to implement the BSDTAG
    	macro which produces facility/priority information in logfiles in a
    	similar format to what the FreeBSD syslogd can produce.

commit 22e09dad0914cc3487f55d8f919b213313eb3cae
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 31 14:53:27 2008 +0200

    added LD_LIBRARY_PATH to the svc manager method script

commit 3c5c5f03e3a73b1375141e5f8bfa10c3900c55f1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 31 09:42:44 2008 +0200

    Fixed svc method script permissions and added an export to LD_LIBRARY_PATH

commit 5858ccd9088285938017378f6e794302ee23219e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Mar 31 10:32:15 2008 +0200

    fixed compilation issue on freebsd, include stat.h in misc.c

commit 5c54b98e09f4d28da3795ff6a631aafcb87187d8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Mar 27 15:29:07 2008 +0100

    fixed compilation problem on AIX 5.2

commit f77b05e179e3be8e14998fb5778fe18552fef2eb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Mar 25 11:03:16 2008 +0100

    added somewhat more user-friendly syntax error message in the configuration parser

commit eed3565599212161a4030acc8094bbce3906b834
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Mar 23 22:32:39 2008 +0100

    ported to FreeBSD
    
    2008-03-07  Tamas Pal <folti@balabit.hu>
    
        	* configure.in: Added O_LARGEFILE checking macro. Removed linuxism.
        	  Added Freebsd specific options to GLIB_LIBS.
        	* contib/Makefile.am: Added the contents of freebsd-contrib to
        	  EXTRA_DIST
        	* contrib/freebsd-packaging/syslog-ng.conf.example: Added example
        	  config file.
        	* contrib/freebsd-packaging/syslog-ng.rc.d: Added rc.d
        	  file(/etc/init.d for you SysV types:)
        	* tgzbuild/configure_opts: Added --bindir options to install loggen
        	  to its proper place.
        	* tgzbuild/postbuild: Added FreeBSD specific postinst stuff. Added
        	  loggen to Linux's strip.
        	* src/affile.c: Moved O_LARGEFILE declaration to syslog-ng.h
        	* src/afsql.c: Added #include <string.h>.
        	* src/syslog-ng.h: Moved O_LARGEFILE declaration here.
        	* src/afuser.c: Includes util.h ig getutent missing on the system.

commit 6c212941197ba3ac709fd07391ed622facb564fc
Author: Tamas Pal <folti@balabit.hu>
Date:   Thu Mar 13 15:49:21 2008 +0100

    fixed solaris packaging. Binary statically linked on Solaris 8/9, dynamically on 10.

commit 0831d1d4a026e04e55144df2d0e61d122e7b8c82
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Mar 18 19:06:43 2008 +0100

    Added Solaris 10 specific svc manager files

commit 5a5439fccd3d5ae1db9ee073ed1043b15b756581
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Feb 21 17:10:09 2008 +0100

    file fds are always writable, don't poll them

commit 4de7f364ce8f29eb9b4cb56632060a7b0ed75acb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Mar 23 22:06:11 2008 +0100

    backported end-of-message search algorithm from PE
    
    	Backported the algorithm used in the Premium Edition of syslog-ng to
    	search for the end-of-message. This gives improved performance and
    	NUL is not preferred over NL in incoming connections.

commit 44ad59885a9244a1ec475b3006e68d688126bc07
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Mar 12 11:21:50 2008 +0100

    fixed possible segfault for non-existing optional source files
    
    	The file position of log sources is remembered accross
    	reloads/restarts, however if a file is optional, it might happen
    	that it is not opened, thus its position cannot be recorded. The
    	current code did not take this into account and might have
    	referenced a NULL pointer.

commit 5b65710e9781203d005e6f4bcb3f33bad4f827b6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Feb 24 12:28:54 2008 +0100

    Fixed door initialization on Solaris
    
    	The door used by Solaris log transport was initialized before going
    	into the background, however the door mechanism uses threads, which
    	were started before a fork() call, effectively rendering the whole
    	door part of syslog-ng ineffective.
    
    	This patch changes door initialization to be performed after the
    	initial fork.
    
    	Also the STREAMS device is changed to non-blocking mode and the
    	STREAMS read function was fixed to return EAGAIN to its caller.

commit 33f45d65490c2e8e3c52e468ec733266a0230b13
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Feb 20 18:44:32 2008 +0100

    implement multiple accepts per poll iteration to address performance problems
    
    	The rate of incoming connections were limited by one per poll
    	iteration, which essentially limited the number of connections per
    	second to somewhere between 3-5000. To increase this number the
    	number of accepts were increased to 30 / poll iteration. This should
    	be enough so that the bottleneck will be elsewhere.
    
    	The accept limit is currently hard-wired, I doubt it's going to be
    	needed by anyone to tune, let me know if I'm wrong. :)

commit c36d980974dffa6324a62d0470d45af2fe222578
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Feb 13 20:10:45 2008 +0100

    don't call initgroups() if run_as_user is NULL
    
    	Reported and fixed by Roger J Meier.

commit 99c407f89068280f09284decd403a91693b4fe18
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Feb 8 16:44:21 2008 +0100

    fixed possible abort in DNS cache if the hosts file contains multiple lines with the same address

commit 081cc40c089cc6bf431606d8c2e28caef862600b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Feb 8 16:57:48 2008 +0100

    added --enable-sql in syslog-ng.spec.bb and removed from tgzbuild/configure_opts

commit a99b063fe0828630d4510e589b4ea9e4a0a4139b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jan 30 17:46:56 2008 +0100

    save mtime of /etc/hosts file once loaded

commit e070826ec5058e7a99bfedfce1f367617f70db6d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jan 28 16:33:03 2008 +0100

    added cygwin packaging files to the source distribution

commit 60a4a3f3d502378509c100c58338fe5856fa8675
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Jan 28 13:12:58 2008 +0100

    added execute permission to cygwin packaging files

commit 41e8384aaba781c5681d39634f82e49ce20e60cd
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 27 20:43:19 2008 +0100

    fixed checking the DNS cache size limit
    
    	Persistent entries were also counted into the dns_cache_size()
    	limit, this is not good as if you have a large /etc/hosts file, it
    	might deplete your cache space.
    
    	Spotted by Steve Bernacki

commit 258bdb41ad6350a19528fc36fc17b7e629d3b3f9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 27 20:19:14 2008 +0100

    added cygwin packaging files to contrib
    
    	Cygwin packaging files were contributed by Corinna Vinschen
    
            * contrib/cygwin-packaging/cygwin-postinstall: New script for
            packing Cygwin net distribution.
            * contrib/cygwin-packaging/syslog-ng-config: New script for
            run-time configuration of syslog-ng as part of a Cygwin net
            distribution.

commit 61c755e670f2771b56e6c6950aabae392e280c87
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jan 26 15:26:44 2008 +0100

    fixed RH configuration file sample in contrib
    
    	Fixed up some syntax errors in the RH configuration file. Fixes
    	submitted by Joe Fegan.

commit 2a9b2c6fe330c8b33b9f39441db2bbadadb8c2a0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 17 11:02:19 2008 +0100

    SIGHUP did not reopen files as needed for logrotation, fixed that
    
    2008-01-17  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_dw_init): don't create a new writer instance
    	  if one exists,
    	(affile_dw_deinit): don't free the LogWriter instance, only deinit
    	(affile_dw_free): free writer here,
    	(affile_dw_set_owner): be sure to change writer->control as well as
    	writer options, fixed potential use-after-free after SIGHUP,
    	(affile_dd_reuse_writer): call log_pipe_init for each dest writer,
    	(affile_dd_init): call log_pipe_init if no writer hash is used,
    	(affile_dd_deinit_writer): new function,
    	(affile_dd_deinit): call log_pipe_deinit for each destination
    	writer,
    
    	* src/logwriter.c (log_writer_set_options): added control argument
    	  as when the ownership of LogWriter is changed, both the Options
    	  and the control pointer needs to be changed

commit cdbf2c5b63d1a974c0be84e27c1fed644157b1ea
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jan 26 15:35:34 2008 +0100

    fixed gthread detection when SQL is enabled

commit e62f2bf98d68dfd26fd4722b8034fc4f0395cc09
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jan 26 15:35:50 2008 +0100

    fixed Solaris packaging to build on AMD64

commit 2a057fbc117c25bccfbe8e55ed28b927def9cff4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 15 19:56:31 2008 +0100

    packaging fixes on Debian

commit 9b20a77faae72d75c3d86758ef87948c9793b326
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 13 10:37:11 2008 +0100

    removed unneeded MARK tags from afsql.h

commit 84ff8c2b22bd75fcf81df40c1d06ad37d5019a44
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 13 10:21:25 2008 +0100

    preparations for 2.1alpha1 release

commit 13f1961d38280b7c5f69711bbdab22220acc08bb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 13 10:18:16 2008 +0100

    removed unused --seed-rng command line option

commit f77519b296eaa4420cf246e6fad30273d6202e21
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 13 10:17:03 2008 +0100

    removed some unneeded disk-buffer related declarations

commit 9fd942cf8f8dc81756b293cca46fe1e5462c724f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 13 10:06:50 2008 +0100

    fixed a possible race in func_test.py

commit 2a10d8f5140b9830def99f51a81896b8ea48c559
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Jan 13 09:05:53 2008 +0100

    added support for textual representation for service names to loggen
    
    	Loggen assumed the port number specified by the user in the command
    	line is numeric. This change suggested by Corinna Vinschen
    	implements service lookup from /etc/services

commit 196f130fb37d14d88c4533a8bc388c91293493a6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 8 16:33:52 2008 +0100

    avoid the use of getaddrinfo() in loggen if it is not present on the system

commit 0e7791823999ee699dbcec223972c12c907dedcb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jan 8 09:08:31 2008 +0100

    incorporated portability fixes by Corinna Vinschen
    
    2008-01-08  Balazs Scheidler <bazsi@balabit.hu>
    
            * src/afsocket.c (afsocket_sd_process_connection): Allow building
            with tcp_wrappers if AF_INET6 is unknown (patch by Corinna Vinschen).
            (afsocket_dd_format_stats_name): Guard AF_INET6 case with ENABLE_IPV6.
            * tests/loggen/loggen.c (usage): Fix typo in usage output.
            (main): Require argument for -s in getopt/getopt_long.

commit 048179b0ad11eab50382728f3767efb2e4a6314d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jan 3 13:00:34 2008 +0100

    fixed compilation warnings, RH + Debian packaging

commit 401468d9863f0c3798d5fb0ad36fcb12795f09fb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Dec 29 18:48:12 2007 +0100

    added unit testcase for program name parsing in test_msgparse (fixes: #15)

commit 87c4312af53692b547fdb2735b0eea1b0d96b2b2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Dec 29 18:42:05 2007 +0100

    don't terminate program name field by anything else but space, ':' and '['
    
    2007-12-29  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logmsg.c (log_msg_parse): the program name should not be
    	terminated by '/', this is used by postfix for instance (fixes: pub#15)

commit 5d33e05e204bac26ef6edc53c7091035c3f1ac0f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 27 18:56:12 2007 +0100

    fixed portability issues in the test programs

commit 348e32b36cf6523d9898240952ea63f04078f6a3
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 27 14:26:48 2007 +0100

    protect with possibly blocking operations with alarm() to avoid system deadlocks
    
    2007-12-27  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_sd_init): set a read timeout to avoid
            blocking on /proc/kmsg
    
    	* src/afuser.c (afuser_dd_queue): handle the blocking on write()
    
    	* src/fdread.c, src/fdwrite.c: added support for read/write timeouts

commit b4cb3f71cd4e2ad4886d4608163493fd8933c73f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 27 13:59:14 2007 +0100

    added loggen tool to generate messages at the specified rate

commit 01a70c2b68152f6d7d962182dd050fc50621fd6d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Dec 21 12:27:23 2007 +0100

    fixed parsing too long fraction of a second parsing, fixed ISO timestamp parsing that have no timezone information
    
    2007-12-21  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logmsg.c (log_msg_parse): if an overly long fraction of a second
    	portion was present in an ISO timestamp, the fraction part was
    	zeroed out,
    	(log_msg_parse): for ISO timestamps without timezone information,
    	the parsed date was wrong
    
    	* tests/unit/test_msgparse.c: added testcase for the changes above

commit 72e2dd4b9cf49f1b21a21f7c3375bc41206cf5f0
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 20 19:43:48 2007 +0100

    increase the poll priority of the "reaper" timer

commit ffd49bfb0db5ae72a62eebe5a11aec2ada830c23
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 18 10:27:53 2007 +0100

    use packet-terminated logreader for STREAMS log device on solaris
    
    2007-12-18  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afstreams.c (afstreams_sd_init): specify the LR_PKTTERM flag
    	  for the logreader to avoid STREAMS buffer overflows (and the
    	  STREAMS device gives us a complete message anyway)

commit ec8247bb730464490aae675605bbbd8769df9ac5
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jan 12 14:50:34 2008 +0100

    changed VERSION to 2.1alpha1 to ensure that the version for daily snapshots is less than 2.1.1

commit 9fcf6fb28697759ff1a0594697f8f8b1d56edc62
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Jan 12 14:48:54 2008 +0100

    backported SQL destination driver from the Premium Edition

commit b629b4f527284af76662c2dc5dab325435201ecc
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Dec 20 20:18:36 2007 +0100

    backported syslog-ng core changes from the Premium Edition

commit f4eebb57da3e947bbd4002933bceec03cbfae519
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 18 14:38:53 2007 +0100

    changed version number to 2.1.0 starting the GPL 2.1.0 branch

commit 93ede29f8d91a1d34eba485b80eb6f23c3bf196b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 17 15:12:35 2007 +0100

    added support for LinkSys RV style timestamps (year at the end) (fixes: pub#4)
    
    2007-12-17  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logmsg.c (log_msg_parse): added support for LinkSys RV-style
    	  timestamps (fixes: pub#4)

commit 761235af58ec24c4aa10c2b114b8008c4dfb492b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Dec 12 09:16:21 2007 +0100

    fixed a possible segfault on incorrectly formatted dns-cache-hosts() file
    
    2007-12-12  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/dnscache.c (dns_cache_check_hosts): fixed possible NULL derefs
            in hosts file parsing

commit 39e54c9b7ad73d6863d345125eec6f8cf61d4451
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 10 13:16:19 2007 +0100

    allow specifying the name of the persistent configuration file (--persist-file)
    
    2007-12-10  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/main.c (main): added --persist-file option
    
    	* src/cfg.c (persist_config_save, persist_config_load): added
    	  filename option

commit 63ce1bba3dff8c0645035025d221349e3d5ec59c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 10 13:10:40 2007 +0100

    avoid "duplicate persist info" for non-existing file sources that cannot be opened
    
    2007-12-10  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_sd_init): retrieve persistent information
    	  even if the file does not exist to avoid a warning message

commit c29352e3a3b61d207106aafae305ba909d454b2a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Dec 5 11:55:03 2007 +0100

    fixed possible null-deref for destination files not containing macros
    
    2007-12-05  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_dd_init): don't call affile_dw_set_owner if
    	  writer is NULL

commit e7fab310a71572405877ee1cf76ab8a7b23cff9a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Dec 1 17:07:35 2007 +0100

    remember destination file writers accross config reloads
    
    2007-12-01  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_dw_reapable): new function, returns whenever
            a destination file writer is allowed to be reaped (e.g. it has no
            messages buffered),
    	(affile_dw_set_owner): new function, since DW instances are
            remembered accross reloads, instances created for an old
            configuration need to be reattached to the new AFFileDestDriver
            instance, in the new configuration,
            (affile_dd_format_persist_name): new function, formats the
            persistent name for AFFileDestDriver,
    	(affile_dd_reap_writers): don't reap writers that return FALSE for
            affile_dw_reapable,
    	(affile_dd_reuse_writer): new function, used to reattach orphaned
            writers to the new AFFileDestDriver instance,
    	(affile_dd_init): recover writer_hash & writer from the persistent
            configuration,
    	(affile_dd_destroy_writer): new function, deinit & unref a writer,
    	(affile_dd_destroy_writer_hr): renamed from
            affile_dd_remove_writers, use the new affile_dd_destroy_writer
            function,
    	(affile_dd_destroy_writer_hash): new function, destroy-notify
            callback for the writer_hash,
    	(affile_dd_deinit): save both the writer_hash & writer as persistent
            config,
    	(affile_dd_queue): next pointer was changed from a generic LogPipe
            to AFFileDestWriter,
    
    	* src/affile.h (AFFileDestDriver): the "writer" member is changed to
            AFFileDestWriter,
    
    	* src/logwriter.c, src/logwriter.h (log_writer_set_options): new
            function

commit e3a2a25a989d191e5304f0398f38f0f01f3c8197
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Dec 5 11:52:16 2007 +0100

    added support for file sources that don't exist upon start-up
    
    2007-12-05  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logreader.c (log_reader_fd_check): only perform followed-file
            checks, if the file is already opened
    
    	* src/affile.c (affile_sd_init): defer file open if the file-follow
            mode is enabled  (patch contributed by Charles G Waldman)

commit b1e13c19053157713b5ae922f45cbe4b2902a42b
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 4 13:49:01 2007 +0100

    added support for fsync() option
    
    2007-12-04  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/fdwrite.h (FDWrite): added fsync member
    
    	* src/fdwrite.c (fd_write): call fsync() if self->fsync is set
    
    	* src/cfg-grammar.y: moved KW_FSYNC keyword to be affile specific
    
    	* src/affile.c (affile_dd_set_fsync): new function sets AFFILE_FSYNC
            flag if fsync is to be enabled,
    	(affile_dw_init): set fd_write->fsync if AFFILE_FSYNC is enabled

commit 9b563fe89063b4aeef93406236768ef9feb881ce
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Dec 4 13:46:38 2007 +0100

    added "mark" as an alias for "mark_freq" for compatibility with 1.6
    
    2007-12-04  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-lex.l: added "mark" keyword for compatibility with 1.6

commit 0c40dc606321d611b746f67a01c656985af336be
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 3 15:10:06 2007 +0100

    fixed flow-control problem related to source files
    
    2007-12-03  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logreader.c (log_reader_fd_check): recheck whether the source
    	  is permitted to generate more messages and always return FALSE if
    	  it is not.

commit c7a9126b57187899cf2fe8e4c39f82fd6e11288f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Dec 3 14:33:24 2007 +0100

    Solaris zero-length UNIX domain socket bind problem fixed
    
    2007-12-03  Balazs Scheidler <bazsi@balabit.hu>
    
            * src/gsockaddr.c (g_sockaddr_unix_bind): new function, avoids the
              bind operation if strlen(sock_name) == 0

commit 90772af11b469b9527a9d0b6673bd49200d71782
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Nov 27 11:17:47 2007 +0100

    clarified NEWS for 2.0.6

commit df07ea70ada35e1f997e6a7c1936dc4ce1069ce1
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Nov 27 10:46:43 2007 +0100

    preparations for 2.0.6

commit 1661ca746f13eacf3c5e0d08640dd00c71548d11
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 22 10:29:08 2007 +0100

    fixed ipv6 address resolution as only parts of the sockaddr_in6 structure were copied
    
    2007-11-22  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afinet.c (afinet_resolve_name): instead of copying only the
    	  in6_addr member of the sockaddr_in6 structure, copy the whole to
    	  allow propagating scope-id and flowinfo too.

commit 6b11b9d66387189206c1191f17450fda8d97b7e8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 19 10:33:54 2007 +0100

    fixed a possible segfault related to IPv6 stats-name
    
    2007-11-19  Philib Bellino <pbellino@mrv.com>
    
    	* src/afsocket.c (afsocket_dd_format_stats_name): Using IPv6 for a
    	destination of tcp6 or udp6: There was no case statement for
    	AF_INET6 and as a result, “driver_name” was never filled in with
    	either tcp6 or udp6.  The subsequent routine (g_snprintf) that used
    	“driver_name” caused a segmentation fault.  This is now fixed.

commit 093db87c4e57a912f4feb1e2144ef6c084280fb9
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 19 10:21:59 2007 +0100

    fixed stderr logging during startup, error messages should be displayed

commit 7be90e38b1f581282d74fbbca4eed856b63730d2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Nov 14 11:50:37 2007 +0100

    set LD_LIBRARY_PATH on Solaris8

commit 4b92a02ff8013519b4c5140914201bdb0fb6d2db
Author: Tamas Pal <folti@balabit.hu>
Date:   Thu Sep 27 15:29:22 2007 +0200

    Final tgzbuild update. Added LFS documentation and init.d script handler.

commit 0248af5d43a016fd985e4d4e1cb9a28c02bb1ef9
Author: Tamas Pal <folti@balabit.hu>
Date:   Wed Sep 26 18:30:25 2007 +0200

    Added Linux From Scratch support to tgzbuild. Updated tgzbuild to build the oldway tgz's on hpux.

commit 5fcbce2a536efc072c57589b0bccfd784b19f6a2
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon Nov 26 09:23:00 2007 +0100

    Backported Solaris build fixes from PE

commit 3126ebad217e7fd6356f4733ca33f571aa87a170
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Nov 22 15:39:14 2007 +0100

    fixed possible segmentation fault in input parsing (DoS possibility)
    
    2007-11-22  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logmsg.c (log_msg_parse): fixed possible NULL pointer
    	  dereference in log message parsing
    
    	* tests/unit/test_msgparse.c: added testcases for improperly
    	  formatted ISO timestamps that can cause a segfault

commit 09c462b997a2f34ce8bf541d20736cba47532911
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Nov 16 08:56:25 2007 +0100

    only enable gcc specific CC options when building with gcc

commit a848b4a7dc9edef724266f42d6ae88cf0bc308df
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Nov 13 09:20:30 2007 +0100

    added a sanity check to configure, checks whether glib bit number matches that of the compiler's

commit 429ead1e2c62ba30f1e7859e80067def248be136
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 3 22:39:36 2007 +0100

    adapted test_msgparse unit test program to the latest program name parsing changes
    
    2007-11-03  Balazs Scheidler <bazsi@balabit.hu>
    
    	* tests/unit/test_msgparse.c: an earlier change causes the program
    	  name to be terminated by space, adapted test program

commit 1d6aa2598fa5d16b53725fe6867c5a3cb0909f68
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 3 22:38:23 2007 +0100

    fixed a possible glib warning when freeing templates, triggered by glib 2.14

commit 98c081c4e02409adbf79fdea6960766065addf7f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Nov 3 22:37:41 2007 +0100

    fixed handling the time_zone() specification specified in the configuration file
    
    2007-11-03  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logmsg.c (log_msg_parse): make sure a timezone is set for
    	incoming messages even if they originally had -1 as timezone,
    	(log_msg_init): initialize stamp.zone_offset to -1 instead of the
    	local timezone offset value

commit 4a84d904fe0fc5b3627773bafe6966ad9037386d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Oct 23 18:48:36 2007 +0200

    use the same algorithm for parsing program names when a date stamp is present and ommitted
    
    2007-10-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logmsg.c (log_msg_parse): program name was parsed differently
    	  whenever a date stamp was present or when it was omitted, the two
    	  cases were brought back together, reported by Tsurusawa Takeshi

commit 6cd4fdaea7d77f1facd36d6fde04ae57d3e51233
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Oct 23 17:04:46 2007 +0200

    unset destination/bind address if a name resolution error occurs (fixes: #12393)
    
    2007-10-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afinet.c (afinet_resolve_name): changed prototype to require a
    	  pointer to GSockAddr *, set the passed reference to NULL whenever
    	  a resolve error occurs (fixes: #12393),
    	  (various functions): changed all afinet_resolve_name invocations
    	  to use the new prototype

commit 3823310acc6d40e01457934b64295710661ef9c6
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Sep 26 16:34:23 2007 +0200

    fixed tgzbuild Makefile

commit 184d79fde77768f023a8077b1e63d35cd251cd52
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Sep 20 21:54:10 2007 +0200

    fixed a possible segmentation fault when parsing the PID value from the input
    
    2007-09-20  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/macros.c (log_macro_expand): fixed PRI macro expansion

commit f705d56940ded0c98113aaca8437c3d57743e1f8
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Sep 22 16:38:31 2007 +0200

    backported HP-UX related build and runtime fixes from syslog-ng PE
    
    2007-09-22  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: added HP-UX + gcc specific CFLAGS to get all symbols
    	  we need (_HPUX_SOURCE), also added a warning on a buggy system
    	  headers, fixed HP-UX link options
    
    	* tgzbuild/*: added tgz binary packaging for ZBS
    
    	* contrib/hpux-packaging/*: new files, default configuration files
    	  for HP-UX
    
    	* src/afunix.c (afunix_sd_init): fixed compilation warnings on
    	  HP-UX, added explicit casts for uid_t, gid_t and mode_t
    
    	* src/logreader.c (log_reader_iterate_buf): fix message processing
    	  on padded pipes that is used by HP-UX
    
    	* src/syslog-ng.h: added some macros for platforms that miss strtoll

commit f4a72eb785573e5a962ec5008735e149afcb585d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jul 31 21:47:59 2007 +0200

    fixed a memory leak in loading persistent config
    
    2007-07-31  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg.c (persist_config_load): always free "key" as it is not
    	saved in the persist config structure, thus it is the responsibility
    	of persist_config_load to free it

commit 61ca189fb227bf1bfe89e72e734232c67cb9ef5f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jul 26 12:46:40 2007 +0200

    fixed memory leaks reported by Anthony Lineham
    
    2007-07-26  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/templates.c (log_template_free): the compiled template was not
    	freed previously
    
    	* src/cfg-grammar.y: fixed a double-ref problem on templates which
    	caused a memory leak accross HUPs (reported & fixed by Anthony
            Lineham)

commit 8b8fd488a023c9b1f00545745ea334727867c07c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 20 14:43:34 2007 +0200

    preparations for 2.0.5

commit 6dc7e422950ae51e34921f7b0fd36e2a2673fd96
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 20 14:43:34 2007 +0200

    added unit testcases for BSD timestamps

commit 71d858ed1db047c4f12777d1c51a4fd7dbcdffdb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri Jul 20 14:43:34 2007 +0200

    fixed a possible segfault during exit when syslog-ng was reloaded
    
    2007-07-20  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/main.c (main_loop_run): pass GlobalConfig pointer by reference
    	  so that the main function can see the reloaded value when
    	  performing exit
    
    Conflicts:
    
    	src/main.c

commit 4e275da6e459b862f6d292b28f0b688116609262
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Thu Jul 19 23:25:18 2007 +0200

    added support for fraction of seconds in BSD timestamps (Cisco extension)

commit bb87003eb09e0735d233ed959a8cdb463f52ce4d
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jul 18 16:17:33 2007 +0200

    fixed possible blocking on /proc/kmsg during boot
    
    2007-07-18  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logreader.c (log_reader_fetch_log): bail out when we came in
    	because some data was still in the buffer and LR_NOMREAD is enabled

commit 1f7ffea1f87ee3f2bbbd876c06b87d9f795d2506
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jun 27 10:25:58 2007 +0200

    clarified verbosity for tcp-wrapper rejected connections

commit 81c6aa3123f2bd6131e8b75435d4f3ea8f399b0f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jun 20 10:42:55 2007 +0200

    fixed propagation of global log_fifo_size option
    
    2007-06-20  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logwriter.c (log_writer_options_init): use MAX instead of MIN
            to determine propagated log_fifo_size value

commit 3c583ba01e8c11bfcb7536ccaed47c5610b9268c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Wed Jun 13 13:35:51 2007 +0200

    added support for PIX timestamp format
    
    	* src/logmsg.c (log_msg_parse): added support for PIX timestamp
    	format
    
    	* tests/unit/test_msgparse.c: added testcase with a PIX timestamp

commit 0ace68b8ba708426cfc867933d0ad9e1952e1911
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue Jun 12 13:57:47 2007 +0200

    increased default 'max-connections' limit to 256 for UNIX domain socket sources

commit 538923cd725f54ba7aa89a8f339653e2a6e88a6e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 26 18:41:36 2007 +0200

    fixed localstatedir in the RedHat spec file

commit 82092d8b6ed3388c29c4523899c184fef2a2e669
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat May 26 18:41:11 2007 +0200

    configure fixes for easier compilation on systems which lack libnet/libwrap or IPv6

commit 112817e654f3795f5a18c93be8c0c3ab4895af3c
Author: Jan-Frode Myklebust <janfrode@tanso.net>
Date:   Fri May 25 23:11:18 2007 +0200

    Created syslogd_var_lib_t to label /var/lib/syslog-ng.
    
    Created labeling rule for /var/lib/syslog-ng.

commit e4e03d136da53dbcc22be671ac14620c42772d08
Author: Jan-Frode Myklebust <janfrode@tanso.net>
Date:   Mon May 21 23:19:23 2007 +0200

    Changed module to allow var_lib_t access, instead of var_t, since
    
    syslog-ng.persist should be located in /var/lib/syslog-ng/. Remember
    to use configure --localstatedir=/var/lib/syslog-ng/.

commit 599ad23de6fe40d50e067bfab2775ec5b212ec52
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 21 19:56:54 2007 +0200

    added syslog_ng SELinux module

commit 2288151086e2557c8a30e37c1b4a37a7b373fffb
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 21 18:47:34 2007 +0200

    fixed implicit declaration of strtol warning
    
    	* src/afinet.c: added include <stdlib.h> to fix
    	implicit declaration of strtol warning

commit 7a15aec9931e6f6f670029a08a194f3134522733
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue May 15 16:40:43 2007 +0200

    added libnet1-dev to build-depends in Debian packaging

commit f83425e224dc0c0fc7c033322bc3f392616b9791
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Tue May 15 16:14:10 2007 +0200

    AIX packaging fixes

commit 014f77e92260011e828f55ed0a74e766171c13ed
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 14 13:44:56 2007 +0200

    NEWS fixes

commit 5a6908187e37d583efa1113d944aafd2f6d9269f
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 14 12:08:18 2007 +0200

    preparations for 2.0.4

commit bc2a1807ed181b2e427b43a55c2c94b3bf56524a
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Mon May 14 12:04:16 2007 +0200

    added libglib2.0-dev to build-depends

commit 3425f2af9611deafc9c017437d7bee7514369076
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Apr 28 16:21:48 2007 +0200

    fixed max_connections counting
    
    2007-04-28  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_sd_process_connection): fixed
    	num_connections counter

commit 7caa8e2ce5d98c93367ad85a7ed30e22730c6203
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Fri May 4 17:51:01 2007 +0200

    fixed timezone offset sign when parsing from the configuration file
    
    2007-05-04  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg.c (cfg_timezone_value): fixed sign parsing

commit ba918f857a7140efc2e35d6b1afa9da1024bf359
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 29 23:23:30 2007 +0200

    fixed segfault in afsocket when an unACKed message is still in the queue at deinit time
    
    2007-04-29  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_sc_deinit): remove self from the owner's
    	connection list at deinit instead of at free time, as if the

commit 47f53555268efb72ab8db2d620d7669b8e5dc7a4
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sun Apr 29 18:53:46 2007 +0200

    added support for Perl-like regexp flags to support case-ignoring matches
    
    2007-04-28  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/filter.c (filter_re_compile): parse '(?i)' at the beginning of
    	regexps as an ignore-case flag, just like Perl does

commit 0145307482375c8b0c027329e5a43ec4451f596c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Apr 21 08:22:03 2007 +0200

    unit test cleanups
    
    2007-04-21  Balazs Scheidler <bazsi@balabit.hu>
    
    	* tests/unit/test_filters.c: added a testcase covering the facility
    	filter evaluation problem reported by Evan Rempel
    
    	* tests/unit/test_dnscache.c: decreased timeouts in order for the
    	test to run faster

commit bea9a79e6bed6fca15db5df1922a32935150ab7c
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Apr 21 08:18:21 2007 +0200

    updated .gitignore files

commit 5d83cc6635768ea4948498862b27794c910c1c8e
Author: Balazs Scheidler <bazsi@balabit.hu>
Date:   Sat Apr 21 08:17:41 2007 +0200

    fixed facility filter evaluation problems
    
    2007-04-21  Balazs Scheidler
    
    	* src/cfg-grammar.y (filter_fac_list, filter_level_list): use
              bitwise or instead of addition to combine fac/level bitmasks
    
    	* src/filter.c (FilterFacility): the valid mask was changed, it now
              contains one bit for each facility instead of one bit for each
              facility ID, the latter made "auth" and "security" facilities
              differ, even though they have the same code,
              (filter_facility_eval): removed the bulk of the code because of
              the simplification mentioned above,
    
            * src/syslog-names.h (syslog_name_lookup_level_by_name): use an
              inline function instead of a macro,
              (syslog_name_lookup_facility_by_name): demacroized, return the
              facility code instead of the id

commit 04968fb70920b6c938a2f29df47579e8afa9c94a
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:24 2007 +0200

    use stat instead of seek to determine file size
    
    	* src/logreader.c (log_reader_fd_check): remove lseek based file
    	size determination and use lseek instead, it is not glibc that is
    	buggy, and although gdb reports invalid contents of the stat
    	results, the program sees them correctly

commit af843292d5b236e63048b719491fec8ea8291050
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:22 2007 +0200

    added support for logrotation in file sources
    
    2007-04-06  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_sd_open_file): new function, contains the
    	file open code for the source driver,
    	(affile_sd_notify): new function, registered as the notificatio
    	handler for an affile source, for NC_FILE_MOVED notifications
    	construct a new the log reader and drop the old one,
    	(affile_sd_init): use affile_sd_open_file,
    	(affile_sd_new): register notification handler, tell our LogReader
    	the filename that we are following

commit 132512fb18888c8680085f49ba4501907837cbd7
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:19 2007 +0200

    fixed expansion of utf-8 characters in templates
    
    	* src/macros.c (result_append): use guchar as the type of the
    	argument instead of gchar
    
    	* tests/unit/test_templates.c: use utf8 sequences in the message
    	string to ensure that syslog-ng handles them properly

commit 3781e41ba8f4aeaf741cef12eea6f9abae4aeffd
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:16 2007 +0200

    fixed numeric localport/destport specificatio
    
    	* src/afinet.c (afinet_set_port, afinet_sd_set_localport,
    	afinet_dd_set_localport, afinet_dd_set_destport): removed port
    	argument, always use 'service' and check if it's numeric
    
    	* src/cfg-grammar.y: follow afinet changes

commit 9f95aacd02bc0f57a518fec02cba955fc521bb02
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:13 2007 +0200

    grammar fixes for localport/port/destport parsing options
    
    	* src/cfg-grammar.y: fixed grammar to parse port related options correctly

commit 56198c7880d86361fca339480eaaf9f95d68985e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:11 2007 +0200

    preparations for 2.0.3 release

commit 4c036edb889e4e9f280117445e2af94d2ea11634
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:08 2007 +0200

    increased the minimum value for log_fifo_size to 1000

commit 7f5afab87fa20c643c5a6bfeb5edefaba5447ba4
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:05 2007 +0200

    fixed dns_cache_hosts() typo in documentatio

commit bf0d73e1e19679a94fb083d4f1d74e3c59f3ebb3
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:02 2007 +0200

    some more message clarificatio

commit 1500404018a4704234ef0cd1514a15aeab7b83ee
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:14:00 2007 +0200

    clarified internal message severities
    
    	* src/*.c: clarified the severity value of some log messages
    	generated by syslog-ng

commit 3457ead49a4969e9fc79cc6f94664c697ce19852
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:57 2007 +0200

    clarified message priorities

commit bab7ef259d12894e5dd903940974575fadeeef8e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:54 2007 +0200

    added support for remembering input file positions
    
    	* configure.in: added LARGEFILE_SOURCE & FILE_OFFSET_BITS to
    	CPPFLAGS, export localstatedir to syslog-ng,
    
    	* src/affile.c (affile_sd_format_persist_name): new function,
    	formats the persistent name associated with the file source,
    	(affile_sd_init): check if the current file position is available
    	and set it if it is,
    	(affile_sd_deinit): save the current file position,
    
    	* src/afsocket.c (afsocket_sd_kill_connection_list): new function,
    	frees a connection list,
     	(afsocket_sd_deinit): fixed a possible SIGSEGV, a GList was freed as
    	an AFSocketSourceDriver, I wonder how this got unnoticed so far,
    
    	* src/cfg.c (persist_config_add_entry): new function,
    	(persist_config_add): use the new add_entry function,
    	(persist_config_add_survivor): new function, adds a surviving entry,
    	(PersistentConfig): added saving/loading persistent config entries,
    
    	* src/logreader.c (log_reader_watch_new): don't seek the file to the
    	end-of-file now as proper file position is recovered,
    	(log_reader_set_pos, log_reader_get_pos): new functions
    
    	* src/main.c (main): added --ignore-persistent option, use a
    	persistent configuration object around stop/start to save/restore
    	file position informatio

commit c80638e3f0400695f5da1e17b1f5eecac1b44e84
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:51 2007 +0200

    tightened LogMessage struct, added support for more than 9 match groups
    
    	* src/logmsg.h (LogMessage): structure tightened a bit, avoid
    	double-referencing various message-parts by inlining GString
    	declarations, instead of allocating them at runtime to be more cache
    	friendly, use 8 bit values for ref_cnt, flags, pri; re_matches is
    	allocated at runtime to allow more matches
    
    	* src/filter.c (filter_re_eval): dynamically allocate the
    	msg->re_matches array, follow LogMessage changes
    
    	* src/templates.c (log_template_compile): support ${} syntax for
    	regex match replacements to allow more than 9 matches
    
    	* src/afuser.c, src/logreader.c, src/logwriter.c, src/sgroup.c,
    	src/test_msgparse.c, src/test_template.c: follow LogMessage
    	changes

commit 8f6af7e8174edbd1b779bc3726ed10661131e754
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:49 2007 +0200

    clarified SIGTERM message
    
    	* src/main.c (main_loop_run): clarified message about the receptio
    	of a SIGTERM or SIGINT signal

commit dd08565110c995e49caf36c12089b686afa7422e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:46 2007 +0200

    updated copyright strings

commit 7b38c6dc1b910a2e0d4a067bd4de4f8aa2886703
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:42 2007 +0200

    implemented TCP wrapper support
    
    	* configure.in: added tests for libwrap
    
    	* src/afsocket.c: added support for libwrap access control

commit f36bc3fd75693accf66e1b54b1e040aaa743eb8a
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:39 2007 +0200

    added endutent() to usertty destination
    
    	* src/afuser.c (afuser_dd_queue): added missing endutent call()

commit 2258cb1f463f8884e1e7eaa72e45911b4e58b78f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:37 2007 +0200

    removed 1024 byte limitation on internal messages
    
    	* src/messages.c (msg_send_internal_message): use a dynamically
    	allocated buffer instead of a buffer with a fixed size on the stack

commit 5f0c2f9e64c57a1c67427df91bf7b28f54614832
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:34 2007 +0200

    added testcases for 2007 DST changes
    
    	* tests/unit/test_zone.c (main): added testcases for 2007 DST
    	changes in the USA

commit 70e5fa5fe70d2145db26c818b229d6491e3588c0
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:31 2007 +0200

    added dist.conf to dist

commit 92f4e100faf74566de3b02665445ab49e4600046
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:28 2007 +0200

    further portability fixes
    
    	* configure.in: added check for -lresolv

commit e1e907e9af5b536ef9fe218e9270510b49d30c14
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:26 2007 +0200

    portability fixes for platforms without IPv6 support
    
    	* configure.in: added checks for struct sockaddr_storage
    
    	* src/cfg-grammar.y: make sure it compiles even if AF_INET6 is not
    	defined
    
    	* src/cfg-lex.l: don't define udp6/tcp6 keywords if ENABLE_IPV6 is
    	not defined
    
    	* src/dnscache.c: added conditional blocks for IPv6 related code
    
    	* src/misc.c (resolve_hostname): -"-
    
    	* src/fdread.c (fd_do_read): use plain "struct sockaddr" if struct
    	sockaddr_storage is not defined

commit 302c89262224c66a7cafd7f3103418fbe796c484
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:23 2007 +0200

    implemented spoof-source support for both ipv4/ipv6
    
    	* configure.in: added --with-libnet and --enable-spoof-source
    	options
    
    	* src/afinet.c (afinet_dd_set_spoof_source): new function, called
    	from the parser to enable spoof-source,
    	(afinet_dd_init): new function,
    	(afinet_dd_construct_ipv4_packet): -"-,
    	(afinet_dd_construct_ipv6_packet): -"-,
    	(afinet_dd_queue): -"-,
    	(affile_dd_new): register new init/queue methods,
    
    	* src/sgroup.h, src/dgroup.h: renamed ref/unref functions for
    	consistency
    
    	* src/cfg-lex.l, src/cfg-grammar.y: added spoof-source optio
    
    	* src/logwriter.c (log_writer_format_log): removed static as it is
    	directly used by spoof-source to format messages

commit b7a573f1a52c83bac2696cd900af11dd6d8d81f1
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:20 2007 +0200

    added netinet/in.h to afinet.c
    
    	* src/afinet.c: added inclusion of <netinet/in.h> as it caused
    	problems on HP-UX

commit b5d724d1eb78219176f845bf1a978c7343128ca9
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:17 2007 +0200

    added check for getutent in configure
    
    	* configure.in: added getutent() check

commit d2d3e560aefe98e0aadf85885fd01b6861eeb87a
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:13:07 2007 +0200

    integrated AIX packaging fixes from dev-folti
    
    Patches applied:
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-2
       Fixed: AIX5.2 packaging support. (fixes: #10375)
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-3
       Fixes: added libevtlog-dev build dependency. (fixes: #10375)
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-5
       Fixed: RPM packaging for 2.0. (fixes: #nobug)
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-7
       Refresh: Fixed: AIX5.2 packaging support. (fixes: #10375)
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-8
       Refresh: Fixes: added libevtlog-dev build dependency. (fixes: #10375)
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-9
       Refresh: Fixed: RPM packaging for 2.0. (fixes: #nobug)
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-10
       Fixed: removed duplicated install commanands from spec file. (fixes #nobug)

commit ae13d6ce4a965933088f208e44eb7621a82c5319
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:52 2007 +0200

    fixed possible crash in usertty() driver
    
    	* src/afuser.c (afuser_dd_queue): don't ack the message if flow
    	control was off (fixes possible crash reported by Bryan Henderson)

commit 79a769ad1f4d1999d809c5f5b8d51a5ad71d9dc5
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:49 2007 +0200

    Synced to test
    
    X-Sync-Point: test

commit 0911f2b844a100f27629cd52acb5da5f635928b5
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:45 2007 +0200

    missed version change

commit 91c2c608ee6e1c06f73b214173e67e62810794ec
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:42 2007 +0200

    preparations for 2.0.2

commit e6386d45fef17c89c50fe99a08fd70ed732503f6
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:40 2007 +0200

    fixed handling utmp entries where a full path is included as tty name
    
    	* src/afuser.c (afuser_dd_queue): check if ut->ut_line starts with a
    	'/' and use it directly if it does, otherwise prepend '/dev/' as before.

commit d34bb6d0b143acde47f05ec5c36903d410c2049e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:37 2007 +0200

    fixed trailing 0 and n characters in messages received on dgram transport
    
    	* src/logmsg.c (log_msg_parse): remove trailing n and 0 characters
    	which are often added to the end of incoming datagrams

commit bd3499aa214088789dc06b80c0a004e05bc63ec2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:34 2007 +0200

    fixed parsing group information when not enclosed in quotes
    
    	* src/cfg-grammar.y (string_or_number): use non-terminal string
    	instead of STRING to support non-quoted group specificatio

commit f5afdfc2597aae25396b6e531544182396a58b31
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:32 2007 +0200

    fixed IPv6 related portability problem in DNS cache
    
    	* src/dnscache.c (dns_cache_key_hash): don't use the unportable
    	s6_addr32 member in struct in6_addr, use an explicit cast instead

commit c84ef1e0bdaab8f1f62edb7f1d53883d0494109e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:29 2007 +0200

    added tcp-keep-alive keyword for compatibility

commit dc7ad1e4c7d396a314eb11a977fe49ab1cccf628
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:26 2007 +0200

    updated documentation with so_keepalive optio

commit 36a3d22cce9a5a7abe08d02b49ba8245164c687e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:24 2007 +0200

    added so_keepalive support
    
    	* src/cfg-grammar.y: added KW_SO_KEEPALIVE keyword,
    	(socket_option): added KW_SO_KEEPALIVE rule
    
    	* src/afsocket.h (SocketOptions): added keepalive member,
    
    	* src/afsocket.c (afsocket_setup_socket): set SO_KEEPALIVE socket
    	option based on the keepalive parameter

commit 837e9fb74fd2385d3bb2ed4f933a13a54ad005d6
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:21 2007 +0200

    fixed XML syntax error in refguide

commit 0c67a9c30bb818811570c0c0db74dfafb9868fe1
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:18 2007 +0200

    bumped version to 2.0.1

commit fe62df2bfd8f063c80b9771555319ddbba184b58
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:15 2007 +0200

    updated documentation with new dns cache options

commit 42cb6d9b4c9c9e755e4ab4abeb68b38c2e888dab
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:12 2007 +0200

    NEWS preparations for syslog-ng 2.0.1

commit dc199ade8614bdf70d70cf8b11de128dc2064142
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:10 2007 +0200

    obsoleted remove_if_older option in favour of overwrite_if_older
    
    	* src/affile.{c,h}: renamed remove_if_older references to
    	overwrite_if_older
    
    	* src/cfg-lex.l, src/cfg-grammar.y: -"-
    
    	* doc/reference/syslog-ng.xml: added overwrite_if_older
    	documentation, added note about obsoleted remove_if_older()

commit 17c6cf3177faf8f25f4e8f811bc7ceace536e3ca
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:07 2007 +0200

    documentation updates on remove_if_older()

commit 651180d405df42084a96a762a238adec30a1f698
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:04 2007 +0200

    added include misc.h to afstreams.c
    
    	* src/afstreams.c: added #include "misc.h"

commit 168ce84fffabed5a5c5ae953565941a90747c39b
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:12:01 2007 +0200

    removed bogus timezone error message for correct timezone values
    
    	* src/cfg.c (cfg_timezone_value): readded erroneously removed retur
    	statement which caused an error message for all timezone values

commit c4d9b1d50d6d81bb32bb20d5c84ed397ed36a4ce
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:58 2007 +0200

    removed 12 hour limitation from timezone offsets
    
    	* src/cfg.c (cfg_timezone_value): removed 12 hours limitation as
    	offsets may well exceed that value (maximum is 24 hours)
    
    	* doc/reference/syslog-ng.xml: removed non-existing timezone()
    	optio

commit 269453d0168f833358acf862fbac207f7bf6d598
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:56 2007 +0200

    added minimum version checking for glib/eventlog, also fixed a portability problem with non-gcc compilers in configure

commit ae0b1a488e671d3beb10a420aa1dcc0cb9bb034f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:53 2007 +0200

    fixed a typo in the documentation, added sys/socket.h to dnscache.c

commit f0b3b522131453508feab4cc6a8caf44dc6e1bad
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:50 2007 +0200

    fixed the previously messed up commit

commit 75c5ec41f8404f8825f1e396cd79901f41420d4c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:47 2007 +0200

    fixed a compilation problem in logmsg.c
    
    	* src/logmsg.c (log_msg_parse): fixed a bad assignment

commit 4c6fc4e4f781e80cd02772d090f048d814d28d7a
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:44 2007 +0200

    timezone offset calculation fix
    
    	* src/logmsg.c (log_stamp_format): don't use the absolute value of
    	timezone offset,
    	(log_msg_parse): initialize tm.tm_gmtoff using a call to localtime()
    	instead of using memset(), fixed tv_sec calculation as it was not
    	really UTC which it should've been.
    
    	* tests/unit/test_msgparse.c: fixed time parsing testcases

commit 0b463b2bd1907ac8bf6df1a3afbcc4530d325dba
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:41 2007 +0200

    fixed GLib static link configure test to work with non-gcc compilers
    
    	* configure.in: fixed GLib static link configure test to work with
    	non-gcc compilers

commit 572da98f35f90dac2f5528e826f1a629e3c5409a
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:38 2007 +0200

    fixed up dnscache unit test program

commit 6a00cfd778a7880e0401cef2b8184fd6737babc5
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:11:28 2007 +0200

    implemented DNS cache and custom hosts file support
    
    	* src/cfg-grammar.y: added KW_PERSIST_ONLY, KW_DNS_CACHE_HOSTS keywords, dnsmode rule,
    	removed tripleoption and related options, added
    
    	* src/cfg-lex.l: added dnscache specific new keywords,
    
    	* src/cfg.c (cfg_init): added a call to dns_cache_set_params,
    	(cfg_free): free dns_cache_hosts,
    
    	* src/main.c (main): call dns_cache_init() and dns_cache_destroy()
    
    	* src/misc.c (resolve_hostname): added DNS cache and persistent-only
    	resolution support
    
    	* src/sgroup.c (log_source_group_init): save dns cache params,
    	(log_source_group_queue): pass use_dns_cache param to resolve_hostname
    
    	* src/dnscache.{c,h}: new files

commit 808ee443a08dd0e3243df79df92762aaedc7a73b
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:08:38 2007 +0200

    don't fail at startup if network connection is dow
    
    	* src/afsocket.c (afsocket_open_socket): added an error message if
    	socket creation failed,
    	(afsocket_dd_start_reconnect_timer): new function, deregisters and
    	starts a new reconnect timer,
    	(afsocket_dd_connected): use afsocket_dd_start_reconnect_timer,
    	(afsocket_dd_start_connect): renamed from afsocket_dd_reconnect,
    	removed explicit timer registration,
    	(afsocket_dd_reconnect): new function, calls _start_connect and
    	registers the reconnect timer if that fails,
    	(afsocket_dd_init): afsocket_dd_reconnect does not return a value now

commit da6693cef16b2c027d327e593aa185e987936a98
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:08:35 2007 +0200

    increased listener source priorities
    
    	* src/syslog-ng.h (LOG_PRIORITY_LISTEN): increased priority to match
    	LOG_PRIORITY_READER as otherwise a continous input flow can starve
    	accept()

commit b2bd3a54f50b36bcbf057b3c49c3f3384dd7eb81
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:08:32 2007 +0200

    set the pipe for program destinations to nonlbocking mode
    
    	* src/afprog.c (afprogram_dd_init): set the pipe fd to nonblocking
    	mode to avoid a possible hang

commit 042dbb5b89bc9404e3be3c66e0bf92af4870eae1
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:08:29 2007 +0200

    implemented the missing remove_if_older optio
    
    	* src/affile.c (affile_dw_init): check if the file exists and is
    	older than the value for remove_if_older, if it is unlink it,
    	(affile_dd_set_remove_if_older): new function to set remove_if_older
    	value,
    
    	* src/cfg-grammar.y (dest_affile_option): added KW_REMOVE_IF_OLDER rule
    
    	* src/cfg-lex.l: added keyword for KW_REMOVE_IF_OLDER

commit ca9515e44bf68a709a8e21ca789f061a1b0f2158
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:08:26 2007 +0200

    preparations for 2.0.0

commit 951be690d70c68364a6f25474e6fd657ba667468
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:08:23 2007 +0200

    fixed process restarting and some other minor fixes
    
    	* src/afprog.c (afprogram_dd_exit): check that the current pid is
    	equal to the process that was exited, as the EPIPE handling code
    	might have already done our job,
    	(afprogram_dd_init): don't leave the read side of the pipe twice
    	with the process, removed a call to g_fd_set_cloexec() as it's not
    	needed and was too late anyway, should've been before fork,
    
    	* src/gsockaddr.c (g_sockaddr_unix_format): the kernel sometimes
    	returns only an address family for unix socket names, and we printed
    	a lot of garbage instead of "anonymous" in this case
    
    	* src/logwriter.c (log_writer_broken): move log_pipe_deinit() before
    	log_pipe_notify(), this was changed in rc3 with a changelog that it
    	should not matter, however it does matter :P as it might have left
    	the writer in an unpolled state

commit a5ad384024fa24203713d0e78e09abd1e71df145
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:08:12 2007 +0200

    integrated solaris build scripts from dev-folti (fixes: #10358)
    
    Patches applied:
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--base-0
       tag of devel@balabit.hu--other-1/syslog-ng--mainline--2.0--patch-87
    
     * devel@balabit.hu--other-1/syslog-ng--dev-folti--2.0--patch-1
       Added support for solaris 8/9 and rhel 3/4 packaging. (fixes: #10358)

commit 9b68bc5cae141add7cf2b124f3d394cf5a9fa856
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:07:55 2007 +0200

    fixed some compilation warnings under gcc4
    
    	* src/affile.c (affile_dd_init): added some casts to suppress some
    	warnings
    
    	* src/gsockaddr.c (g_accept): use socklen_t instead of int as a
    	second argument to accept

commit 34ce56620d0afcba122370ea0465a7b3ce3f13dd
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:07:52 2007 +0200

    documentation updates merged from the tech-writer team
    
    Patches applied:
    
     * devel@balabit.hu--other-1/syslog-ng--documentation--2.0--patch-1
       Updated reference guide, still needs work, see FIXMEs
    
     * devel@balabit.hu--other-1/syslog-ng--documentation--2.0--patch-2
       Updates and fixes from Bazsi

commit 8209550d567870d243da92307528287958b7cffd
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:07:49 2007 +0200

    updated VERSION number

commit b65ab131fcfd720f2e4ce69c024166b8f960ff65
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:07:46 2007 +0200

    preparations for 2.0rc4

commit 54e9315754c452b30a0a574f928ad4c854e1d105
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:07:44 2007 +0200

    fixed possible NULL deref on destination connection broken, fixed EOF detectio
    
    2006-10-21  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logwriter.c (log_writer_fd_prepare): when EOF detection is
    	enabled specify G_IO_IN and G_IO_HUP in addition to normal flags,
    	(log_writer_fd_dispatch): input on the destination fd is taken as EOF,
    
    	(log_writer_broken): _deinit is moved after the call to notify,
    	should not matter at all however the reference counting depends o
    	the fact that log_pipe_notify() will not be called after _deinit
    	finishes, in this specific case it would not really matter,
    	(log_writer_deinit): remove unref of self->control,
    	(log_writer_new): self->control is a borrowed reference, don't
    	increase refcount

commit 009401cd1acb83c459c0e1893590250a30119b5c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:07:24 2007 +0200

    added syslog-multicast client to contrib

commit 29bcd9f22829e40a26f47610fe505a0ceffab2dd
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:07:03 2007 +0200

    preparations for 2.0rc3

commit 3c6e92274af21d8eb6621349b5eb7572de4e360d
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:59 2007 +0200

    fixed a possible SEGFAULT caused by one of the leak fixes, when output templates() are used
    
    2006-09-14  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logwriter.c (log_writer_options_init): save options->template
    	before calling log_writer_options_destroy and restore it afterwards
    	as that is never initialized based on the configuratio

commit eef2f144e47c25370c7c71770a57c6872a5263e7
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:55 2007 +0200

    NEWS update

commit a6eac5185e09cb1f763b3140f0fee6aa460559fe
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:52 2007 +0200

    preparations for 2.0rc2 release

commit b61e0d46672bf41407172f20e2d0aca77835aee3
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:48 2007 +0200

    fixed name resolution for unix domain socket peers
    
    2006-09-11  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/misc.c (resolve_hostname): for UNIX domain socket peers don't
    	try to resolve the sender address, fixes a possible abort,
    	introduced by patch-76

commit 4adcea2b0844ffe1e89936c8452448b4163b9882
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:45 2007 +0200

    added stats counter orphaning to fix "duplicate stats counter message" for program destinations
    
    2006-09-11  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logwriter.c (log_writer_deinit): call stats_orphan_counter,
    	(log_writer_free): removed stats_unregister_counter, fixed a memory
    	leak by freeing all elements in the logwriter queue,
    	(log_writer_options_init): fixed a possible memory leak by freeing
    	the option structure contents before overwriting it with new values,
    
    	* src/main.c (main_loop_run): added stats_cleanup_orphans() call
    
    	* src/stats.c (stats_counter_free): new function,
    	(stats_register_counter): added special case for orphaned counters,
    	save "shared" value in the StatsCounter structure,
    	(stats_orphan_counter): new function, orphanes a counter that ca
    	thus be reused by a new configuration upon the receiption of a HUP signal,
    	(stats_unregister_counter): use stats_counter_free instead of
    	open-coding it,
    	(stats_cleanup_orphans): free all orphaned counters, to be called
    	after a reload

commit f15b08d80fb331abab89d194e21dafb27a72fa8e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:41 2007 +0200

    fixed IPv6 name resolutio
    
    2006-09-11  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/misc.c (resolve_hostname): added IPv6 specific name resolutio

commit c395e96241fc5fdc2f059cefbb2f42db44931216
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:37 2007 +0200

    fixed NL handling in DGRAM transports
    
    2006-09-11  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logreader.c (log_reader_iterate_buf): flush input buffer
    	regardless of embedded NLs in the case of DGRAM transports

commit f1f8a76145faa54248392223d0cabb094c7e20c0
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:33 2007 +0200

    fixed another memory leak that might happen during exit
    
    	* src/messages.c (msg_send_internal_message): don't allocate a
    	LogMessage if internal_msg_queue is NULL as that can't be sent
    	anyway

commit cc9e3e642281681d1516a2e162b861aba8815d4d
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:29 2007 +0200

    various memory leak fixes
    
    	* src/affile.c (affile_dw_deinit): check if self->writer is NULL,
    	(affile_dd_free): call log_writer_options_destroy as
    	LogWriterOptions might contain dynamically allocated memory,
    
    	* src/afprog.c (afprogram_dd_exit): removed log_pipe_unref, it is
    	performed by the children handling framework,
    	(afprogram_dd_init): use the new GDestroyNotify argument of childre
    	manager,
    	(afprogram_dd_free): added log_writer_options_destroy call
    
    	* src/afsocket.c (afsocket_dd_free): added
    	log_writer_options_destroy call
    
    	* src/children.c (ChildEntry): added callback_data_destroy member,
    	(child_manager_child_entry_free): new function, frees a ChildEntry,
    	(child_manager_sigchild): removed g_free, it is done by the
    	GHashTable automatically,
    	(child_manager_init): use g_hash_table_new_full and specify destroy
    	notify callback for the data stored in the hashtable
    
    	* src/logreader.c (log_reader_iterate_buf): assume that saddr is a
    	borrowed reference and handle it as such,
    	(log_reader_fetch_log): iterate_buf borrows the reference so it is
    	our duty to free sockaddr, do so in all branches,
    
    	* src/logwriter.c (log_writer_deinit): drop reference to
    	self->control to break a circular reference,
    	(log_writer_free): removed log_pipe_unref self->control,
    
    	* src/messages.c (msg_send_internal_message): check if
    	internal_msg_queue is null,
    	(msg_deinit): free internal_msg_queue

commit 420db97e1db928229a690e9f808caf369fb12e8c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:25 2007 +0200

    Fixed possible DoS when a 0 sized packet is received via UDP
    
    	* src/logreader.c (log_reader_fetch_log): don't take 0 sized packets
    	as EOF for packet based transports like UDP
    
    	* src/afsocket.c (afsocket_sc_notify): don't close the input
    	connection on read errors for non-stream based transports

commit 7ac1fd1174671b83ff92e0c5ad7aa3818128d080
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:22 2007 +0200

    fixed facility filter evaluation problem on platforms with unsigned chars (powerpc)
    
    	* src/filter.c (filter_facility_eval): Fixed filter evaluation o
    	platforms which have unsigned character type by default (powerpc)

commit bccdfaf2e7ec0ec942a35813abb2c543c15bdbfa
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:18 2007 +0200

    added clarification of the output format of program()

commit 5d929e60b06c290000d399721f822e655c457721
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:15 2007 +0200

    NEWS update

commit a05a7cce17c70054c1a0d6f17f73fc1270b32f01
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:11 2007 +0200

    preparations for 2.0rc1 release

commit 944338ec57c607c9bc4bca42c190117b01d1ae3e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:08 2007 +0200

    fixed unix domain destination handling
    
    	* src/afunix.c (afunix_dd_new): initialize bind_addr as the afsocket
    	code assumes that it is not NULL, fixes a possible SIGSEGV

commit 927a27ed0fc114fe3e05f9dc4ce01c310c77eff9
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:05 2007 +0200

    fixed dir_group processing
    
    	* src/affile.c (affile_dd_new): dir_gid was not initialized because
    	of a typo, thus dir_group() did not take effect, fixed

commit 07e54e3f8e309e099a71c519f04c71ccb0f095b7
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:06:01 2007 +0200

    bumped version to 2.0rc1

commit 6f74563eeb36d3e98bf9b70aa84b6b38ad76e3e5
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:55 2007 +0200

    documentation updates, flush_timeout changed to use msecs
    
    	* doc/reference/syslog-ng.xml: documentation updates
    
    	* src/logwriter.c (log_writer_fd_prepare): assume that the
    	flush_timeout parameter is in msecs
    
    	* src/cfg.c (cfg_init): use 10000 as default for flush_timeout()

commit f54c0e1280af66cb691909d4448a27e8aa76cfc7
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:50 2007 +0200

    support optional() for file destinations, optional destinations are only reopened after time_reopen() time has elapsed
    
    	* src/affile.c (AFFileDestWriter): added time_reopen and
    	last_open_stamp members,
    	(affile_dw_init): store the time_reopen value from cfg, save the
    	current time in last_open_stamp, don't fail the initialization if
    	optional is enabled,
    	(affile_dw_queue): reopen the destination if time_reopen() time has
    	elapsed, drop the message if we are without a destination,
    
    	* src/cfg-grammar.y (dest_affile_options): added KW_OPTIONAL parsing

commit 7b3a9152772fd618d46950260f04ba4d6074db63
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:45 2007 +0200

    fixed evaluation of priority range filters
    
    	* src/syslog-names.c (syslog_name_find_name): new inline functio
    	used by various lookup functions,
    	(syslog_name_lookup_id_by_name): renamed from syslog_lookup_name,
    	(syslog_name_lookup_name_by_value): renamed from syslog_lookup_value,
    	(syslog_name_lookup_value_by_name): new function,
    	(syslog_make_range): renamed parameters to make the code more readable
    
    	* src/syslog-names.h (syslog_name_lookup_level_by_name): changed to
    	return the _VALUE_ for syslog message levels,
    	(syslog_name_lookup_facility_by_name): follow name changes
    
    	* src/cfg-grammar.y: use the new, more readable function names i
    	syslog-names.c
    
    	* src/filter.c (filter_level_eval): we store a bitmask of the value
    	of priorities instead of our internal ids, thus the function body
    	was simplified a lot (and it works now :)
    
    	* src/macros.c (log_macro_expand): follow function renames
    
    	* tests/unit/test_filters.c: added level range tests

commit 7adba5df5b209a642c8ea995107b99b241775d82
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:41 2007 +0200

    portability fixes
    
    	* configure.in: detect AIX and HP-UX using uname -s, instead of
    	trying to extract platform information from the linker's versio
    	number (proved not to be reliable on HP-UX)
    
    	* src/misc.c (getlonghostname, getshorthostname): use 256 characters
    	array to store hostnames
    
    	* src/sgroup.c (log_source_group_queue): -"-

commit 8e4b664578296f509e49e49ee7f387368ceca18c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:37 2007 +0200

    fixed pointer conversion macros on 64 bit platforms
    
    	* src/macros.c (log_macro_lookup): use GINT_TO_POINTER and
    	GPOINTER_TO_INT macros instead of casting values directly to avoid
    	warnings on 64 bit systems

commit 707f5e07ab94bffc9dd8c9b8c172058d62e0f1a2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:33 2007 +0200

    do not reconnect to target immediately but wait for time_reopen first
    
    	* src/afsocket.c (afsocket_dd_notify): instead of immediately
    	scheduling a reconnect, start the reconnect timer to avoid excessive
    	number of reconnection requests in case of a going up-and-dow
    	connectio

commit 0ab7910ad03bbf1b31d1670eb0b2fe07a697df60
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:29 2007 +0200

    fixed IPv6 portability problem
    
    	* src/afinet.c (afinet_setup_socket): use the "official"
    	IPV6_JOIN_GROUP name instead of IPV6_ADD_MEMBERSHIP as the latter is
    	not defined on all platforms

commit 46c46070f72a4a70ffac94209aa74895ebb0ccae
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:24 2007 +0200

    fixed HP-UX portability problem
    
    	* src/afinet.c (afinet_setup_socket): fixed IN6_IS_ADDR_MULTICAST
    	call as struct in6_addr definition differs on HP-UX (thanks go to
    	Albert Chin)

commit 52255cd7027c14270c6723f9e913d8052abd58c8
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:05:19 2007 +0200

    removed C99ism from stats.c
    
    	* src/stats.c (stats_generate_log): remove C99 initializers from the
    	initialization of tag_names to make syslog-ng compatible with vendor
    	compilers of various commercial UNIX platforms

commit 28292e7384897fb25a68390b25dfc4ffa44f5a27
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:59 2007 +0200

    compatibility fixes for Solaris/AIX
    
    2006-05-26  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afinet.c: define SOL_IP and SOL_IPV6 on platforms which use
    	IPPROTO_* for this purpose, added the inclusion of <string.h> for
    	the definition of memset()

commit 997c8bea79a48094d118c0f541b99c3e82e84bae
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:54 2007 +0200

    added LEVEL_NUM and FACILITY_NUM macros to follow 1.6.x changes
    
    	* src/macros.c (log_macro_expand): added code for LEVEL_NUM and
    	FACILITY_NUM macros
    
    	* tests/test_template.c: added testcase for LEVEL_NUM and
    	FACILITY_NUM macros

commit b2b2cf848972839507e6bbcab34a49b9c73af719
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:50 2007 +0200

    guard LOG_CRON with ifdef as it might not exist on some platforms
    
    	* src/syslog-names.c (sl_facilities): some platforms do not define
    	LOG_CRON

commit 0d55d7ea44e090d87bac7823bc3a63fa406b7dbe
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:41 2007 +0200

    preparations for 1.9.11

commit 7fc980fe4e861fa257513de5f08e11b8033a2097
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:37 2007 +0200

    fixed dropping input/output/error fds when going to background
    
    2006-05-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/main.c (setup_std_fds): fix inverted check for errors after
    	opening /dev/null, also close stderr when log_to_stderr is not
    	specified
    
    	* src/afprog.c (afprogram_dd_init): removed setsid call

commit b24f6be0a3c4d170648c388faf365f3f0c71bafc
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:33 2007 +0200

    add program exit status information to 'child program exited' log message
    
    2006-05-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afprog.c (afprogram_dd_exit): added program exit status
    	information to 'child program exited' log message

commit 24578ac50f32e0faaf96ac2ed0d282a6cca97680
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:29 2007 +0200

    added direction to socket setup code, fixed multicast setup
    
    2006-05-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.h (AFSocketDirection): new type, specifies the future
    	communication direction on a socket, used to determine which socket
    	options to set on a socket,
    
    	* src/afsocket.c (afsocket_setup_socket): added direction parameter,
    	(afsocket_sd_setup_socket, afsocket_dd_setup_socket): pass value for
    	'direction' parameter
    
    	* src/afinet.c (afinet_setup_socket): added direction parameter,
    	fixed multicast check for IPv4 addresses

commit 40f7c6a247862166c6b9421d958ca32b4b8e7e3c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:25 2007 +0200

    check that the value for time_sleep is less than 500msec
    
    2006-05-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-grammar.y (options_item, KW_TIME_SLEEP): check if the
    	value is more than 500, and maximize its value in this case
    
    	* src/main.c (main_loop_run): calculate timespec properly if
    	time_sleep is more than 1 sec

commit 48acaa5b7b6368657e74778d1b28676831b38ee9
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:20 2007 +0200

    added options to control various socket parameters and added multicast support
    
    	* src/gsockaddr.h (g_sockaddr_inet6_get_address,
    	g_sockaddr_inet6_set_address): use pointers to struct in6_addr
    	instead of passing the structure by value
    
    	* src/afsocket.c (afsocket_setup_socket): new function, set generic
    	socket options,
    	(afsocket_sd_accept): call setup_socket for new fds,
    	(afsocket_sd_init): -"-,
    	(afsocket_dd_reconnect): -"-,
    	(afsocket_sd_setup_socket): new function, default setup_socket callback,
    	(afsocket_sd_init_instance): added sock_options argument, set
    	default setup_socket callback,
    	(afsocket_dd_init_instance): added sock_options argument, set
    	default setup_socket callback,
    
    	* src/afsocket.h (AFSocketSourceDriver): added setup_socket callback,
    	(AFSocketDestDriver): added setup_socket callback,
    
    	* src/afinet.c (afinet_resolve_name): follow g_sockaddr_inet6_set_address change,
    	(afinet_setup_socket): new function to set AF_INET & AF_INET6
    	specific socket options,
    	(afinet_sd_setup_socket): new function, used as the setup_socket callback,
    	(afinet_dd_setup_socket): new function, used as the setup_socket callback,
    
    	* src/afunix.c (afunix_sd_new, afunix_dd_new): adapted to afsocket changes,
    
    	* src/cfg-grammar.y (socket_option, inet_socket_option): added
    	socket option parsing
    
    	* src/cfg-lex.l: added new keywords for socket options

commit 19e92a0d2991851594ec363fbde0c43581c4bbfc
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:15 2007 +0200

    fixed Solaris portability problems, avoid multiread on STREAMS sources
    
    	* configure.in: check for -lrt for nanosleep
    
    	* src/afstreams.c (afstreams_sd_init): pass LR_NOMREAD flag to
    	log_reader_new()

commit e3468c38c309e2bd19710c07d0a95a307b780823
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:09 2007 +0200

    fixed fetching kernel messages which was broken by the multi-read patches
    
    	* src/logreader.h (LR_NOMREAD): new flag, indicates that the log
    	reader should not use multiple read() calls in a single poll loop
    
    	* src/logreader.c (log_reader_fetch_log): break out of the loop if
    	LR_NOMREAD is specified
    
    	* src/affile.c (affile_sd_init): specify LR_NOMREAD

commit 4cebafe98afba7e1e8882004c048f11f87aba744
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:05 2007 +0200

    fixed endless-loop and CPU spinning if a non-existing filter is referenced in the internal() path
    
    	* src/filter.c (filter_call_eval): only log the "not-found filter"
    	error message once

commit 50be8c899953366c9024effb4b4ef06562e1536d
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:04:01 2007 +0200

    fixed possible memory leak
    
    	* src/logreader.c (log_reader_iterate_buf): drop self->prev_addr
    	reference if it exists, previously it might have been overwritte
    	with a new reference without dropping the old, fixes a potential
    	GSockAddr reference leak

commit 1f503817bc734221663f7cc3bcf29a3695bb7469
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:55 2007 +0200

    added IPv6 support
    
    	* configure.in: added --enable-ipv6 option, defaults to "yes",
    	added checks for getaddrinfo()
    
    	* src/afinet.c (afinet_set_port): added ipv6 support,
    	(afinet_resolve_name): renamed from afinet_set_ip, use getaddrinfo()
    	to resolve names where available,
    	(afinet_sd_new): added af argument, use afinet_resolve_name instead
    	of the removed g_sockaddr_inet_new_resolve() function, use a default
    	"bind address" value if the host argument is NULL,
    	(afinet_dd_new): added af argument, use afinet_resolve_name instead
    	of the removed g_sockaddr_inet_new_resolve() functio
    
    	* src/cfg-grammar.y: added KW_UDP6 and KW_TCP6 keywords,
    	(source_afsocket, dest_afsocket): added rules for KW_UDP6 & KW_TCP6,
    	(dest_afinet_udp_params, dest_afinet_tcp_params): added ipv6
    	support, adapted to the latest changes in afinet
    	(source_afinet_udp_params, source_afinet_tcp_params): -"-
    
    	* src/cfg-lex.l: added "udp6" and "tcp6" keywords
    
    	* src/gsockaddr.c (g_sockaddr_inet_new_resolve): removed this
    	function as it is an address family independent operation now
    	implemented in afinet.c,
    	(g_sockaddr_inet6_check): new function to check whether a GSockAddr
    	contains an ipv6 socket name,
    
    	* src/gsockaddr.h (g_sockaddr_get_sa, g_sockaddr_inet_get_sa,
    	g_sockaddr_inet_get_address, g_sockaddr_inet_set_address,
    	g_sockaddr_inet_get_port, g_sockaddr_inet_set_port): new inline
    	functions, ported from the Zorp sockaddr code,
    	(g_sockaddr_inet6_get_sa, g_sockaddr_inet6_get_address,
    	g_sockaddr_inet6_set_address, g_sockaddr_inet6_get_port,
    	g_sockaddr_inet6_set_port): new functions, similar to IPv6 counterparts

commit 8e0f3901d1218c8cd06aadd434f27fb26794ed58
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:49 2007 +0200

    fixed off-by-one in flush_lines() calculatio
    
    	* src/logwriter.c (log_writer_fd_prepare): flush_lines(1) required
    	two lines to be flushed, modified the condition so that:
    	flush_lines(0) that output buffering is off, flush_lines(1) is
    	basically equivalent, every single individual line is flushed,
    	flush_lines(2) flushes the output buffer if two lines are already
    	available

commit aa1fc46f9ac36fbae11e0cd331470a6509b48d4e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:44 2007 +0200

    added close-on-exec flag to all opened fds to avoid their inheritance to child processes
    
    	* src/af*.c: call g_fd_set_cloexec for all new fds
    
    	* src/misc.c (g_fd_set_cloexec): new function, sets FD_CLOEXEC flag
    	for an fd

commit 3b71308093695dd11a4a22b997a7d0dc3390d30e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:40 2007 +0200

    change file owner/group independently
    
    	* src/affile.c (affile_open_file): change owner/group independently

commit bfa8c13915450fe52161632e0194109c8f965fd2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:34 2007 +0200

    don't try to chmod/chown files that do not exist
    
    	* src/affile.c (affile_open_file): don't call chmod/chown whe
    	opening the file failed

commit 2b1848c738098752e4be1c46301da728fa6eb252
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:22 2007 +0200

    fixed a compilation warning

commit 37f1f01db9bb9a623d3925235a7cce2c7055dae4
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:17 2007 +0200

    preparations for 1.9.10, this time for real

commit bde8466597bf8a32ed25f1bb206b0a9c0ad3df1f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:12 2007 +0200

    display an error message instead of a failed assertion when the user specifies conflicting sources
    
    	* src/cfg.c (persist_config_add): don't store the value if it is
    	NULL, display an error message instead of a failed assertion if
    	the persistent name conflicts

commit eb412d509b2666af960d5d4625ca66bfd36f9a1e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:05 2007 +0200

    don't treat parse flags as keywords
    
    	* src/cfg-grammar.y: removed KW_NO_PARSE and KW_KERNEL tokens,
    	(source_reader_option_flags): use IDENTIFIER instead of using
    	separate keywords and call lookup_parse_flag to convert the textual
    	representation of parse flags to flag values,
    
    	* src/cfg-lex.l (keywords): removed no_parse and kernel keywords,
    	(lookup_parse_flag): new function, returns the flag value associated
    	with the text representatio
    
    	* src/cfg.c (cfg_init): fixed possible segfault when bad_hostname
    	regexp was not specified

commit d7acc4b6a4f1bf46c24422f2b97fab36a9465824
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:03:00 2007 +0200

    implemented bad_hostname and check_hostname options
    
    	* src/cfg-grammar.y: added KW_BAD_HOSTNAME and KW_CHECK_HOSTNAME tokens
    
    	* src/cfg-lex.l: added keywords for KW_BAD_HOSTNAME and KW_CHECK_HOSTNAME
    
    	* src/cfg.c (cfg_bad_hostname_set): new function, set global bad_hostname regexp,
    	(cfg_init): compile bad_hostname_re
    
    	* src/log.c (log_msg_parse): added bad_hostname regexp param, and a
    	implementation of check_hostname() and bad_hostname(),
    	(log_msg_init): avoid a time(NULL) call,
    	(log_msg_new): added bad_hostname parameter,
    	(log_reader_options_init): set options->options and
    	options->bad_hostname based on the values stored in GlobalConfig
    
    	* tests/unit/test_msgparse.c: added testcases for check_hostname()
    	and bad_hostname()
    
    	* src/*.c, src/*.h: followed changes

commit 518869d0ed238825f1b6e42d29636183f141595b
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:55 2007 +0200

    fixed timestamp calculation on timezone barriers
    
    	* src/logmsg.c (log_msg_parse): fixed timestamp calculation where a
    	timezone information was specified, see the comment for details,
    
    	* tests/unit/test_msgparse.c: added some more testcases with
    	timestamps around the DST switch
    
    	* tests/unit/test_template.c: fixed the timezone offset of the
    	arbitrary timestamp chosen in the testcases

commit 104862e44681b5ef7b07e679516ce35cc7452bda
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:51 2007 +0200

    accept negative numbers as NUMBER in the lexer
    
    2006-04-07  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-lex.l: accept negative numbers in the lexer

commit 0f4fd473efe4ef362a97f98e3923f7d50074d12f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:46 2007 +0200

    added a paragraph to the documentation clarifying pipe and /proc/kmsg

commit 8b294168d77d0eb3e18b4ee8144dcee1a148bb61
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:42 2007 +0200

    updated NEWS file, preparations for 1.9.10
    
    	* VERSION: bumped version to 1.9.10

commit 0b7b24c1485545a446951443e1b10dfe8c32c05e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:38 2007 +0200

    fixed large file support
    
    	* configure.in: check for O_LARGEFILE
    
    	* src/affile.c: use O_LARGEFILE when available

commit d4374c762d7ee08d67581cb4faa322c990baacf6
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:33 2007 +0200

    fixed priority level filtering
    
    	* src/cfg-grammar.y (filter_level): fixed priority level based
    	filtering, spotted and reported by Jakub Bogusz

commit 17b92119512444ae06b21b3d50020ecd4b2402e3
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:29 2007 +0200

    fixed a possible segmentation fault on write errors
    
    	* src/logwriter.c (log_writer_flush_log): return from the functio
    	on error instead of looping with line == NULL, this fixes a possible
    	SIGSEGV, when some messages sit in the queue while the destinatio
    	goes away

commit b44a6df851a100efcfc567dbfb235acaac8f5068
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:24 2007 +0200

    reimplemented netmask() filter which was missing from 1.9.9
    
    	* src/cfg-grammar.y, src/cfg-lex.l: added KW_NETMASK
    
    	* src/filter.c (filter_netmask_new): new function to construct a
    	netmask filter, cidr "address/prefix" and "address/address" formats
    	are accepted
    
    	* src/logmsg.h: fixed a warning by declaring log_msg_clear_matches functio
    
    	* doc/reference/syslog-ng.xml: added a notice on redefining
    	template() for network destinations
    
    	* tests/unit/test_filter.c: added unit tests for netmask filter

commit 0dea1df22244995edf4ceac6036dea4097b1f0fe
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:19 2007 +0200

    fixed regexp match space macro expansion
    
    	* src/filter.c (filter_re_eval): added msg parameter, instead of
    	using the re_matches array, use a per-message store
    
    	* src/logmsg.h (LogMessage): added re_matches
    
    	* src/macros.c (log_macro_expand): use per-message re_matches array

commit e80452ad2a450d1f78b735dffb9c537903ee541a
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:04 2007 +0200

    fail the testprogram if the pidfile could not be found

commit 482528c2c1c540266db7d069fd46dcaaf36e55dd
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:02:00 2007 +0200

    stats_freq is only taken into account if the value is larger than 0
    
    	* src/main.c (main_loop_run): take changed stats_freq into account
    	after a SIGHUP, stats_freq == 0 means to disable stats messages
    	altogether

commit a4d63bf4913b1ef4d8bef39e0f72dd18546a0027
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:01:54 2007 +0200

    added %option noyywrap to cfg-lex.l
    
    	* src/cfg-lex.l: added %option noyywrap to cfg-lex.l

commit d11e78759cd19d04469e09b8bf81ea397a50d995
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:01:50 2007 +0200

    fixed possible abort in program destination
    
    	* src/afprog.c (afprogram_dd_deinit): don't drop the reference to
    	self->writer, only deinit it,
    	(afprogram_dd_free): drop the reference to self->writer,
    
    	* src/main.c (main_loop_run): change the loop so that it actually
    	processes exited childre

commit 8e68dc99c809cc6894a3100878232252babecc7b
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:01:40 2007 +0200

    really release 1.9.9

commit 7fb9843b6d6ac2151fa14ad554c1cbfc0736894e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:01:34 2007 +0200

    fixed a possible heap overflow introduced by the patches from 2006-02-24
    
    	* src/logreader.c (log_reader_fetch_log): recalculate the available
    	buffer size before calling read() again, this is a possible heap
    	overflow which was introduced by
    	devel@balabit.hu--other-1/syslog-ng--mainline--2.0--patch-14
    	ChangeLog is in patch-15, this was never released however

commit 00ed97e645a52de05c2eb11f4c0e818332792347
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:01:26 2007 +0200

    preparations for an 1.9.9 release

commit 4ce788c5b6a5342a90d6905d7819be9cc7f2e036
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:01:21 2007 +0200

    added time_sleep() option to add a fixed latency to the poll loop
    
    	* src/cfg-grammar.y: added KW_TIME_SLEEP processing
    
    	* src/cfg-lex.l: added keyword for KW_TIME_SLEEP
    
    	* src/main.c: wait using nanosleep if time_sleep() is set
    
    	* doc/reference/syslog-ng.xml: added documentation on time_sleep and
    	a section in the tuning part to explain it a little further

commit 57ce551cbe48be50575a75f6933696ea25b5907a
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:01:16 2007 +0200

    added missing ChangeLog from previous patchset
    
    	* src/fdread.c (fd_do_read): added retrying on EINTR
    
    	* src/logreader.c (log_reader_iterate_buf): added msg_count argument
    	instead of the local variable as log_reader_iterate_buf might be
    	called multiple times and we do not want to fetch more tha
    	fetch_limit() messages in total,
    	(log_reader_fetch_log): added loop to iterate over up to fetch_limit
    	messages without going back to the mainloop

commit b59f3a22b290abb92048ab882716157dee06c341
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:00:43 2007 +0200

    added reference/syslog-ng.txt to EXTRA_DIST

commit 635ba5f99bfe95d3a3f5f42d9817ed567dfec5f7
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:00:32 2007 +0200

    added syslog-ng.txt generation to Makefile

commit e7e072950ef817b707c093b4f30233850790f171
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:00:19 2007 +0200

    fixed second fraction processing so that it actually shows up in output
    
    	* src/afsocket.h: removed AFSOCKET_PROTO_RFC3164, it might be
    	readded later when multiple protocols will be added, but for now it
    	only clutters the code
    
    	* src/cfg-grammar.y (KW_TIMESTAMP): moved keep_timestamp processing
    	to the readers, logwriters always reformat the timestamp based o
    	the parsed value, keep_timestamp(no) overwrites the timestamp in the
    	message with the received time,
    	(KW_FRAC_DIGITS): added a way to specify second fraction precision,
    	it now defaults to zero, e.g. no fraction information is added,
    
    	* src/logmsg.c (log_stamp_format): added support for unix and full
    	timestamps, added frac_digits argument
    	(LogStamp): removed frac_present member, if the user requests second
    	fragments one is always generated, if this information is not
    	available 0 is assumed
    
    	* src/cfg.c (cfg_ts_format_value): added support for unix and full
    	timestamps,
    	(cfg_new): frac_digits is initialized to 0, keep_timestamp to TRUE
    
    	* src/logreader.c (log_reader_handle_line): overwrite the message
    	timestamp if keep_timestamp if FALSE,
    	(log_reader_options_init): use the global keep_timestamp setting is
    	one is not specified
    
    	* src/logwriter.c (log_writer_format_log): always regenerate the
    	timestamp if no template was specified, as there's no point in using
    	the original date in the message as it clutters logs and might
    	confuse receivers,
    	(LWOF_FIXED_STAMP): removed, this is the default behaviour which ca
    	be overridden by using templates
    
    	* src/macros.c (log_macro_expand): use log_stamp_format for all
    	date/time formatting instead of open-coding them,
    	DATE uses the BSD timestamp, regardless of the value of ts_format
    
    	* src/test_template.c: fixed testprogram

commit cdd0a197bb625e52f3b90e42b3f234c13d1bd916
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:00:06 2007 +0200

    readded HOST_FROM, FULLHOST_FROM, SOURCEIP macros, extended unit test program
    
    	* src/gsockaddr.c (g_sockaddr_inet_check): new function, returns
    	TRUE if the specified address is GSockAddrInet
    
    	* src/logmsg.c (log_msg_parse): fixed timezone parsing in ISODATE
    	timestamps,
    	(log_msg_init): added host_from member,
    	(log_msg_free): free host_from
    
    	* src/macros.c (log_macro_expand): added FULLHOST_FROM, HOST_FROM,
    	SOURCEIP implementation, fixed DATE macros
    
    	* src/misc.c (resolve_hostname): instead of returning a newly
    	allocated GString, store the result in the one passed as parameter
    
    	* src/sgroup.c (log_source_group_queue): set host_from member in log message
    
    	* tests/unit/test_msgparse.c: fixed offset/timestamp value
    
    	* tests/unit/test_template.c: greatly extended to cover all possible
    	macros, resulting fixes are above :)

commit 38a3489816cdbb85602591284694452d6decd0e9
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 02:00:00 2007 +0200

    fixed possible segmentation fault on SIGHUP
    
    	* src/afsocket.c (afsocket_sc_set_owner): new function, changes all
    	references to a new AFSocketSourceDriver (this happens accross
    	SIGHUPs),
    	(afsocket_sd_set_listener_keep_alive): removed, there's no separate
    	LISTENER_KEEP_ALIVE setting,
    	(afsocket_sd_init): instead of simply changing the next-hop log-pipe
    	of connections call afsocket_sc_set_owner which changes less
    	explicit references
    
    	* src/cfg-grammar.y (yyparser_reset): new function, resets all
            'last_' variables as they are not referenced and might contai
            pointers to stale data
    
    	* src/logpipe.c (log_pipe_free_instance): function body moved to
    	log_pipe_unref to clear some clutter in backtraces and both
    	functions are only a couple of lines anyway
    
    	* src/logreader.c (log_reader_set_options): new function, allows the
    	caller to change the pointer to the options structure

commit 6fa49888a50c3db9085a9cf26a66a19595e3f577
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:53 2007 +0200

    memtrace improvements
    
    	* src/memtrace.c: added backtrace to add/delblock messages

commit cb4cdb2a7d893ba99016401d73b14bb8e1d64853
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:49 2007 +0200

    added some more unit testcases for filter testing

commit d0d13232912df37a2e20fdc4724b1b4d57913bde
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:44 2007 +0200

    added "kernel" flag to log reader flags
    
    2006-02-11  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-lex.l, src/cfg-grammar.y: added "kernel" keyword
    
    	* src/logmsg.c (log_msg_parse): default to kern.crit for kernel
    	messages
    
    	* src/macros.c: fixed PRI macro as it included the hostname as well

commit d71d9a2df3b7cfd25bb63cdf963096f2510662f2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:39 2007 +0200

    added PID macro and its documentation
    
    	* src/macros.c (log_expand_macro): added support for PID

commit 174f9e3c7429ab310d6fbbc8370ae37ae68c7665
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:33 2007 +0200

    added normalize_hostnames() option (fixes: #6294)
    
    2006-02-11  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-lex.l, src/cfg-grammar.y: added normalize_hostnames
    	optio
    
    	* src/sgroup.c: implement normalize_hostnames
    
    	* src/logmsg.c (log_msg_parse): removed STRICT check from RFC3339
    	timestamp parsing
    
    	* doc/reference/syslog-ng.xml: updated

commit 86a898f0049a8209a58e5092bb826a73eed37cf4
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:28 2007 +0200

    Added processed counters for source/destination groups and the log center (fixes: #5368)
    
    	* src/affile.c (affile_dd_format_stats_name): readded this functio
    	to generate a unique stats ID for the specific destination driver
    	instance,
    	(affile_dd_init): use NO_STATS for files only,
    
    	* src/center.c (log_center_init): added received/queued counters,
    	(log_center_queue): increment counters
    
    	* src/sgroup.c, src/dgroup.c: added processed counters
    
    	* src/stats.c, src/stats.h: added SC_TYPE_PROCESSED, make sure that
    	counters are interpreted in their proper namespace,
    	(stats_unregister_counter): added missing "type" argument

commit 14518063ff65e4885e34d9bf5e3de76536f9f7db
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:22 2007 +0200

    added optional() parameter to pipe/unix drivers (fixes: #4999)
    
    	* src/driver.h: added optional member (fixes: #4999)
    
    	* src/cfg-lex.l: added optional keyword (fixes: #4999)
    
    	* src/cfg-grammar.y: added optional keyword to pipe and unix domai
    	socket based source drivers (fixes: #4999)
    
    	* src/afsocket.c (afsocket_sd_init): do not fail if binding failed
    	and optional is TRUE (fixes: #4999)
    
    	* src/affile.c (affile_sd_init): do not fail if opening failed and
    	optional is TRUE (fixes: #4999)

commit b2525610aae7c7c2159cab694d17868bae1c77ef
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:15 2007 +0200

    implemented filter debugging (fixes: #3988)
    
    	* src/filter.c (log_filter_rule_eval): new function, previously
    	rule->root was manipulated directly which was not nice, filter rule
    	debugging messages are put here (fixes: #3988),
    	(filter_expr_eval): uninlined, added debugging messages (fixes: #3988),
    	(filter_expr_free): uninlined
    	(*_new): set self->type to be used in log messages properly (fixes: #3988)

commit c27315c9b0025c9c4697d5fcb9e14c988d1b50b9
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:59:05 2007 +0200

    started new ChangeLog
    
    	* tla archives were switched, syslog-ng now uses
    	devel@balabit.hu--other-1, the old ChangeLog file was archived as
    	ChangeLog.1

commit 4b674196545511a0f3132e2829ba622a48e13a4c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:49:36 2007 +0200

    fixed possible 64 bit compatibility problem
    
    	* src/logwriter.c (log_writer_queue, log_writer_flush_log): use
    	GPOINTER_TO_UINT/GUINT_TO_POINTER macros instead of casting the
    	values by hand

commit cfd2edcc203186ba4461b521ff654059ff0a3b3c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:49:32 2007 +0200

    added support for hostname resolution (fixes: #8036)
    
    2006-01-25  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afinet.c: support an optional self->dest_addr
    
    	* src/afsocket.c (afsocket_dd_init): fail if self->dest_addr is NULL,
    	(afsocket_sd_init): fail if self->bind_addr is NULL
    
    	* src/gsockaddr.c (g_sockaddr_inet_new_resolve): new function,
    	resolves a hostname and stores the result in a GSockAddr,

commit 48ac2629a7cdfda4dd89902b54b5438e6ee2f9d7
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:49:06 2007 +0200

    added stats counter sharing and a way to disable stats counter
    
    2006-01-20  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/stats.c (stats_register_counter): added shared parameter to
    	specify that the given counter can be shared
    
    	* src/logwriter.h (LogWriterOptions): added flags member and two
    	flags LWOF_NO_STATS, LWOF_SHARED_STATS
    
    	* src/logwriter.c (log_writer_options_init): converted fixed_stamp
    	parameter to a flag word, the actual value is LWOF_FIXED_STAMP,
    	(log_writer_init): don't register a stats counter if LWOF_NO_STAMP
    	is specified
    
    	* src/af*.c: changed the call of log_writer_options_init()

commit 0d7fb70db247f154c3436d39050591ed234369e4
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:49:04 2007 +0200

    added compatibility option for stats
    
    2006-01-13  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-lex.l: added a "stats" keyword to be compatible with 1.6.x

commit 24bb793cfb275df0bf3c17832a4a1a60c5245340
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:59 2007 +0200

    fixed EOF detected messages for UDP destinations where the target is unreachable
    
    2005-12-31  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_dd_init): don't set LW_DETECT_EOF for UDP
    	destinations
    
    	* src/logwriter.c (log_writer_fd_dispatch): EOF is detected only if
    	G_IO_IN is detected and not for G_IO_ERR as it might be set for UDP
    	destinations when they are unreachable

commit 3cab185e40fa492a013273cd094ec5d4df0ed5b5
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:55 2007 +0200

    perparations for an 1.9.8 release

commit 18940fed98275f63606a851226ffb1a4a323d048
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:54 2007 +0200

    fixed UDP destination driver initialization
    
    2005-12-20  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_dd_connected): only check socket error
    	state for stream sockets as UDP connections succeed immediately,
    	(afsocket_dd_reconnect): if g_connect returns immediate success (UDP
    	connections) set self->fd to sock

commit 5028bb3b12036eaa401e68d63f53798da8867d38
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:45 2007 +0200

    fix time conversion to the specified timezone
    
    2005-12-05  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logmsg.c (log_stamp_format): instead of substracting the
    	timezone offset substract it (credit for reporting goes to Andy),
    
    	* src/macros.c (log_macro_expand): -"-
    
    	* src/logmsg.c (log_msg_parse): time zone specifies can be more tha
    	12 hours, fixed.

commit ad8c87d448ff17ccf986276d77480f2b0a1a948d
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:43 2007 +0200

    include VERSION in the dist

commit 8146b3a80cbf3cf344ede024a5017327933b58d0
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:42 2007 +0200

    fixed MARK support
    
    2005-12-03  Balazs Scheidler <bazsi@balabit.hu>
    
    	* doc/reference/syslog-ng.xml: added some more words on mark_freq()
    	and stats_freq(), actually fixed the documentation as these options
    	were renamed for consistency
    
    	* src/afinter.c: move MARK implementation to here instead of
    	logreader, there's no point in creating MARK messages in the name of
    	all of our sources, we need to generate a single MARK message in our
    	name if there's no traffic
    
    	* src/main.c: removed the use of obsolete GLib functions

commit 297911fb6be3c4e510331c432cc8b8f5d4ef5bf2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:37 2007 +0200

    minor documentation updates, updated NEWS, bumped VERSION to 1.9.7

commit 3987ab6c3bb1c383291d7a99dcdba4147f874451
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:30 2007 +0200

    fixed a possible segmentation fault during HUPs
    
    2005-12-03  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_sc_init): fixed DGRAM socket
    	initialization to actually process incoming data in packets (the
    	LR_PKTTERM flag was missed),
    	(afsocket_sd_deinit): don't free the connection list items whe
    	iterating the list as connections are removed from the list whe
    	they are freed, the loop there only needs to break the circular
    	references

commit a3d374bb67d9be033315ea9345e0a29bdf49524f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:48:21 2007 +0200

    added VERSION file

commit b7287fa66ef424f454370ee9f15d2b3612f1699f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:47:59 2007 +0200

    added debianization files, misc build fixes
    
    2005-12-03  Balazs Scheidler <bazsi@balabit.hu>
    
    	* debian/*: added debianization files
    
    	* configure.in: added VERSION file instead of having the actual
    	VERSION inline, added CURRDATE to make it possible to generate
    	debian/changelog automatically

commit 89646a5f11db10ad1c921cdeba89d5cf3de77559
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:47:30 2007 +0200

    fixed Solaris STREAMS based log device support
    
    2005-11-25  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_dd_format_stats_name): fix compiler
    	warning about uninitialized driver_name, the switch statement
    	covers every possible case
    
    	* src/afstreams.c: fix compilation issues, it now actually compiles
    	and works on Solaris (tested on Solaris 9)

commit a716542cec00fcba9dca34f07551da97751a6f4c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:47:28 2007 +0200

    fixed timezone calculation
    
    2005-11-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/misc (get_local_timezone_ofs): fixed timezone calculation again,
    
    	* tests/unit/test_zone.c: added some missing testcases for timezones
    	over 12 hours (New Zealand)
    
    	* tests/unit/test_filters.c: fixed facility testing as the code was changed

commit 4beacc3fac3060875162c9888c3d8e0d1050b846
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:47:21 2007 +0200

    fixed the detetion of Solaris STREAMS support, fixed segfault when it was not compiled in

commit 8fbd6728c985a56f3324c4f179852e606a393da6
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:47:16 2007 +0200

    fixed log message concatenation in certain cases
    
    2005-11-03  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/templates.c (log_template_format): truncate the string before
    	formatting a log message

commit 6228449912dd42fff81b810e96f5a44463e6e640
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:47:12 2007 +0200

    readded syslog-ng.h as it was missed from the distribution

commit 1533fef767070d25a8a1ec023bb952a908e5a534
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:46:41 2007 +0200

    stats.c & stats.h were not commited in the previous patch

commit 7fe8a755dec2f67723e9d049ec9344ceb6214224
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:46:23 2007 +0200

    added per-destination dropped counters and some bugfixes
    
    2005-10-22  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/stats.{c,h}: new files, a simple framework for named
    	statistical counters, currently only used for per-destinatio
    	dropped counters
    
    	* src/message.c, src/messages.h (msg_event): the function was split
    	to msg_event_create and msg_event_send functions and macros were
    	changed accordingly, the reason is that the STATS message uses
    	dynamic message tags
    
    	* src/main.c (stats_timer): new function to issue statistics message
    	using the stats framework
    
    	* src/logwriter.h (LogWriterOptions): added stats_name member
    	which is used when registering the dropped counters,
    	(LogWriter): added dropped_messages member to point to our private
    	dropped counter
    
    	* src/logwriter.c (log_writer_init): register dropped counter,
    	(log_writer_free): deregister dropped counter,
    	(log_writer_options_init): store the name of the dropped counter,
    	added a warning message for the flush_lines > fifo_size case as this
    	will not work,
    	(log_writer_flush_log): call log_writer_broken when an error occurs,
    	(log_writer_broken): changed argument list to be usable from
    	log_writer_flush_log, log message moved out of the function as it
    	might be called from different places,
    	(log_writer_queue): increment dropped counter,
    	(log_writer_fd_prepare, log_writer_fd_check): fixed flush_timeout
    	handling
    
    	* src/Makefile.am: moved headers to SOURCES from EXTRA_DIST
    	(I like it better this way (tm))
    
    	* src/logpipe.h, src/logmsg.h: don't include glib.h directly, use
    	syslog-ng.h instead
    
    	* src/misc.c (format_zone_info): readded ':' to zone offset
    	formatting, which was missed in the previous patch, fixed the sig
    	for zone offsets
    
    	* src/logmsg.c (log_stamp_format): the buffer for the zone offset
    	was not large enough to hold the readded ':'
    
    	* src/cfg-grammar.y, src/cfg-lex.l: added global stats_freq optio
    
    	* src/afprog.c, src/affile.c, src/afprog.c: added
    	dropped stats support
    
    	* src/afsocket.c: added dropped stats support,
    	(afsocket_dd_connected): do not reinit the writer,
    	(afsocket_dd_init): do not create a new LogWriter instance every
    	time, but reuse the previous one instead,
    	(afsocket_dd_free): fix memory leak by freeing self->writer

commit 291f17aff0a460ba9bf2193c813c34780a1f1b62
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:46:14 2007 +0200

    do not use the LOG_FAC macro as it is not portable
    
    2005-10-22  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/filter.c: do not use the LOG_FAC macro, it is not available o
    	Solaris
    
    	* doc/reference/syslog-ng.xml: added documentation on the alternate
    	syntax of the facility() filter

commit 40fd68fc9016814bba5fe299a725c84d09edf8d3
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:45:56 2007 +0200

    test commit for syslog-ng-commit message

commit 9a798b46deba1c68ece9a936121143d6ac5c944b
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:45:43 2007 +0200

    added a note on empty source/destination statements

commit a70210d38e6c61f3abd55bb8934f292f78d16094
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:45:41 2007 +0200

    fixed non-null terminated utmp username handling
    
    2005-10-15  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afuser.c: instead of assuming that names in utmp are NUL
    	terminated (which turned out not to be true), limit the length of
    	comparison to sizeof(ut->ut_name)

commit 681d361bcdda4fbf59ca42b1c823cb9cb61d5c50
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:45:39 2007 +0200

    preparation for the 1.9.6 release

commit f9a99c40142973ed5a880795b3b66ad2b603fec9
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:45:27 2007 +0200

    fixed problems in syslog priority filter, added unit test for most built-in filters
    
    2005-10-15  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/filter.c (filter_facility_eval): added facility value ->
    	bitmap position cache for improved performance,
    	(filter_level_eval): fixed filter evaluation (the functio
    	erroneously used the same values for the internal valid bitmap and
    	the syslog header priority value), a similar search through
    	sl_levels is required as was already present for facility filtering, also
    	the same cache mechanism was added for improved performance
    
    	* tests/unit/test_filter.c: new unit test file, tests most easily
    	testable filters, AND/OR operations and negation

commit a8a3f73700f4c5e91dcad18c26df09157900c761
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:44:16 2007 +0200

    timezone DST fixes
    
    2005-10-15  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: removed check for the global timezone variable
    
    	* src/misc.c (get_local_timezone_ofs): use tm->tm_gmtoff if
    	available and the difference between the results of gmtime and
    	localtime if not, this should be a portable way to determine the
    	correct timezone offset,
    	(format_zone_info): new function to format a timezone offset in a
    	way similar to strftime %z
    
    	* src/logmsg.c (log_stamp_format): use the new format_zone_info
    	functio
    
    	* src/macros.c (log_macro_expand): always use the new
    	format_zone_info function instead of strftime
    
    	* doc/reference/syslog-ng.xml: TZ is now equivalent to TZOFFSET

commit 0f5500c5a410f6627300a1ec04530596f577b63b
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:43:52 2007 +0200

    added a missing "return"
    
    2005-10-07  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/misc.c (get_local_timezone_ofs): added a missing retur

commit 0140d28fa6e77c77763f56c35af1afdd0791c5ca
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:43:50 2007 +0200

    check for gmt_off in struct tm and detect timezone accordingly
    
    2005-10-05  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: added a test for tm_gmtoff in struct tm as it is not
    	present on Solaris
    
    	* src/misc.c: use the old global timezone based timezone detection code
    	if tm_gmtoff is not present in "struct tm"

commit e729578ec04ec9358dc491427faf09655b8e999b
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:43:41 2007 +0200

    fixed facility/priority filters

commit 1140c51b052c13ba55dbeac3a5de12ef5d29e7f8
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:43:09 2007 +0200

    contrib subdirectory and its contents copied from syslog-ng 1.6.x

commit 7625921981a0f50c8f4bd299adf9e91d034cd470
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:42:27 2007 +0200

    fixed template-escape processing for inline templates
    
    2005-08-30  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_dd_set_file_template,
    	affile_dd_set_template_escape, affile_dd_set_fsync): removed as
    	templates are logwriter specific options,
    	(affile_dd_new): do not allocate 'templates' variable,
    	(affile_dd_free): do not free 'templates'
    
    	* src/affile.h (AFFileDestDriver): removed template variable as it
    	was not used
    
    	* src/cfg-grammar.y (dest_writer_option): template_escape and fsync
    	were erroneously calling affile specific functions, fixed that
    
    	* src/logwriter.c (log_writer_options_set_template_escape): new function,
    	basically transformed from affile_dd_set_template_escape

commit 8019401e574bb12e967cbb9bd1eafa8f48e72bf2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:42:04 2007 +0200

    added configure test for regexec() function

commit e88d350df929ae9936fc4a00d5cbfe7376400bd6
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:42:01 2007 +0200

    fixed test_msgparse program to work on BSDs
    
    2005-08-08  Balazs Scheidler <bazsi@balabit.hu>
    
    	* tests/unit/test_msgparse.c (main): do not use "timezone" as a
    	global variable as it is a function on BSD derived platforms

commit b55720bd14ba14d94cf7674f1f9c98e86e298349
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:42:00 2007 +0200

    fixed file uid/gid setting and some gcc4 problems
    
    2005-08-07  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c: fixed affile_dd_set_{file,dir}_{uid,gid}
    
    	* src/*.h: added complete prototypes for all functions

commit c8fe8173dd187a172c21165600476eb1a443dbf2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:57 2007 +0200

    fixed mark_freq problem
    
    2005-08-04  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logreader.c (log_reader_fd_prepare): make sure make_target is
    	initialized before going to the poll loop first

commit 86451169b92a977574fb90ca657d91a321db4533
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:52 2007 +0200

    deprecated sync_freq, introduced flush_lines instead, fixed a faction of seconds formatting problem
    
    2005-08-04  Balazs Scheidler <bazsi@balabit.hu>
    
    	* doc/reference/syslog-ng.xml: added documentation on the new
    	flush_lines and flush_timeout options
    
    	* src/affile.c (affile_dd_set_sync_freq): removed sync_freq support,
    	did not work anyway, introduced flush_lines & flush_timeout instead
    
    	* src/afinet.c (afinet_dd_set_sync_freq): removed
    
    	* src/cfg-grammar.y: added flush options
    
    	* src/cfg.c: -"-
    
    	* src/logwriter.c: added flush_lines and flush_timeout support
    
    	* src/logmsg.c: fixed time fraction formatting

commit 10490933e2cd4ae3a5c5e15264d3839a229b0c46
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:40 2007 +0200

    further fixes to the previous patch to unify tcp/udp codepaths in afsocket, test program fixes
    
    2005-07-30  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afinter.c (afinter_source_dispatch): do not dispatch message
    	if it is NULL (might happen if several internal sources are defined)
    
    	* src/afsocket.c (afsocket_sc_queue): removed bogus internal error message,
    	(afsocket_sd_init): added error handling around listen()
    
    	* tests/functional/func_test.py: added AF_INET testing (udp & tcp)

commit 2456bb8bd9c5a901bff4e4758b74ffe31f0c7440
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:35 2007 +0200

    fixed stupid UDP initialization problem and updated a unit test program
    
    2005-07-30  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_sd_init): fixed stupid mistake in UDP
    	initialization code
    
    	* tests/unit/test_msgparse.c: adapted to the new timezone parsing
    	code (msg has the local timezone by default instead of -1)

commit 8a347a3cfb685f517afad187beed8c0b29fb0fa7
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:30 2007 +0200

    added cfg-lex.c and cfg-grammar.c to the distribution

commit 6781972a39647a433453f087dbcd147316692537
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:25 2007 +0200

    small Makefile fixes and a flex compatibility fix
    
    2005-07-28  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/Makefile.am: added cfg-lex.c and cfg-grammar.c to
    	 MAINTAINER_CLEAN_FILES
    
    	* src/cfg-lex.l: removed YY_NO_UNPUT as it was not standard
    	(reported by Roberto Nibali)

commit 15b0efe96f01e06e8331c6a69e943040f4643424
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:23 2007 +0200

    use the same code path for SOCK_STREAM and SOCK_DGRAM sockets
    
    2005-07-26  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_sd_init, afsocket_sd_deinit): unified
    	SOCK_STREAM and SOCK_DGRAM code-paths, do not use a separate reader
    	for SOCK_DGRAM, use AFSocketSourceConnection instead for both types,
    	(afsocket_sd_format_persist_name): new function, to format a
    	persistent config name, instead of doing it inline every time

commit 351ce5dea839151638b7adb0b7b4a586fd83aca6
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:21 2007 +0200

    timezone portability fixes for BSDs
    
    2005-07-26  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/misc.c (get_local_timezone_ofs): added a time_t when argument,
    	the timezone will be returned for that given time in UTC, the
    	algorithm to return a timezone does not rely on the timezone and
    	daytime global variables as those are Linux specific
    
    	* src/macros.c (log_macro_expand): pass the appropriate time for get_local_timezone_ofs()
    
    	* src/logmsg.c (log_msg_parse, log_msg_init): -"-
    
    	* src/affile.c (affile_dd_queue): -"-

commit 5b86dfbdd9e1b8c8e23a99a03be7801926c8b064
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:11 2007 +0200

    updated NEWS file and version number in configure.i

commit 32fc9b25af816227ce4dd467f5dab97a94b62584
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:10 2007 +0200

    fix match references
    
    2005-07-07  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/templates.c (log_template_compile): fix match references not
    	to include the reference number itself

commit 78319022047c5654d996a57fbadd020457ec9893
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:08 2007 +0200

    fixed possible memory/fd leak when a filename contains macros
    
    2005-07-07  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/logwriter.c (log_writer_deinit): fixed memory/fd leak, unref
    	self->source as well as destroy it

commit 3e4a93bb559083ad7ed6b310810e48a5a3a0fcea
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:06 2007 +0200

    fixed use_time_recvd() option handling, documentation updates
    
    2005-06-30  Balazs Scheidler <bazsi@balabit.hu>
    
    	* doc/reference/syslog-ng.xml: updated documentation, removed
    	non-existing template timezone option, separate Macros section,
    	added a table on common destination options, added prefixed time
    	related macros without documentation, added DEPRECATED notice to
    	use_time_recvd(), added documentation on ts_format
    
    	* src/affile.c: use the value for the global use_time_recvd() optio
    	when expanding a filename
    
    	* src/logwriter.c: use the value for the global use_time_recvd()
    	option when expanding the log message

commit 750066a2742d92d55d9439364e58f57bafd159e6
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:03 2007 +0200

    fix file/directory permission handling
    
    2005-06-27  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_dw_init): use the file/dir permissions set by the user

commit 716a0de6d90011220a8e516b30e56de57fe75e11
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:41:01 2007 +0200

    removed a nested function from affile.c
    
    2005-06-27  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/affile.c (affile_dd_reap_writers): gcc4 does not like nested
    	functions, do not use that

commit 7f99e304351cab96ddffe189542dae86c17e1b17
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:40:59 2007 +0200

    added sync() alias for sync_freq() to maintain 1.6.x compatibility
    
    2005-06-24  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-lex.l: added sync() alias for sync_freq() to maintai
    	compatibility with 1.6.x

commit 5c0d6c3b7fabf06bb7f747f3bb88e832fec42f51
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:40:56 2007 +0200

    added WEEK macro to macro expansion
    
    2005-06-23  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/macros.c, src/macros.h: added support for WEEK, R_WEEK and
    	S_WEEK macros
    
    	* doc/reference/syslog-ng.xml: added documentation on the WEEK macro

commit f132f2749614ed92fb6123155619458cff4d3358
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:40:45 2007 +0200

    timezone cleanup and fixes, fixed name resolving for socket sources
    
    2005-06-05  Balazs Scheidler <bazsi@balabit.hu>
    
    	* doc/reference/syslog-ng.xml: added a section on timezones
    
    	* src/cfg-grammar.y, src/cfg-lex.l: removed timezone options from
    	templates, removed zone_offset_set variables, a timezone value of -1
    	indicates unset state instead,
    	(tz_convert) use explicit timezone specification instead,
    	(recv-time-zone, send-time-zone): new keywords to specify default
    	incoming/outgoing timezones
    
    	* src/affile.c: adapted to the latest log_template_format() changes
    
    	* src/cfg.c (cfg_tz_convert_value): removed,
    	(cfg_new): initialize sent/recv timezones
    
    	* src/fdread.c: fixed a bug in recvfrom, the length for the sockaddr
    	structure was incorrectly specified
    
    	* src/logmsg.c (log_stamp_format): instead of tz_convert use
    	zone_offset, fixed a problem in zone formatting,
    	(log_msg_parse): a value of -1 indicates "unspecified" zone for
    	incoming messages, use get_local_time_zone_ofs() function instead of
    	referencing the timezone variable directly,
    	(log_msg_init): use get_local_time_zone_ofs()
    
    	* src/logreader.c (log_reader_handle_line): use only set the
    	timezone associated with the incoming message if it has no timezone setting,
    	(log_reader_options_defaults, log_reader_options_init): inherit
    	default value for zone_offset from recv_zone_offset in the global configuratio
    
    	* src/logwriter.c: adapted to log_template_format changes,
    	inherit zone_offset from send_zone_offset
    
    	* src/macros.c: added STAMP, R_STAMP and S_STAMP macros to represent
    	the message timestamp formatted as specified by the ts_format()
    	global option,
    	(log_macro_expand): added ts_format argument, and the implementatio
    	of the STAMP macro
    
    	* src/misc.c (get_local_timezone_ofs): new function, calculates and
    	returns the current timezone offset in seconds
    
    	* src/templates.c (log_template_format): added ts_format and
    	zone_offset arguments

commit bcfc5424f4e3bce06c912a6caccc5d59d671ea2f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:40:35 2007 +0200

    added static linking option to configure, small fixes
    
    2005-06-04  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: added --enable-static-linking option
    
    	* src/cfg-lex.l: fixed problem that caused keyword recognitio
    	problems, words that began with a reserved word were erroneously
    	recognized as the reserved word (user vs usertty)
    
    	* src/cfg.c: added error checking for file_template and
    	proto_template options
    
    	* src/logmsg.c (log_msg_init): always set frac_present to TRUE,
    	(log_msg_parse): frac_present is set to FALSE if there was a
    	timestamp which did not contain fractions

commit f248bbb5a175dcc538c96704666ccd7e40c1b626
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:40:27 2007 +0200

    configure.in and some warning fixes
    
    2005-05-19  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: removed no-define from AM_INIT_AUTOMAKE as this made
    	PACKAGE and VERSION preprocessor symbols undefined
    
    	* src/macros.c: fixed uninitialized variable for MSGONLY processing
    
    	* src/cfg.c: fixed two type-punned pointer references

commit 3406c4235ef2d3df52b94a22c798e79f33d50a4f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:40:24 2007 +0200

    treat use_fqdn correctly when getting local hostname
    
    2005-05-19  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/misc.c (getlonghostname): new function, returns the fully
    	qualified domain name for localhost,
    	(resolve_hostname): use the new getlonghostname, if use_fqdn was
    	TRUE

commit 02ba2b8824778668d2c4ed4dd0de30a73837795f
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:40:08 2007 +0200

    cleaned up tla inventory files

commit def0e7f55442d4a8af0a18a623b6516181c79edb
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:49 2007 +0200

    Solaris portability fixes
    
    2005-04-27  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: added ld detection code to discover static linking arguments
    
    	* tests/unit/test_msgparse.c: added <string.h>
    
    	* tests/unit/Makefile.am: instead of noinst, use check prefix to avoid
    	building the testprograms during regular builds

commit fe6565ac1344b764a9604d566ae272f06df10482
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:44 2007 +0200

    fixed a docbug in doc/reference/syslog-ng.xml

commit 474fa28df32c1d403e057e2fbccfdd20fe996c75
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:28 2007 +0200

    added dist.conf and added automatic substitution of some dynamic variables in the documentation

commit f0f2ae7ad743644d7812b6f7294e2799e2d5f4da
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:11 2007 +0200

    removed "reference/" the root path for the reference syslog-ng.html.tar.gz

commit 074c5dd72146cca94fba1f96c98bf0b2f04c55d1
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:10 2007 +0200

    Configure fix to --enable-dynamic-linking
    
    2005-04-15  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: do not enforce static glib if --enable-dynamic-linking was specified

commit cf811ecda2d57379a347e157683afcb4f4e6648e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:07 2007 +0200

    fixed release numbers in NEWS

commit 10fa27e9371d7b28974df7092eaf4707572c0c50
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:06 2007 +0200

    updated NEWS file, bumped version to 1.9.4

commit b6d2c44c68e9b2351940da10ca8b81d936d86058
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:37:03 2007 +0200

    improved configure tests

commit a2b4e66ac8378c16c12e7f3d7b44e3ebd4cad7bd
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:36:25 2007 +0200

    added template unit tests

commit f948571ab493cf2c9e72884eeb430cc776d04e2e
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:35:57 2007 +0200

    fixed reference documentation generation

commit 5081487abefbd8b12056854f2c06272f9abe0179
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:34:58 2007 +0200

    Fixed (filename, logoutput) template compilation
    
    2005-02-28  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/templates.c (log_template_compile, log_template_format): fixed
    	a problem in template comilation as it messed up the formatted string

commit 93d418a89a6db80c4fd45e22357256737c7d2517
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:31:14 2007 +0200

    Changed g_queue_get_length to g_queue_is_empty as it makes syslog-ng compatible with glib 2.2
    
    2005-02-28  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afinter.c: instead of using "!!g_queue_get_length()" use
    	"!g_queue_is_empty()"

commit 1b64e4f68899bfd13ec71939877d96befd495827
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:31:09 2007 +0200

    Updated documentation (manpages)

commit 86dd321a43078478f3d6c650e2110ccfa6d3d449
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:31:04 2007 +0200

    removed doc/reference/make.sh from dist as it is not needed

commit bd6598d1788be78a1b66a7aab15a92784a7ede88
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:28:16 2007 +0200

    added copyright info, beginnings of a testsuite, fixed some configure problems
    
    2005-01-16  Balazs Scheidler <bazsi@balabit.hu>
    
            * configure.in: take CFLAGS environment variable into consideration
            when running configure, link eventlog and glib statically
    
            * src/fdread.c, src/fdwrite.c: handle EINTR by repeating the read
            system call
    
            * src/logreader, src/logwriter.c: handle EAGAIN correctly

commit 484946f74569972c2ac9953545095896f4206e7c
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:22:38 2007 +0200

    Updated NEWS file, released syslog-ng 1.9.3
    
    2005-01-22  Balazs Scheidler <bazsi@balabit.hu>
    
    	* NEWS: updated with 1.9.3 release information
    
    	* configure.in: bumped version to 1.9.3

commit b0c3bbd42677be715ee4317be590f91a611dcf98
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:21:29 2007 +0200

    added automatic regeneration of the ChangeLog file

commit 7c7e2b3097b8acd9ffe33ae343ecdc50855136c8
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:20:58 2007 +0200

    Readded and updated documentation from 1.6
    
    2005-01-22  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/cfg-lex.l: renamed padding to pad_size to make it compatible
    	with 1.6.x, the '-' character in keywords is taken equivalent to
    	'_', fixed C code indentation to match GNU coding style

commit f2668375350b0d2bb4147d2f3a4730e66bdedf07
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:19:51 2007 +0200

    added some missing files to tla

commit 7adb02ac63148aa5d2bac56ccce6044b21b00fc2
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 01:12:56 2007 +0200

    added copyright info, beginnings of a testsuite, fixed some configure problems
    
    2005-01-16 Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: take CFLAGS environment variable into consideration
    	when running configure, link eventlog and glib statically
    
    	* src/fdread.c, src/fdwrite.c: handle EINTR by repeating the read system call
    
    	* src/logreader, src/logwriter.c: handle EAGAIN correctly

commit 4c75312d56a852cbe729e408c31e36dae72a6119
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:59:27 2007 +0200

    Set nonblocking mode for g_accepted sockets
    
    2005-01-15  Balazs Scheidler <bazsi@balabit.hu>
    
    	* src/afsocket.c (afsocket_sd_accept): added g_fd_set_nonblock for
    	new sockets

commit 1474947de5d34fe067fab4d85561a9a10ccee9a1
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:59:12 2007 +0200

    fixed possible deadlocking on the internal message pipe
    
    2005-01-09  Balazs Scheidler <bazsi@balabit.hu>
    
            * src/logsource.c: new file, separated flow control related
            functions from logreader
    
            * src/logreader.c: LogReader is derived from LogSource
    
            * src/afinter.c: substituted the pipe used for internal messages
            with a GQueue

commit 45e83edd0d9a606961c0ced0f5eb35acbbc04ab9
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:48:55 2007 +0200

    Fixed a couple of Solaris portability problems
    
    2005-01-05  Balazs Scheidler <bazsi@balabit.hu>
    
    	* configure.in: added checks for -ldoor, -lsocket, -lnsl and getopt.h
    
    	* other files: fixed a couple of Solaris specific warnings

commit 25a0f59a54fc47159cdda6ad416991200bc04b65
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:48:08 2007 +0200

    Updated NEWS file and released 1.9.2

commit 4e1896183d3f8cdc75ee75ba0a1484e1e5c6c192
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:29:51 2007 +0200

    added missing macros and brace support in macro expansion
    
    2004-12-31  Balazs Scheidler <bazsi@balabit.hu>
    
            * src/macros.c: added PRI and MSGONLY macros
    
            * src/templates.c: added support for braces around macros for
            $example: "{MSG}"

commit 4ce759ae084a6829e4851c66e9c9d49c3c49a6ab
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:26:56 2007 +0200

    fixed couple of bugs
    
    2004-12-29  Balazs Scheidler <bazsi@balabit.hu>
    
            * src/afprog.c (afprogram_dd_init): call setsid before launching child,
            (afprogram_dd_deinit): deinit & unref self->writer here instead of
            in afprogram_dd_free,
    
            * src/center.c (log_center_queue): do not supply self as user_data pointer to
            the ack_block callback as that would require adding a reference to self
    
            * src/dgroup.c (log_dest_group_queue): do not supply self as user_data pointer to
            the ack_block callback as that would require adding a reference to self
    
            * src/logreader.c: instead of using self->window_size use self->options->window_size
            so that the window is shared between all LogReaders using the same
            options,
            (log_reader_handle_line): add reference to self before supplying it as an argument to
            the ack_block callback function,
            (log_reader_msg_ack): unref the supplied logreader argument

commit 690c934f09837eb6ac20b1a26cba1897b05f7aaf
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:26:37 2007 +0200

    Added a lot of copyright header, docstrings, and some fixes
    
    2004-12-27  Balazs Scheidler <bazsi@balabit.hu>
    
            * src/afsocket.c (afsocket_sd_deinit): break circular reference
            between self->reader and self,
            (afsocket_sd_notify): do not destroy/unref sender in NC_CLOSE, as
            afsocket_sd_close_connection already does that,
            (afsocket_sd_init, afsocket_sd_deinit): removed static,
            (afsocket_sd_free_instance): renamed from afsocket_sd_free, removed
            static, created a new afsocket_sd_free function at the same time
            which is set as the free_fn of AFSocketSourceDriver
    
            * src/afunix.c: implemented user/group/perm settings
    
            * src/cfg-grammar.y: added support for log-prefix
    
            * src/cfg.c: changed default timestamp format to BSD for compatibility
    
            * src/filter.c: fixed AND and OR operator evaluation, the operands
            were not correctly saved at initialization time, thus NULL was
            referenced at evaluation time
    
            * src/logreader.c: added log_prefix support for all log readers
    
            * src/logwriter.c: use log_msg_drop instead of a simple log_msg_unref
    
            * src/main.c: fixed SIGCHLD handling, loop while waitpid returns > 0,
            added tzset() call

commit 662494a7b08fe32b94b063c7e66cb40b1179fd94
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:24:41 2007 +0200

    Fixed a lot of memory leaks
    
    2004-12-27  Balazs Scheidler <bazsi@balabit.hu>
    
            * src/affile.c (affile_sd_deinit): make sure to break circular
            reference between self->reader and self, fixes possible memory leak,
            (affile_sd_free): call log_drv_free_instance
    
            * src/afinter.c (afinter_sd_deinit): break circular reference
            between self->reader and self
    
            * src/afprog.c (afprog_sd_free): added log_drv_free_instance
    
            * src/afsocket.c (afsocket_sd_deinit): break circular reference
            between self->reader and self,
            (afsocket_sd_free): added log_drv_free_instance,
            (afsocket_dd_free): -"-
    
            * src/afuser.c (afuser_dd_queue): free queued message,
            (afuser_dd_free): added log_drv_free_instance
    
            * src/cfg-grammar.y: unref log driver after appending to avoid
            memory leaks
    
            * src/cfg.c (cfg_reload_config): fixed possible memory leak when
            cfg_init fails (free persist),
            (persist_config_free): added missing free for hashtable
    
            * src/dgroup.c (log_dest_group_queue): make sure each driver gets
            its own reference to msg as each will free it on its own, also
            added an explicit unref at the end of the function
            (log_dest_group_new): added missing call to log_pipe_init_instance
    
            * src/gsockaddr.c: removed all low-level g_message invocation,
            errors should be reported by the caller
    
            * src/logpipe.c: added assertions to _ref and _unref
    
            * src/main.c (main_loop_run): added a missing g_main_loop_unref to
            avoid memory leaks,
            (main): call msg_syslog_started at the end of initialization to force
            messages into the system log
    
            * src/messages.c (msg_syslog_started): new function to indicate
            that initialization is finished, messages will be written to
            stderr instead of the internal() source if syslog is not yet
            started to let the administrator see important
            failure messages,
            (msg_deinit): free the event log context, only close the error pipe
            if it was really opened

commit 41fb02f50abb10b56f8286b5a5ef7f5add41b899
Author: Balazs Scheidler <bazsi@bzorp.balabit>
Date:   Sat Apr 14 00:21:06 2007 +0200

    Initial import into git
